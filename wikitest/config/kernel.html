<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="utf-8">
        <title>Kernel - EvolutionOS Handbook</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
        </script>
		<!-- Work around some values being stored in localStorage wrapped in quotes -->
		<script type="text/javascript">
			try {
				var sidebar = localStorage.getItem('mdbook-sidebar');

				if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
					localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
				}
			} catch (e) { }
		</script>

		<header>
			<nav id="void-nav">
			
				<ul id="nav-left">
				  <li>
				    <b href="/">
              <img src="/evolutionos.png" alt="EvolutionOS Logo">
            </b>
          </li>
        </ul>
        <ul>
          <li><ao href="/download">Download</ao></li>
					<li><ao href="/wiki">Wiki</ao></li>
					<li><ao href="https://github.com/evolution-linux/evolution-linux.github.io">Source Code</a></li>
					<ao onclick="toggleDarkMode()" class="dark-mode-button">Toggle Dark Mode</ao>
				</ul>
				
				<ul>
					<li><a id="skip-to-content" tabindex="1" href="#main">Skip to content</a></li>
					<li>
						<button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
							<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
								<path d="M1 3v2h18V3zm0 8h18V9H1zm0 6h18v-2H1z"/>
							</svg>
						</button>
					</li>
					<li>
						<button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
							<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
								<path d="M7.5 13c3.04 0 5.5-2.46 5.5-5.5S10.54 2 7.5 2 2 4.46 2 7.5 4.46 13 7.5 13zm4.55.46C10.79 14.43 9.21 15 7.5 15 3.36 15 0 11.64 0 7.5S3.36 0 7.5 0C11.64 0 15 3.36 15 7.5c0 1.71-.57 3.29-1.54 4.55l6.49 6.49-1.41 1.41-6.49-6.49z"/>
							</svg>
						</button>
					</li>
                                        <noscript>
                                          <li class="js-unavailable">Search functionality requires JavaScript</li>
                                        </noscript>
				</ul>
				
			</nav>
		</header>

		<div id="content">

			<!-- Hide / unhide sidebar before it is displayed -->
			<script type="text/javascript">
				var html = document.querySelector('html');
				var sidebar = 'hidden';
				if (document.body.clientWidth >= 1080) {
					try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
					sidebar = sidebar || 'visible';
				}
				html.classList.remove('sidebar-visible');
				html.classList.add("sidebar-" + sidebar);
			</script>

			<nav id="sidebar" aria-label="Table of contents">
				<ol class="chapter"><li class="chapter-item expanded "><a href="../about/index.html"><strong aria-hidden="true">1.</strong> About</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../about/history.html"><strong aria-hidden="true">1.1.</strong> History</a></li><li class="chapter-item expanded "><a href="../about/about-this-handbook.html"><strong aria-hidden="true">1.2.</strong> About This Handbook</a></li><li class="chapter-item expanded "><a href="../about/infradocs.html"><strong aria-hidden="true">1.3.</strong> InfraDocs</a></li></ol></li><li class="chapter-item expanded "><a href="../installation/index.html"><strong aria-hidden="true">2.</strong> Installation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../installation/live-images/index.html"><strong aria-hidden="true">2.1.</strong> Live Installers</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../installation/live-images/prep.html"><strong aria-hidden="true">2.1.1.</strong> Prepare Installation Media</a></li><li class="chapter-item expanded "><a href="../installation/live-images/partitions.html"><strong aria-hidden="true">2.1.2.</strong> Partitioning Notes</a></li><li class="chapter-item expanded "><a href="../installation/live-images/guide.html"><strong aria-hidden="true">2.1.3.</strong> Installation Guide</a></li></ol></li><li class="chapter-item expanded "><a href="../installation/guides/index.html"><strong aria-hidden="true">2.2.</strong> Advanced Installation Guides</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../installation/guides/chroot.html"><strong aria-hidden="true">2.2.1.</strong> Installation via chroot (x86/x86_64/aarch64)</a></li><li class="chapter-item expanded "><a href="../installation/guides/fde.html"><strong aria-hidden="true">2.2.2.</strong> Full Disk Encryption</a></li><li class="chapter-item expanded "><a href="../installation/guides/zfs.html"><strong aria-hidden="true">2.2.3.</strong> Root on ZFS</a></li><li class="chapter-item expanded "><a href="../installation/guides/arm-devices/index.html"><strong aria-hidden="true">2.2.4.</strong> ARM Devices</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../installation/guides/arm-devices/platforms.html"><strong aria-hidden="true">2.2.4.1.</strong> Supported Platforms</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../installation/musl.html"><strong aria-hidden="true">2.3.</strong> musl</a></li></ol></li><li class="chapter-item expanded "><a href="../config/index.html"><strong aria-hidden="true">3.</strong> Configuration</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../config/package-documentation/index.html"><strong aria-hidden="true">3.1.</strong> Package Documentation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../config/package-documentation/man.html"><strong aria-hidden="true">3.1.1.</strong> Manual Pages</a></li></ol></li><li class="chapter-item expanded "><a href="../config/firmware.html"><strong aria-hidden="true">3.2.</strong> Firmware</a></li><li class="chapter-item expanded "><a href="../config/locales.html"><strong aria-hidden="true">3.3.</strong> Locales and Translations</a></li><li class="chapter-item expanded "><a href="../config/users-and-groups.html"><strong aria-hidden="true">3.4.</strong> Users and Groups</a></li><li class="chapter-item expanded "><a href="../config/services/index.html"><strong aria-hidden="true">3.5.</strong> Services and Daemons - runit</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../config/services/user-services.html"><strong aria-hidden="true">3.5.1.</strong> Per-User Services</a></li><li class="chapter-item expanded "><a href="../config/services/logging.html"><strong aria-hidden="true">3.5.2.</strong> Logging</a></li></ol></li><li class="chapter-item expanded "><a href="../config/rc-files.html"><strong aria-hidden="true">3.6.</strong> rc.conf, rc.local and rc.shutdown</a></li><li class="chapter-item expanded "><a href="../config/cron.html"><strong aria-hidden="true">3.7.</strong> Cron</a></li><li class="chapter-item expanded "><a href="../config/ssd.html"><strong aria-hidden="true">3.8.</strong> Solid State Drives</a></li><li class="chapter-item expanded "><a href="../config/security/index.html"><strong aria-hidden="true">3.9.</strong> Security</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../config/security/apparmor.html"><strong aria-hidden="true">3.9.1.</strong> AppArmor</a></li></ol></li><li class="chapter-item expanded "><a href="../config/date-time.html"><strong aria-hidden="true">3.10.</strong> Date and Time</a></li><li class="chapter-item expanded "><a href="../config/kernel.html" class="active"><strong aria-hidden="true">3.11.</strong> Kernel</a></li><li class="chapter-item expanded "><a href="../config/power-management.html"><strong aria-hidden="true">3.12.</strong> Power Management</a></li><li class="chapter-item expanded "><a href="../config/network/index.html"><strong aria-hidden="true">3.13.</strong> Network</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../config/network/firewalls.html"><strong aria-hidden="true">3.13.1.</strong> Firewalls</a></li><li class="chapter-item expanded "><a href="../config/network/wpa_supplicant.html"><strong aria-hidden="true">3.13.2.</strong> wpa_supplicant</a></li><li class="chapter-item expanded "><a href="../config/network/iwd.html"><strong aria-hidden="true">3.13.3.</strong> IWD</a></li><li class="chapter-item expanded "><a href="../config/network/networkmanager.html"><strong aria-hidden="true">3.13.4.</strong> NetworkManager</a></li><li class="chapter-item expanded "><a href="../config/network/connman.html"><strong aria-hidden="true">3.13.5.</strong> ConnMan</a></li></ol></li><li class="chapter-item expanded "><a href="../config/network-filesystems.html"><strong aria-hidden="true">3.14.</strong> Network Filesystems</a></li><li class="chapter-item expanded "><a href="../config/session-management.html"><strong aria-hidden="true">3.15.</strong> Session and Seat Management</a></li><li class="chapter-item expanded "><a href="../config/graphical-session/index.html"><strong aria-hidden="true">3.16.</strong> Graphical Session</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../config/graphical-session/graphics-drivers/index.html"><strong aria-hidden="true">3.16.1.</strong> Graphics Drivers</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../config/graphical-session/graphics-drivers/amd.html"><strong aria-hidden="true">3.16.1.1.</strong> AMD or ATI</a></li><li class="chapter-item expanded "><a href="../config/graphical-session/graphics-drivers/intel.html"><strong aria-hidden="true">3.16.1.2.</strong> Intel</a></li><li class="chapter-item expanded "><a href="../config/graphical-session/graphics-drivers/nvidia.html"><strong aria-hidden="true">3.16.1.3.</strong> NVIDIA</a></li><li class="chapter-item expanded "><a href="../config/graphical-session/graphics-drivers/optimus.html"><strong aria-hidden="true">3.16.1.4.</strong> NVIDIA Optimus</a></li></ol></li><li class="chapter-item expanded "><a href="../config/graphical-session/xorg.html"><strong aria-hidden="true">3.16.2.</strong> Xorg</a></li><li class="chapter-item expanded "><a href="../config/graphical-session/wayland.html"><strong aria-hidden="true">3.16.3.</strong> Wayland</a></li><li class="chapter-item expanded "><a href="../config/graphical-session/fonts.html"><strong aria-hidden="true">3.16.4.</strong> Fonts</a></li><li class="chapter-item expanded "><a href="../config/graphical-session/icons.html"><strong aria-hidden="true">3.16.5.</strong> Icons</a></li><li class="chapter-item expanded "><a href="../config/graphical-session/gnome.html"><strong aria-hidden="true">3.16.6.</strong> GNOME</a></li><li class="chapter-item expanded "><a href="../config/graphical-session/kde.html"><strong aria-hidden="true">3.16.7.</strong> KDE</a></li></ol></li><li class="chapter-item expanded "><a href="../config/media/index.html"><strong aria-hidden="true">3.17.</strong> Multimedia</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../config/media/alsa.html"><strong aria-hidden="true">3.17.1.</strong> ALSA</a></li><li class="chapter-item expanded "><a href="../config/media/pipewire.html"><strong aria-hidden="true">3.17.2.</strong> PipeWire</a></li><li class="chapter-item expanded "><a href="../config/media/pulseaudio.html"><strong aria-hidden="true">3.17.3.</strong> PulseAudio</a></li><li class="chapter-item expanded "><a href="../config/media/sndio.html"><strong aria-hidden="true">3.17.4.</strong> sndio</a></li></ol></li><li class="chapter-item expanded "><a href="../config/bluetooth.html"><strong aria-hidden="true">3.18.</strong> Bluetooth</a></li><li class="chapter-item expanded "><a href="../config/texlive.html"><strong aria-hidden="true">3.19.</strong> TeX Live</a></li><li class="chapter-item expanded "><a href="../config/external-applications.html"><strong aria-hidden="true">3.20.</strong> External Applications</a></li><li class="chapter-item expanded "><a href="../config/print/index.html"><strong aria-hidden="true">3.21.</strong> Printing</a></li><li class="chapter-item expanded "><a href="../config/containers-and-vms/index.html"><strong aria-hidden="true">3.22.</strong> Containers and Virtual Machines</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../config/containers-and-vms/chroot.html"><strong aria-hidden="true">3.22.1.</strong> Chroots and Containers</a></li><li class="chapter-item expanded "><a href="../config/containers-and-vms/libvirt.html"><strong aria-hidden="true">3.22.2.</strong> libvirt</a></li><li class="chapter-item expanded "><a href="../config/containers-and-vms/lxc.html"><strong aria-hidden="true">3.22.3.</strong> LXC</a></li></ol></li><li class="chapter-item expanded "><a href="../config/openpgp.html"><strong aria-hidden="true">3.23.</strong> OpenPGP</a></li><li class="chapter-item expanded "><a href="../config/php.html"><strong aria-hidden="true">3.24.</strong> PHP</a></li></ol></li><li class="chapter-item expanded "><a href="../xbps/index.html"><strong aria-hidden="true">4.</strong> XBPS Package Manager</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../xbps/advanced-usage.html"><strong aria-hidden="true">4.1.</strong> Advanced Usage</a></li><li class="chapter-item expanded "><a href="../xbps/repositories/index.html"><strong aria-hidden="true">4.2.</strong> Repositories</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../xbps/repositories/mirrors/index.html"><strong aria-hidden="true">4.2.1.</strong> Mirrors</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../xbps/repositories/mirrors/changing.html"><strong aria-hidden="true">4.2.1.1.</strong> Changing Mirrors</a></li><li class="chapter-item expanded "><a href="../xbps/repositories/mirrors/tor.html"><strong aria-hidden="true">4.2.1.2.</strong> Using Tor Mirrors</a></li></ol></li><li class="chapter-item expanded "><a href="../xbps/repositories/restricted.html"><strong aria-hidden="true">4.2.2.</strong> Restricted Packages</a></li><li class="chapter-item expanded "><a href="../xbps/repositories/custom.html"><strong aria-hidden="true">4.2.3.</strong> Custom Repositories</a></li><li class="chapter-item expanded "><a href="../xbps/repositories/signing.html"><strong aria-hidden="true">4.2.4.</strong> Signing Repositories</a></li></ol></li><li class="chapter-item expanded "><a href="../xbps/troubleshooting/index.html"><strong aria-hidden="true">4.3.</strong> Troubleshooting XBPS</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../xbps/troubleshooting/common-issues.html"><strong aria-hidden="true">4.3.1.</strong> Common Issues</a></li><li class="chapter-item expanded "><a href="../xbps/troubleshooting/static.html"><strong aria-hidden="true">4.3.2.</strong> Static XBPS</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../contributing/index.html"><strong aria-hidden="true">5.</strong> Contributing</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../contributing/evolution-docs/index.html"><strong aria-hidden="true">5.1.</strong> Contributing To evolution-docs</a></li></ol></li></ol>
			</nav>

			<!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
			<script type="text/javascript">
				document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
	document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
	Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
		link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
	});
			</script>

			<div id="page-wrapper">
				<div id="search-wrapper" class="hidden">
					<form id="searchbar-outer" class="searchbar-outer">
						<input type="search" name="search" id="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
					</form>
					<div id="searchresults-outer" class="searchresults-outer hidden">
						<div id="searchresults-header" class="searchresults-header"></div>
						<ul id="searchresults">
						</ul>
					</div>
				</div>

				<main id="main">
					<h1 id="kernel"><a class="header" href="#kernel">Kernel</a></h1>
<h2 id="kernel-series"><a class="header" href="#kernel-series">Kernel series</a></h2>
<p>EvolutionOS provides many kernel series in the default repository. These are
named <code>linux&lt;x&gt;.&lt;y&gt;</code>: for example, <code>linux4.19</code>. You can query for all available
kernel series by running:</p>
<pre><code>$ xbps-query --regex -Rs '^linux[0-9.]+-[0-9._]+'
</code></pre>
<p>The <code>linux</code> meta package, installed by default, depends on one of the kernel
packages, usually the package containing the latest mainline kernel that works
with all DKMS modules. Newer kernels might be available in the repository, but
are not necessarily considered stable enough to be the default; use these at
your own risk. If you wish to use a more recent kernel and have DKMS modules
that you need to build, install the relevant <code>linux&lt;x&gt;.&lt;y&gt;-headers</code> package,
then use <a href="https://man.voidlinux.org/xbps-reconfigure.1">xbps-reconfigure(1)</a> to
reconfigure the <code>linux&lt;x&gt;.&lt;y&gt;</code> package you installed. This will build the DKMS
modules.</p>
<h2 id="removing-old-kernels"><a class="header" href="#removing-old-kernels">Removing old kernels</a></h2>
<p>When updating the kernel, old versions are left behind in case it is necessary
to roll back to an older version. Over time, old kernel versions can accumulate,
consuming disk space and increasing the time taken by DKMS module updates.
Furthermore, if <code>/boot</code> is a separate partition and fills up with old kernels,
updating can fail or result in incomplete initramfs filesystems to be generated
and result in kernel panics if they are being booted. Thus, it may be advisable
to clean old kernels from time to time.</p>
<p>Removing old kernels is done using the
<a href="https://man.voidlinux.org/vkpurge.8">vkpurge(8)</a> utility. <code>vkpurge</code> comes
pre-installed on every Void Linux system. This utility runs the necessary
<a href="#kernel-hooks">hooks</a> when removing old kernels. Note that <code>vkpurge</code> does not
remove kernel <em>packages</em>, only particular <em>kernels</em>.</p>
<h2 id="removing-the-default-kernel-series"><a class="header" href="#removing-the-default-kernel-series">Removing the default kernel series</a></h2>
<p>If you've installed a kernel package for a series other than the default, and
want to remove the default kernel packages, you should install the <code>linux-base</code>
package or <a href="https://man.voidlinux.org/xbps-pkgdb.1">mark it as a manual package</a>
in case it is already installed. After this procedure, you can remove the
default kernel packages with
<a href="https://man.voidlinux.org/xbps-remove.1">xbps-remove(1)</a>. It might be necessary
to add <code>linux</code> and <code>linux-headers</code> to an <code>ignorepkg</code> entry in
<a href="https://man.voidlinux.org/xbps.d.5">xbps.d(5)</a>, since base packages can depend
on them.</p>
<h2 id="switching-to-another-kernel-series"><a class="header" href="#switching-to-another-kernel-series">Switching to another kernel series</a></h2>
<p>If you'd like to use the <code>linux-lts</code> or <code>linux-mainline</code> kernel series instead
of the default <code>linux</code>, first install the desired series metapackage (and the
<code>linux-lts-headers</code> or <code>linux-mainline-headers</code> metapackage if needed). Then you
can add <code>linux</code> and <code>linux-headers</code> to an <code>ignorepkg</code> entry in
<a href="https://man.voidlinux.org/xbps.d.5">xbps.d(5)</a> and uninstall those packages.</p>
<h2 id="changing-the-default-initramfs-generator"><a class="header" href="#changing-the-default-initramfs-generator">Changing the default initramfs generator</a></h2>
<p>By default, EvolutionOS uses <a href="https://man.voidlinux.org/dracut.8">dracut</a> to
prepare initramfs images for installed kernels. Alternatives such as
<a href="https://man.voidlinux.org/mkinitcpio.8">mkinitcpio</a> are available. Each
initramfs generator registers an <a href="https://man.voidlinux.org/xbps-alternatives.1">XBPS
alternative</a> in the <code>initramfs</code>
group to link its <a href="#kernel-hooks">kernel hooks</a> to be used when creating or
removing initramfs images for a given kernel.</p>
<p>To replace dracut with, <em>e.g.</em>, mkinitcpio, install the <code>mkinitcpio</code> package;
confirm that <code>mkinitcpio</code> appears in the list of available alternatives by
running</p>
<pre><code>$ xbps-alternatives -l -g initramfs
</code></pre>
<p>Issue the command</p>
<pre><code># xbps-alternatives -s mkinitcpio
</code></pre>
<p>to replace the dracut kernel hooks with those provided by mkinitcpio. With
subsequent kernel updates (or updates to DKMS packages that trigger initramfs
regeneration), mkinitcpio will be used instead of dracut to prepare initramfs
images. To force images to regenerate, reconfigure your kernel packages by
invoking</p>
<pre><code># xbps-reconfigure -f linux&lt;x&gt;.&lt;y&gt;
</code></pre>
<p>for each <code>linux&lt;x&gt;.&lt;y&gt;</code> package that is currently installed.</p>
<h2 id="cmdline"><a class="header" href="#cmdline">cmdline</a></h2>
<p>The kernel, the initial RAM disk (initrd) and some system programs can be
configured at boot by kernel command line arguments. The parameters understood
by the kernel are explained in the <a href="https://www.kernel.org/doc/html/latest/admin-guide/kernel-parameters.html">kernel-parameters
documentation</a>
and by <a href="https://man.voidlinux.org/bootparam.7">bootparam(7)</a>. Parameters
understood by dracut can be found in
<a href="https://man.voidlinux.org/dracut.cmdline.7">dracut.cmdline(7)</a>.</p>
<p>Once the system is booted, the current kernel command line parameters can be
found in the <code>/proc/cmdline</code> file. Some system programs can change their
behavior based on the parameters passed in the command line, which is what
happens when <a href="./services/index.html#booting-a-different-runsvdir">booting a different
runsvdir</a>, for example.</p>
<p>There are different ways of setting these parameters, some of which are
explained below.</p>
<h3 id="grub"><a class="header" href="#grub">GRUB</a></h3>
<p>Kernel command line arguments can be added through the GRUB bootloader by
editing <code>/etc/default/grub</code>, changing the <code>GRUB_CMDLINE_LINUX_DEFAULT</code> variable
and then running <code>update-grub</code>.</p>
<h3 id="dracut"><a class="header" href="#dracut">dracut</a></h3>
<p>Dracut offers a <a href="https://man.voidlinux.org/dracut.conf.5"><code>kernel_cmdline</code> configuration
option</a> and <a href="https://man.voidlinux.org/dracut.8"><code>--kernel-cmdline</code>
command-line option</a> that will encode
command-line arguments directly in the initramfs image. When dracut is used to
create a UEFI executable, arguments set with these options will be passed to the
kernel. However, when an ordinary initramfs is produced, these options will
<em>not</em> be passed to the kernel at boot. Instead, they will be written to a
configuration file in <code>/etc/cmdline.d</code> within the image. While dracut parses
this configuration to control its own boot-time behavior, the kernel itself will
not be aware of anything set via this mechanism.</p>
<p>After modifying a dracut configuration, <a href="#kernel-hooks">regenerate</a> the
initramfs to ensure that it includes the changes.</p>
<h2 id="kernel-hardening"><a class="header" href="#kernel-hardening">Kernel hardening</a></h2>
<p>EvolutionOS Linux ships with some kernel security options enabled by default. This was
originally provided by kernel command line arguments <code>slub_debug=P page_poison=1</code>, but since kernel series 5.3, these have been replaced with
<code>init_on_alloc</code> and <code>init_on_free</code> (see <a href="https://github.com/torvalds/linux/commit/6471384af">this
commit</a>).</p>
<p>Evolution's kernels come with the <code>init_on_alloc</code> option enabled by default where
available (i.e. <code>linux5.4</code> and greater). In most cases you should usually not
disable it, as it has a fairly minimal impact on performance (within 1%). The
<code>init_on_free</code> option is more expensive (around 5% on average) and needs to be
enabled manually by passing <code>init_on_free=1</code> on the kernel command line. If you
need to disable <code>init_on_alloc</code>, you can do that similarly by passing
<code>init_on_alloc=0</code>.</p>
<p>There is a chance that your existing system still has the old options enabled.
They still work in newer kernels, but have a performance impact more in line
with <code>init_on_free=1</code>. On older hardware this can be quite noticeable. If you
are running a kernel series older than 5.4, you can keep them (or add them) for
extra security at the cost of speed; otherwise you should remove them.</p>
<h2 id="kernel-modules"><a class="header" href="#kernel-modules">Kernel modules</a></h2>
<p>Kernel modules are typically drivers for devices or filesystems.</p>
<h3 id="loading-kernel-modules-during-boot"><a class="header" href="#loading-kernel-modules-during-boot">Loading kernel modules during boot</a></h3>
<p>Normally the kernel automatically loads required modules, but sometimes it may
be necessary to explicitly specify modules to be loaded during boot.</p>
<p>To load kernel modules during boot, a <code>.conf</code> file like
<code>/etc/modules-load.d/virtio.conf</code> needs to be created with the contents:</p>
<pre><code># load virtio-net
virtio-net
</code></pre>
<h3 id="blacklisting-kernel-modules"><a class="header" href="#blacklisting-kernel-modules">Blacklisting kernel modules</a></h3>
<p>Blacklisting kernel modules is a method for preventing modules from being loaded
by the kernel. There are two different methods for blacklisting kernel modules,
one for modules loaded by the initramfs and one for modules loaded after the
initramfs process is done. Modules loaded by the initramfs have to be
blacklisted in the initramfs configuration.</p>
<p>To blacklist modules loaded after the initramfs process, create a <code>.conf</code> file,
like <code>/etc/modprobe.d/radeon.conf</code>, with the contents:</p>
<pre><code>blacklist radeon
</code></pre>
<h4 id="blacklisting-modules-in-the-initramfs"><a class="header" href="#blacklisting-modules-in-the-initramfs">Blacklisting modules in the initramfs</a></h4>
<p>After making the necessary changes to the configuration files, the initramfs
needs to be <a href="#kernel-hooks">regenerated</a> for the changes to take effect on the
next boot.</p>
<h5 id="dracut-1"><a class="header" href="#dracut-1">dracut</a></h5>
<p>Dracut can be configured to not include kernel modules through a configuration
file. To blacklist modules from being included in a dracut initramfs, create a
<code>.conf</code> file, like <code>/etc/dracut.conf.d/radeon.conf</code>, with the contents:</p>
<pre><code>omit_drivers+=&quot; radeon &quot;
</code></pre>
<h5 id="mkinitcpio"><a class="header" href="#mkinitcpio">mkinitcpio</a></h5>
<p>To blacklist modules from being included in a mkinitcpio initramfs a <code>.conf</code>
file needs to be created like <code>/etc/modprobe.d/radeon.conf</code> with the contents:</p>
<pre><code>blacklist radeon
</code></pre>
<h2 id="kernel-hooks"><a class="header" href="#kernel-hooks">Kernel hooks</a></h2>
<p>EvolutionOS provides directories for kernel hooks in
<code>/etc/kernel.d/{pre-install,post-install,pre-remove,post-remove}</code>.</p>
<p>These hooks are used to update the boot menus for bootloaders like <code>grub</code>,
<code>gummiboot</code> and <code>lilo</code>.</p>
<h3 id="install-hooks"><a class="header" href="#install-hooks">Install hooks</a></h3>
<p>The <code>{pre,post}-install</code> hooks are executed by
<a href="https://man.voidlinux.org/xbps-reconfigure.1">xbps-reconfigure(1)</a> when
configuring a Linux kernel, such as building its initramfs. This happens when a
kernel series is installed for the first time or updated, but can also be run
manually:</p>
<pre><code># xbps-reconfigure --force linux&lt;x&gt;.&lt;y&gt;
</code></pre>
<p>If run manually, they serve to apply initramfs configuration changes to the next
boot.</p>
<h3 id="remove-hooks"><a class="header" href="#remove-hooks">Remove hooks</a></h3>
<p>The <code>{pre,post}-remove</code> hooks are executed by
<a href="https://man.voidlinux.org/vkpurge.8">vkpurge(8)</a> when removing old kernels.</p>
<h2 id="dynamic-kernel-module-support-dkms"><a class="header" href="#dynamic-kernel-module-support-dkms">Dynamic Kernel Module Support (DKMS)</a></h2>
<p>There are kernel modules that are not part of the Linux source tree that are
built at install time using DKMS and <a href="#kernel-hooks">kernel hooks</a>. The
available modules can be listed by searching for <code>dkms</code> in the package
repositories.</p>
<p>DKMS build logs are available in <code>/var/lib/dkms/</code>.</p>

				</main>

				<nav id="nav-wide-wrapper" aria-label="Page navigation">
						<a href="../config/date-time.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
							<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20">
								<path d="M4 10l9 9 1.4-1.5L7 10l7.4-7.5L13 1z"/>
							</svg>
						</a>

						<a href="../config/power-management.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
							<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20">
								<path d="M7 1L5.6 2.5 13 10l-7.4 7.5L7 19l9-9z"/>
							</svg>
						</a>
				</nav>
			</div>
		</div>


        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../book.js" type="text/javascript" charset="utf-8"></script>
          <script>
    // Check if a dark mode cookie exists, and apply dark mode if it does
    if (getCookie("darkMode") === "true") {
      applyDarkMode();
    }

    function toggleDarkMode() {
      if (getCookie("darkMode") === "true") {
        // Disable dark mode
        setCookie("darkMode", "false", 365);
        applyLightMode();
      } else {
        // Enable dark mode
        setCookie("darkMode", "true", 365);
        applyDarkMode();
      }
    }

    function applyDarkMode() {
      document.body.classList.add("dark-mode");
    }

    function applyLightMode() {
      document.body.classList.remove("dark-mode");
    }

    // Helper functions for handling cookies
    function setCookie(name, value, days) {
      var expires = "";
      if (days) {
        var date = new Date();
        date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
        expires = "; expires=" + date.toUTCString();
      }
      document.cookie = name + "=" + (value || "") + expires + "; path=/";
    }

    function getCookie(name) {
      var nameEQ = name + "=";
      var ca = document.cookie.split(';');
      for (var i = 0; i < ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0) === ' ') c = c.substring(1, c.length);
        if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
      }
      return null;
    }
  </script>
    </body>
</html>
