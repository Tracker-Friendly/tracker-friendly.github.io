<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="utf-8">
        <title>EvolutionOS Handbook</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/print.css" media="print">
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
        </script>
		<!-- Work around some values being stored in localStorage wrapped in quotes -->
		<script type="text/javascript">
			try {
				var sidebar = localStorage.getItem('mdbook-sidebar');

				if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
					localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
				}
			} catch (e) { }
		</script>

		<header>
			<nav id="void-nav">
			
				<ul id="nav-left">
				  <li><b href="/">
            <img src="/evolutionos.png" alt="EvolutionOS Logo">
          </b></li>
        </ul>
        <ul>
          <li><ao href="/download">Download</ao>
					<li><ao href="/wiki">Wiki</ao></li>
					<li><ao href="https://github.com/evolution-linux/evolution-linux.github.io">Source Code</a></li>
					<ao onclick="toggleDarkMode()" class="dark-mode-button">Toggle Dark Mode</ao>
				</ul>
				
				<ul>
					<li><a id="skip-to-content" tabindex="1" href="#main">Skip to content</a></li>
					<li>
						<button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
							<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
								<path d="M1 3v2h18V3zm0 8h18V9H1zm0 6h18v-2H1z"/>
							</svg>
						</button>
					</li>
					<li>
						<button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
							<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
								<path d="M7.5 13c3.04 0 5.5-2.46 5.5-5.5S10.54 2 7.5 2 2 4.46 2 7.5 4.46 13 7.5 13zm4.55.46C10.79 14.43 9.21 15 7.5 15 3.36 15 0 11.64 0 7.5S3.36 0 7.5 0C11.64 0 15 3.36 15 7.5c0 1.71-.57 3.29-1.54 4.55l6.49 6.49-1.41 1.41-6.49-6.49z"/>
							</svg>
						</button>
					</li>
                                        <noscript>
                                          <li class="js-unavailable">Search functionality requires JavaScript</li>
                                        </noscript>
				</ul>
				
			</nav>
		</header>

		<div id="content">

			<!-- Hide / unhide sidebar before it is displayed -->
			<script type="text/javascript">
				var html = document.querySelector('html');
				var sidebar = 'hidden';
				if (document.body.clientWidth >= 1080) {
					try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
					sidebar = sidebar || 'visible';
				}
				html.classList.remove('sidebar-visible');
				html.classList.add("sidebar-" + sidebar);
			</script>

			<nav id="sidebar" aria-label="Table of contents">
				<ol class="chapter"><li class="chapter-item expanded "><a href="about/index.html"><strong aria-hidden="true">1.</strong> About</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="about/history.html"><strong aria-hidden="true">1.1.</strong> History</a></li><li class="chapter-item expanded "><a href="about/about-this-handbook.html"><strong aria-hidden="true">1.2.</strong> About This Handbook</a></li><li class="chapter-item expanded "><a href="about/infradocs.html"><strong aria-hidden="true">1.3.</strong> InfraDocs</a></li></ol></li><li class="chapter-item expanded "><a href="installation/index.html"><strong aria-hidden="true">2.</strong> Installation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="installation/live-images/index.html"><strong aria-hidden="true">2.1.</strong> Live Installers</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="installation/live-images/prep.html"><strong aria-hidden="true">2.1.1.</strong> Prepare Installation Media</a></li><li class="chapter-item expanded "><a href="installation/live-images/partitions.html"><strong aria-hidden="true">2.1.2.</strong> Partitioning Notes</a></li><li class="chapter-item expanded "><a href="installation/live-images/guide.html"><strong aria-hidden="true">2.1.3.</strong> Installation Guide</a></li></ol></li><li class="chapter-item expanded "><a href="installation/guides/index.html"><strong aria-hidden="true">2.2.</strong> Advanced Installation Guides</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="installation/guides/chroot.html"><strong aria-hidden="true">2.2.1.</strong> Installation via chroot (x86/x86_64/aarch64)</a></li><li class="chapter-item expanded "><a href="installation/guides/fde.html"><strong aria-hidden="true">2.2.2.</strong> Full Disk Encryption</a></li><li class="chapter-item expanded "><a href="installation/guides/zfs.html"><strong aria-hidden="true">2.2.3.</strong> Root on ZFS</a></li><li class="chapter-item expanded "><a href="installation/guides/arm-devices/index.html"><strong aria-hidden="true">2.2.4.</strong> ARM Devices</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="installation/guides/arm-devices/platforms.html"><strong aria-hidden="true">2.2.4.1.</strong> Supported Platforms</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="installation/musl.html"><strong aria-hidden="true">2.3.</strong> musl</a></li></ol></li><li class="chapter-item expanded "><a href="config/index.html"><strong aria-hidden="true">3.</strong> Configuration</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="config/package-documentation/index.html"><strong aria-hidden="true">3.1.</strong> Package Documentation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="config/package-documentation/man.html"><strong aria-hidden="true">3.1.1.</strong> Manual Pages</a></li></ol></li><li class="chapter-item expanded "><a href="config/firmware.html"><strong aria-hidden="true">3.2.</strong> Firmware</a></li><li class="chapter-item expanded "><a href="config/locales.html"><strong aria-hidden="true">3.3.</strong> Locales and Translations</a></li><li class="chapter-item expanded "><a href="config/users-and-groups.html"><strong aria-hidden="true">3.4.</strong> Users and Groups</a></li><li class="chapter-item expanded "><a href="config/services/index.html"><strong aria-hidden="true">3.5.</strong> Services and Daemons - runit</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="config/services/user-services.html"><strong aria-hidden="true">3.5.1.</strong> Per-User Services</a></li><li class="chapter-item expanded "><a href="config/services/logging.html"><strong aria-hidden="true">3.5.2.</strong> Logging</a></li></ol></li><li class="chapter-item expanded "><a href="config/rc-files.html"><strong aria-hidden="true">3.6.</strong> rc.conf, rc.local and rc.shutdown</a></li><li class="chapter-item expanded "><a href="config/cron.html"><strong aria-hidden="true">3.7.</strong> Cron</a></li><li class="chapter-item expanded "><a href="config/ssd.html"><strong aria-hidden="true">3.8.</strong> Solid State Drives</a></li><li class="chapter-item expanded "><a href="config/security/index.html"><strong aria-hidden="true">3.9.</strong> Security</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="config/security/apparmor.html"><strong aria-hidden="true">3.9.1.</strong> AppArmor</a></li></ol></li><li class="chapter-item expanded "><a href="config/date-time.html"><strong aria-hidden="true">3.10.</strong> Date and Time</a></li><li class="chapter-item expanded "><a href="config/kernel.html"><strong aria-hidden="true">3.11.</strong> Kernel</a></li><li class="chapter-item expanded "><a href="config/power-management.html"><strong aria-hidden="true">3.12.</strong> Power Management</a></li><li class="chapter-item expanded "><a href="config/network/index.html"><strong aria-hidden="true">3.13.</strong> Network</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="config/network/firewalls.html"><strong aria-hidden="true">3.13.1.</strong> Firewalls</a></li><li class="chapter-item expanded "><a href="config/network/wpa_supplicant.html"><strong aria-hidden="true">3.13.2.</strong> wpa_supplicant</a></li><li class="chapter-item expanded "><a href="config/network/iwd.html"><strong aria-hidden="true">3.13.3.</strong> IWD</a></li><li class="chapter-item expanded "><a href="config/network/networkmanager.html"><strong aria-hidden="true">3.13.4.</strong> NetworkManager</a></li><li class="chapter-item expanded "><a href="config/network/connman.html"><strong aria-hidden="true">3.13.5.</strong> ConnMan</a></li></ol></li><li class="chapter-item expanded "><a href="config/network-filesystems.html"><strong aria-hidden="true">3.14.</strong> Network Filesystems</a></li><li class="chapter-item expanded "><a href="config/session-management.html"><strong aria-hidden="true">3.15.</strong> Session and Seat Management</a></li><li class="chapter-item expanded "><a href="config/graphical-session/index.html"><strong aria-hidden="true">3.16.</strong> Graphical Session</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="config/graphical-session/graphics-drivers/index.html"><strong aria-hidden="true">3.16.1.</strong> Graphics Drivers</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="config/graphical-session/graphics-drivers/amd.html"><strong aria-hidden="true">3.16.1.1.</strong> AMD or ATI</a></li><li class="chapter-item expanded "><a href="config/graphical-session/graphics-drivers/intel.html"><strong aria-hidden="true">3.16.1.2.</strong> Intel</a></li><li class="chapter-item expanded "><a href="config/graphical-session/graphics-drivers/nvidia.html"><strong aria-hidden="true">3.16.1.3.</strong> NVIDIA</a></li><li class="chapter-item expanded "><a href="config/graphical-session/graphics-drivers/optimus.html"><strong aria-hidden="true">3.16.1.4.</strong> NVIDIA Optimus</a></li></ol></li><li class="chapter-item expanded "><a href="config/graphical-session/xorg.html"><strong aria-hidden="true">3.16.2.</strong> Xorg</a></li><li class="chapter-item expanded "><a href="config/graphical-session/wayland.html"><strong aria-hidden="true">3.16.3.</strong> Wayland</a></li><li class="chapter-item expanded "><a href="config/graphical-session/fonts.html"><strong aria-hidden="true">3.16.4.</strong> Fonts</a></li><li class="chapter-item expanded "><a href="config/graphical-session/icons.html"><strong aria-hidden="true">3.16.5.</strong> Icons</a></li><li class="chapter-item expanded "><a href="config/graphical-session/gnome.html"><strong aria-hidden="true">3.16.6.</strong> GNOME</a></li><li class="chapter-item expanded "><a href="config/graphical-session/kde.html"><strong aria-hidden="true">3.16.7.</strong> KDE</a></li></ol></li><li class="chapter-item expanded "><a href="config/media/index.html"><strong aria-hidden="true">3.17.</strong> Multimedia</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="config/media/alsa.html"><strong aria-hidden="true">3.17.1.</strong> ALSA</a></li><li class="chapter-item expanded "><a href="config/media/pipewire.html"><strong aria-hidden="true">3.17.2.</strong> PipeWire</a></li><li class="chapter-item expanded "><a href="config/media/pulseaudio.html"><strong aria-hidden="true">3.17.3.</strong> PulseAudio</a></li><li class="chapter-item expanded "><a href="config/media/sndio.html"><strong aria-hidden="true">3.17.4.</strong> sndio</a></li></ol></li><li class="chapter-item expanded "><a href="config/bluetooth.html"><strong aria-hidden="true">3.18.</strong> Bluetooth</a></li><li class="chapter-item expanded "><a href="config/texlive.html"><strong aria-hidden="true">3.19.</strong> TeX Live</a></li><li class="chapter-item expanded "><a href="config/external-applications.html"><strong aria-hidden="true">3.20.</strong> External Applications</a></li><li class="chapter-item expanded "><a href="config/print/index.html"><strong aria-hidden="true">3.21.</strong> Printing</a></li><li class="chapter-item expanded "><a href="config/containers-and-vms/index.html"><strong aria-hidden="true">3.22.</strong> Containers and Virtual Machines</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="config/containers-and-vms/chroot.html"><strong aria-hidden="true">3.22.1.</strong> Chroots and Containers</a></li><li class="chapter-item expanded "><a href="config/containers-and-vms/libvirt.html"><strong aria-hidden="true">3.22.2.</strong> libvirt</a></li><li class="chapter-item expanded "><a href="config/containers-and-vms/lxc.html"><strong aria-hidden="true">3.22.3.</strong> LXC</a></li></ol></li><li class="chapter-item expanded "><a href="config/openpgp.html"><strong aria-hidden="true">3.23.</strong> OpenPGP</a></li><li class="chapter-item expanded "><a href="config/php.html"><strong aria-hidden="true">3.24.</strong> PHP</a></li></ol></li><li class="chapter-item expanded "><a href="xbps/index.html"><strong aria-hidden="true">4.</strong> XBPS Package Manager</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="xbps/advanced-usage.html"><strong aria-hidden="true">4.1.</strong> Advanced Usage</a></li><li class="chapter-item expanded "><a href="xbps/repositories/index.html"><strong aria-hidden="true">4.2.</strong> Repositories</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="xbps/repositories/mirrors/index.html"><strong aria-hidden="true">4.2.1.</strong> Mirrors</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="xbps/repositories/mirrors/changing.html"><strong aria-hidden="true">4.2.1.1.</strong> Changing Mirrors</a></li><li class="chapter-item expanded "><a href="xbps/repositories/mirrors/tor.html"><strong aria-hidden="true">4.2.1.2.</strong> Using Tor Mirrors</a></li></ol></li><li class="chapter-item expanded "><a href="xbps/repositories/restricted.html"><strong aria-hidden="true">4.2.2.</strong> Restricted Packages</a></li><li class="chapter-item expanded "><a href="xbps/repositories/custom.html"><strong aria-hidden="true">4.2.3.</strong> Custom Repositories</a></li><li class="chapter-item expanded "><a href="xbps/repositories/signing.html"><strong aria-hidden="true">4.2.4.</strong> Signing Repositories</a></li></ol></li><li class="chapter-item expanded "><a href="xbps/troubleshooting/index.html"><strong aria-hidden="true">4.3.</strong> Troubleshooting XBPS</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="xbps/troubleshooting/common-issues.html"><strong aria-hidden="true">4.3.1.</strong> Common Issues</a></li><li class="chapter-item expanded "><a href="xbps/troubleshooting/static.html"><strong aria-hidden="true">4.3.2.</strong> Static XBPS</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="contributing/index.html"><strong aria-hidden="true">5.</strong> Contributing</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="contributing/evolution-docs/index.html"><strong aria-hidden="true">5.1.</strong> Contributing To evolution-docs</a></li></ol></li></ol>
			</nav>

			<!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
			<script type="text/javascript">
				document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
	document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
	Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
		link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
	});
			</script>

			<div id="page-wrapper">
				<div id="search-wrapper" class="hidden">
					<form id="searchbar-outer" class="searchbar-outer">
						<input type="search" name="search" id="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
					</form>
					<div id="searchresults-outer" class="searchresults-outer hidden">
						<div id="searchresults-header" class="searchresults-header"></div>
						<ul id="searchresults">
						</ul>
					</div>
				</div>

				<main id="main">
					<h1 id="about"><a class="header" href="#about">About</a></h1>
<p>Welcome to the EvolutionOS Handbook! Please be sure to read the &quot;<a href="about/./about-this-handbook.html">About This
Handbook</a>&quot; section to learn how to use this
documentation effectively. A local copy of this handbook, in several formats,
can be <a href="about/../xbps/index.html">installed</a> via the <code>mdocml</code> package and accessed
with the <a href="https://evolution-linux.github.io/wiki">evolution-docs(1)</a> utility.</p>
<p>EvolutionOS is an <a href="https://en.wikipedia.org/wiki/Rolling_release">rolling
release</a> Linux distribution,
developed from scratch rather than as a fork, with a focus on stability over
<a href="https://en.wikipedia.org/wiki/Bleeding_edge_technology">bleeding-edge</a>. In
addition, there are several features that make EvolutionOS unique:</p>
<ul>
<li>
<p>The use of BusyBox over Coreutils, increasing speed and minimalism to an extream</p>
</li>
<li>
<p>The <a href="https://musl.libc.org/">musl libc</a>, which focuses on standards compliance
and correctness, has first class support. This allows us to build certain
components for musl systems statically, which would not be practical on glibc
systems.</p>
</li>
<li>
<p><a href="about/../config/services/index.html">runit</a> is used for
<a href="https://man.voidlinux.org/init.8">init(8)</a> and service supervision. This
allows EvolutionOS to support musl as a second libc choice, which would not be
possible with <a href="https://www.freedesktop.org/wiki/Software/systemd/">systemd</a>.
A side effect of this decision is a core system with clean and efficient
operation, and a small code base.</p>
</li>
<li>
<p>The use of the booster initramfs over dracut, speeding up system startup and
reducing image sizes</p>
</li>
</ul>
<p>EvolutionOS is developed in the spare time of Tracker-Friendly, and is generally
considered stable enough for daily use. I do this for fun and hope that my
work will be useful to others.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="history"><a class="header" href="#history">History</a></h1>
<p>Knowledge of the ancients, grepped from the Git logs themselves:</p>
<ul>
<li>2008-09-26: first Git import of
<a href="https://github.com/void-linux/void-packages">void-packages</a></li>
<li>2009-08-17: first Git import of <a href="https://github.com/void-linux/xbps">xbps</a></li>
<li>2011-06-25: first systemd commit in void-packages</li>
<li>2013-03-01: first <a href="https://musl.libc.org/">musl</a> toolchains added</li>
<li>2014-07-14: begin switching to <a href="https://www.libressl.org/">LibreSSL</a></li>
<li>2014-07-28: switch from systemd to <a href="http://smarden.org/runit/">runit</a></li>
<li>2015-07-09: full aarch64 support with <code>linux4.1</code></li>
<li>2018-07-06: first use of <a href="https://github.com/void-linux/void-infrastructure/tree/master/terraform">Terraform for GitHub
permissions</a>,
for increased transparency</li>
<li>2021-03-05: begin
<a href="https://github.com/void-linux/void-packages/commit/d90dba0ae27c4bb22cbb1722f70e4ed6d599e473">switching</a>
to <a href="https://www.openssl.org/">OpenSSL</a></li>
<li>2023-07-Idk: forked void-packages to evolution-packages</li>
<li>2023-07-Stillidk: created evolution-linux website</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="about-this-handbook"><a class="header" href="#about-this-handbook">About This Handbook</a></h1>
<p>This handbook is not an extensive guide on how to use and configure common Linux
software. The purpose of this document is to explain how to install, configure,
and maintain EvolutionOS systems, and to highlight the differences between common
Linux distributions and EvolutionOS.</p>
<p>To search for a particular term within the Handbook, select the 'magnifying
glass' icon, or press 's'.</p>
<p>Those looking for tips and tricks on how to configure a Linux system in general
should consult upstream software documentation. Additionally, the <a href="https://wiki.archlinux.org/">Arch
Wiki</a> provides a fairly comprehensive outline of
common Linux software configuration, and a variety of internet search engines
are available for further assistance.</p>
<h2 id="reading-the-manuals"><a class="header" href="#reading-the-manuals">Reading The Manuals</a></h2>
<p>While this handbook does not provide a large amount of copy and paste
configuration instructions, it does provide links to the <a href="https://man.voidlinux.org/">man
pages</a> for the referenced software wherever
possible.</p>
<p>To learn how to use the <a href="https://man.voidlinux.org/man.1">man(1)</a> man page
viewer, run the command <code>man man</code>. It can be configured by editing
<code>/etc/man.conf</code>; read <a href="https://man.voidlinux.org/man.conf.5">man.conf(5)</a> for
details.</p>
<p>EvolutionOS commonly uses the <a href="https://mandoc.bsd.lv/">mandoc</a> toolset for man pages. mandoc was
formerly known as &quot;mdocml&quot;, and is provided by the <code>mdocml</code> package.</p>
<h2 id="example-commands"><a class="header" href="#example-commands">Example Commands</a></h2>
<p>Examples in this guide may have snippets of commands to be run in your shell.
When you see these, any line beginning with <code>$</code> is run as your normal user.
Lines beginning with <code>#</code> are run as <code>root</code>. After either of these lines, there
may be example output from the command.</p>
<h3 id="placeholders"><a class="header" href="#placeholders">Placeholders</a></h3>
<p>Some examples include text with placeholders. Placeholders indicate where you
should substitute the appropriate information. For example:</p>
<pre><code># ln -s /etc/sv/&lt;service_name&gt; /var/service/
</code></pre>
<p>This means you need to substitute the text <code>&lt;service_name&gt;</code> with the actual
service name.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="infradocs"><a class="header" href="#infradocs">InfraDocs</a></h1>
<p><a href="https://infradocs.voidlinux.org/">InfraDocs</a> is the meta-manual for the Void
project systems management.</p>
<p>EvolutionOS doesn't not make much use of this system.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installation"><a class="header" href="#installation">Installation</a></h1>
<p>This section includes general information about the process of installing EvolutionOS.
For specific guides, see the &quot;<a href="installation/./guides/index.html">Advanced Installation</a>&quot;
section.</p>
<h2 id="base-system-requirements"><a class="header" href="#base-system-requirements">Base system requirements</a></h2>
<p>EvolutionOS can be installed on very minimalist hardware, though we recommend the
following minimums for most installations:</p>
<div class="table-wrapper"><table><thead><tr><th>Architecture</th><th>CPU</th><th>RAM</th><th>Storage</th></tr></thead><tbody>
<tr><td>x86_64-glibc</td><td>x86_64</td><td>96MB</td><td>700MB</td></tr>
<tr><td>x86_64-musl</td><td>x86_64</td><td>96MB</td><td>600MB</td></tr>
<tr><td>i686-glibc</td><td>Pentium 4 (SSE2)</td><td>96MB</td><td>700MB</td></tr>
</tbody></table>
</div>
<p>Note that xfce image installations require more resources.</p>
<p>EvolutionOS is not available for the i386, i486, or i586 architectures.</p>
<p>Before installing musl EvolutionOS, please read <a href="installation/./musl.html">the &quot;musl&quot; section</a> of this
Handbook, so that you are aware of software incompatibilities.</p>
<p>It is highly recommended to have a network connection available during install
to download updates, but this is not required. ISO images contain installation
data on-disk and can be installed without network connectivity.</p>
<h2 id="downloading-installation-media"><a class="header" href="#downloading-installation-media">Downloading installation media</a></h2>
<p>The most recent live images can be downloaded from
<a href="https://evolution-linux.github.io/download">https://evolution-linux.github.io/download</a>. Previous releases
can be found under <a href="https://github.com/evolution-linux/evolution-linux.github.io/releases">https://github.com/evolution-linux/evolution-linux.github.io/releases</a>, organized by
date.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="live-installers"><a class="header" href="#live-installers">Live Installers</a></h1>
<p>EvolutionOS provides live installer images containing a base set of utilities, an
installer program, and package files to install a new EvolutionOS system. These live
images are also useful for repairing a system that is not able to boot or
function properly.</p>
<p>There are <code>x86_64</code> images for both <code>glibc</code> and <code>musl</code> based systems. There are
also images for <code>i686</code>, but only <code>glibc</code> is supported for this architecture.
Live installers are not provided for other architectures. Users of other
architectures will need to use rootfs tarballs, or perform an installation
manually.</p>
<h2 id="installer-images"><a class="header" href="#installer-images">Installer images</a></h2>
<p>EvolutionOS releases two types of images: base images and xfce images. Linux beginners
are encouraged to try one of the more full-featured xfce images, but more
advanced users may often prefer to start from a base image to install only the
packages they need.</p>
<h3 id="base-images"><a class="header" href="#base-images">Base images</a></h3>
<p>The base images provide only a minimal set of packages to install a usable EvolutionOS
system. These base packages are only those needed to configure a new machine,
update the system, and install additional packages from repositories.</p>
<h3 id="xfce-image"><a class="header" href="#xfce-image">Xfce image</a></h3>
<p>The xfce image includes a full desktop environment, web browser, and basic
applications configured for that environment. The only difference from the base
images is the additional packages and services installed.</p>
<p>The following software is included:</p>
<ul>
<li><strong>Window manager:</strong> xfwm4</li>
<li><strong>File manager:</strong> Thunar</li>
<li><strong>Web Browser:</strong> Firefox</li>
<li><strong>Terminal:</strong> xfce4-terminal</li>
<li><strong>Plain text editor:</strong> Mousepad</li>
<li><strong>Image viewer:</strong> Ristretto</li>
<li><strong>Other:</strong> Bulk rename, Orage Globaltime, Orage Calendar, Task Manager, Parole
Media Player, Audio Mixer, MIME type editor, Application finder</li>
</ul>
<p>The install process for the xfce image is the same as the base images, except
that you <strong>must</strong> select the <code>Local</code> source when installing. If you select
<code>Network</code> instead, the installer will download and install the latest version of
the base system, without any additional packages included on the live image.</p>
<h2 id="accessibility-support"><a class="header" href="#accessibility-support">Accessibility support</a></h2>
<p>All EvolutionOS images support the console screenreader
<a href="https://man.voidlinux.org/espeakup.8">espeakup</a> and the console braille display
driver <a href="https://man.voidlinux.org/brltty.1">brltty</a>. These services can be
enabled at boot by pressing <code>s</code> in the bootloader menu to enable accessibility
support. On UEFI-based systems, GRUB is the bootloader, and it will play a
two-tone chime when the menu is available. On BIOS-based systems and UEFI
systems in legacy/compatibility mode, SYSLINUX is the bootloader, and no chime
is played. SYSLINUX also requires pressing the enter key after pressing <code>s</code>. The
hotkey <code>r</code> will also boot with accessibility support, but will load the live ISO
into RAM.</p>
<p>After booting into the installer image with accessibility support enabled, if
there are multiple soundcards detected, a short audio menu allows for the
selection of the soundcard for the screenreader. Press enter when the beep for
the desired soundcard is heard to select it.</p>
<p>If the <code>Local</code> installation source is selected in the installer, <code>espeakup</code> and
<code>brltty</code> will also be installed and enabled on the installed system if enabled
in the live environment.</p>
<p>The xfce image also supports the graphical screenreader
<a href="https://man.voidlinux.org/orca.1">orca</a>. This can be enabled by pressing <code>Win + R</code> and entering <code>orca -r</code>. Orca will also be available on the installed system
if the <code>Local</code> installation source is selected.</p>
<h2 id="kernel-command-line-parameters"><a class="header" href="#kernel-command-line-parameters">Kernel Command-line Parameters</a></h2>
<p>EvolutionOS installer images support several kernel command-line arguments that can
change the behavior of the live system. See <a href="https://github.com/evolution-linux/evolution-installer#kernel-command-line-parameters">the evolution-installer README for a full
list</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="prepare-installation-media"><a class="header" href="#prepare-installation-media">Prepare Installation Media</a></h1>
<p>After <a href="installation/live-images/../index.html#downloading-installation-media">downloading a live image</a>, it
must be written to bootable media, such as a USB drive, SD card, or CD/DVD.</p>
<h2 id="create-a-bootable-usb-drive-or-sd-card-on-linux"><a class="header" href="#create-a-bootable-usb-drive-or-sd-card-on-linux">Create a bootable USB drive or SD card on Linux</a></h2>
<h3 id="identify-the-device"><a class="header" href="#identify-the-device">Identify the Device</a></h3>
<p>Before writing the image, identify the device you'll write it to. You can do
this using <a href="https://man.voidlinux.org/man8/fdisk.8">fdisk(8)</a>. After connecting
the storage device, identify the device path by running:</p>
<pre><code># fdisk -l
Disk /dev/sda: 7.5 GiB, 8036286464 bytes, 15695872 sectors
Disk model: Your USB Device's Model
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
</code></pre>
<p>In the example above, the output shows the USB device as <code>/dev/sda</code>. On Linux,
the path to the device will typically be in the form of <code>/dev/sdX</code> (where X is a
letter) for USB devices, <code>/dev/mmcblkX</code> for SD cards, or other variations
depending on the device. You can use the model and size (<code>7.5GiB</code> above, after
the path) to identify the device if you're not sure what path it will have.</p>
<p>Once you've identified the device you'll use, ensure it's <strong>not</strong> mounted by
unmounting it with <a href="https://man.voidlinux.org/man8/umount.8">umount(8)</a>:</p>
<pre><code># umount /dev/sdX
umount: /dev/sdX: not mounted.
</code></pre>
<h3 id="write-the-live-image"><a class="header" href="#write-the-live-image">Write the live image</a></h3>
<p>The <a href="https://man.voidlinux.org/man1/dd.1">dd(1)</a> command can be used to copy a
live image to a storage device. Using <code>dd</code>, write the live image to the device:</p>
<p><strong>Warning</strong>: this will destroy any data currently on the referenced device.
Exercise caution.</p>
<pre><code># dd bs=4M if=/path/to/x86_64.iso of=/dev/sdX
90+0 records in
90+0 records out
377487360 bytes (377 MB, 360 MiB) copied, 0.461442 s, 818 MB/s
</code></pre>
<p><code>dd</code> won't print anything until it's completed (or if it failed), so, depending
on the device, this can take a few minutes or longer. You can enable printing by
adding <code>status=progress</code> to the command if using GNU coreutils <code>dd</code>.</p>
<p>Finally, ensure all data is flushed before disconnecting the device:</p>
<pre><code>$ sync
</code></pre>
<p>The number of records, amount copied, and rates will all vary depending on the
device and the live image you chose.</p>
<h2 id="burning-to-a-cd-or-dvd"><a class="header" href="#burning-to-a-cd-or-dvd">Burning to a CD or DVD</a></h2>
<p>Any disk burning application should be capable of writing the <code>.iso</code> file to a
CD or DVD. The following free software applications are available
(cross-platform support may vary):</p>
<ul>
<li><a href="https://wiki.gnome.org/Apps/Brasero/">Brasero</a></li>
<li><a href="https://userbase.kde.org/K3b">K3B</a></li>
<li><a href="https://docs.xfce.org/apps/xfburn/start">Xfburn</a></li>
</ul>
<p>It should be noted that, with a CD or DVD, live sessions will be less responsive
than with a USB stick or hard drive.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="partitioning-notes"><a class="header" href="#partitioning-notes">Partitioning Notes</a></h1>
<p>Partitioning for a modern Linux distribution is generally very simple, however
the introduction of GPT and UEFI booting does bring new complexity to the
process. When creating your new partition table you will need a partition for
the root filesystem, along with a swap partition and possibly another partition
or two to facilitate booting, if required.</p>
<p>Note that if the disk has already been initialized, the top of the <code>cfdisk</code>
screen will show the partition layout already present: <code>Label: dos</code> for the MBR
scheme, <code>Label: gpt</code> for the GPT scheme. If you just want to erase the partition
table before starting the installer, use <code>wipefs(8)</code>. Otherwise, you can run
<code>cfdisk(8)</code> manually with the <code>-z</code> option to start with an uninitialized disk
layout; <code>cfdisk</code> will prompt you for the label type before continuing to the
main screen.</p>
<p>The following sections will detail the options for partition configuration.</p>
<h2 id="bios-system-notes"><a class="header" href="#bios-system-notes">BIOS system notes</a></h2>
<p>It is recommended that you create an MBR partition table if you are using a BIOS
boot system. This will limit the number of partitions you create to four.</p>
<p>It is possible to use a GPT partition table on a BIOS system, but GRUB will
require a special partition to boot properly. This partition should be at the
beginning of your disk and have a size of 1MB, with type <code>BIOS boot</code> (GUID
<code>21686148-6449-6E6F-744E-656564454649</code>). Don't create any filesystem in it. GRUB
should then install itself successfully.</p>
<h2 id="uefi-system-notes"><a class="header" href="#uefi-system-notes">UEFI system notes</a></h2>
<p>UEFI users are recommended to create a GPT partition table. UEFI booting with
GRUB also requires a special partition of the type <code>EFI System</code> with a <code>vfat</code>
filesystem mounted at <code>/boot/efi</code>. A reasonable size for this partition could be
between 200MB and 1GB. With this partition setup during the live image
installation, the installer should successfully set up the bootloader
automatically.</p>
<h2 id="swap-partitions"><a class="header" href="#swap-partitions">Swap partitions</a></h2>
<p>A swap partition is not strictly required, but recommended for systems with low
RAM. If you want to use hibernation, you will need a swap partition. The
following table has recommendations for swap partition size.</p>
<div class="table-wrapper"><table><thead><tr><th>System RAM</th><th>Recommended swap space</th><th>Swap space if using hibernation</th></tr></thead><tbody>
<tr><td>&lt; 2GB</td><td>2x the amount of RAM</td><td>3x the amount of RAM</td></tr>
<tr><td>2-8GB</td><td>Equal to amount of RAM</td><td>2x the amount of RAM</td></tr>
<tr><td>8-64GB</td><td>At least 4GB</td><td>1.5x the amount of RAM</td></tr>
<tr><td>64GB</td><td>At least 4GB</td><td>Hibernation not recommended</td></tr>
</tbody></table>
</div>
<h2 id="boot-partition-optional"><a class="header" href="#boot-partition-optional">Boot partition (optional)</a></h2>
<p>On most modern systems, a separate <code>/boot</code> partition is no longer necessary to
boot properly. If you choose to use one, note that EvolutionOS does not remove old
kernels after updates by default and also that the kernel tends to increase in
size with each new version, so plan accordingly (e.g. <code>/boot</code> with one Linux 5.x
<code>x86_64</code> kernel and GRUB occupies about 60MB).</p>
<h2 id="other-partitions"><a class="header" href="#other-partitions">Other partitions</a></h2>
<p>It is fine to install your system with only a large root partition, but you may
create other partitions if you want. One helpful addition could be a separate
partition for your <code>/home</code> directory. This way if you need to reinstall EvolutionOS (or
another distribution) you can save the data and configuration files in your home
directory for your new system.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installation-guide"><a class="header" href="#installation-guide">Installation Guide</a></h1>
<p>Once you have <a href="installation/live-images/../index.html#downloading-installation-media">downloaded</a> a EvolutionOS
image to install and <a href="installation/live-images/./prep.html">prepared</a> your install media, you are ready to
install EvolutionOS Linux.</p>
<p>Before you begin installation, you should determine whether your machine boots
using BIOS or UEFI. This will affect how you plan partitions. See <a href="installation/live-images/./partitions.html">Partitioning
Notes</a> for more detail.</p>
<p>The following features are not supported by the installer script:</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Logical_volume_management">LVM</a></li>
<li><a href="https://en.wikipedia.org/wiki/Linux_Unified_Key_Setup">LUKS</a></li>
<li><a href="https://en.wikipedia.org/wiki/ZFS">ZFS</a></li>
</ul>
<h2 id="booting"><a class="header" href="#booting">Booting</a></h2>
<p>Boot your machine from the install media you created. If you have enough RAM,
there is an option on the boot screen to load the entire image into ram, which
will take some time but speed up the rest of the install process.</p>
<p>Once the live image has booted, it will autologin and run</p>
<pre><code># evolution-installer
</code></pre>
<p>The following sections will detail each screen of the installer.</p>
<h2 id="keyboard"><a class="header" href="#keyboard">Keyboard</a></h2>
<p>Select the keymap for your keyboard; standard &quot;qwerty&quot; keyboards will generally
use the &quot;us&quot; keymap.</p>
<h2 id="network"><a class="header" href="#network">Network</a></h2>
<p>Select your primary network interface. If you do not choose to use DHCP, you
will be prompted to provide an IP address, gateway, and DNS servers.</p>
<p>If you choose a wireless network interface, you will be prompted to provide the
SSID, encryption type (<code>wpa</code> or <code>wep</code>), and password. If <code>evolution-installer</code> fails
to connect to your network, you may need to exit the installer and configure it
manually using <a href="installation/live-images/../../config/network/wpa_supplicant.html">wpa_supplicant</a> and
<a href="installation/live-images/../../config/network/index.html#dhcpcd">dhcpcd</a> before continuing.</p>
<h2 id="source"><a class="header" href="#source">Source</a></h2>
<p>To install packages provided on the install image, select <code>Local</code>. Otherwise,
you may select <code>Network</code> to download the latest packages from the EvolutionOS
repository.</p>
<blockquote>
<p><strong>Warning:</strong> If you are installing the desktop environment from the xfce
image, you MUST choose <code>Local</code> for the source!</p>
</blockquote>
<h2 id="hostname"><a class="header" href="#hostname">Hostname</a></h2>
<p>Select a hostname for your computer (that is all lowercase, with no spaces.)</p>
<h2 id="locale"><a class="header" href="#locale">Locale</a></h2>
<p>Select your default locale settings. This option is for glibc only, as musl does
not currently support locales.</p>
<h2 id="timezone"><a class="header" href="#timezone">Timezone</a></h2>
<p>Select your timezone based on standard timezone options.</p>
<h2 id="root-password"><a class="header" href="#root-password">Root password</a></h2>
<p>Enter and confirm your <code>root</code> password for the new installation. The password
will not be shown on screen.</p>
<h2 id="user-account"><a class="header" href="#user-account">User account</a></h2>
<p>Choose a login (default <code>evolution</code>) and a descriptive name for that login. Then
enter and confirm the password for the new user. You will then be prompted to
verify the groups for this new user. They are added to the <code>wheel</code> group by
default and will have <code>sudo</code> access. Default groups and their descriptions are
listed <a href="installation/live-images/../../config/users-and-groups.html#default-groups">here</a>.</p>
<p>Login names have some restrictions, as described in
<a href="https://man.voidlinux.org/useradd.8#CAVEATS">useradd(8)</a>.</p>
<h2 id="bootloader"><a class="header" href="#bootloader">Bootloader</a></h2>
<p>Select the disk to install a bootloader on when EvolutionOS is installed. You may
select <code>none</code> to skip this step and install a bootloader manually after
completing the installation process. If installing a bootloader, you will also
be asked whether or not you want a graphical terminal for the GRUB menu.</p>
<h2 id="partition"><a class="header" href="#partition">Partition</a></h2>
<p>Next, you will need to partition your disks. EvolutionOS not provide a preset
partition scheme, so you will need to create your partitions manually with
<a href="https://man.voidlinux.org/cfdisk.8">cfdisk(8)</a>. You will be prompted with a
list of disks. Select the disk you want to partition and the installer will
launch <code>cfdisk</code> for that disk. Remember you must write the partition table to
the drive before you exit the partition editor.</p>
<p>If using UEFI, it is recommended you select GPT for the partition table and
create a partition (typically between 200MB-1GB) of type <code>EFI System</code>, which
will be mounted at <code>/boot/efi</code>.</p>
<p>If using BIOS, it is recommended you select MBR for the partition table.
Advanced users may use GPT but will need to <a href="installation/live-images/./partitions.html#bios-system-notes">create a special BIOS
partition</a> for GRUB to boot.</p>
<p>See the <a href="installation/live-images/./partitions.html">Partitioning Notes</a> for more details about
partitioning your disk.</p>
<h2 id="filesystems"><a class="header" href="#filesystems">Filesystems</a></h2>
<p>Create the filesystems for each partition you have created. For each partition
you will be prompted to choose a filesystem type, whether you want to create a
new filesystem on the partition, and a mount point, if applicable. When you are
finished, select <code>Done</code> to return to the main menu.</p>
<p>If using UEFI, create a <code>vfat</code> filesystem and mount it at <code>/boot/efi</code>.</p>
<h2 id="review-settings"><a class="header" href="#review-settings">Review settings</a></h2>
<p>It is a good idea to review your settings before proceeding. Use the right arrow
key to select the settings button and hit <code>&lt;enter&gt;</code>. All your selections will be
shown for review.</p>
<h2 id="install"><a class="header" href="#install">Install</a></h2>
<p>Selecting <code>Install</code> from the menu will start the installer. The installer will
create all the filesystems selected, and install the base system packages. It
will then generate an initramfs and install a GRUB2 bootloader to the bootable
partition.</p>
<p>These steps will all run automatically, and after the installation is completed
successfully, you can reboot into your new EvolutionOS install!</p>
<h2 id="post-installation"><a class="header" href="#post-installation">Post installation</a></h2>
<p>After booting into your EvolutionOS installation for the first time, <a href="installation/live-images/../../xbps/index.html#updating">perform a system
update</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="advanced-installation-guides"><a class="header" href="#advanced-installation-guides">Advanced Installation Guides</a></h1>
<p>This section contains guides for more specific or complex use-cases.</p>
<h2 id="section-contents"><a class="header" href="#section-contents">Section Contents</a></h2>
<ul>
<li><a href="installation/guides/./chroot.html">Installing evolutionOS via chroot (x86 or x86_64)</a></li>
<li><a href="installation/guides/./fde.html">Installing evolutionOS with Full Disk Encryption</a></li>
<li><a href="installation/guides/./zfs.html">Installing evolutionOS on a ZFS Root</a></li>
<li><a href="installation/guides/./arm-devices/index.html">ARM Devices</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installation-via-chroot-x86x86_64aarch64"><a class="header" href="#installation-via-chroot-x86x86_64aarch64">Installation via chroot (x86/x86_64/aarch64)</a></h1>
<p>This guide details the process of manually installing EvolutionOS via a chroot on an
x86, x86_64 or aarch64 architecture. It is assumed that you have a familiarity
with Linux, but not necessarily with installing a Linux system via a chroot.
This guide can be used to create a &quot;typical&quot; setup, using a single partition on
a single SATA/IDE/USB disk. Each step may be modified to create less typical
setups, such as <a href="installation/guides/./fde.html">full disk encryption</a>.</p>
<p>EvolutionOS provides two options for bootstrapping the new installation. The <strong>XBPS
method</strong> uses the <a href="installation/guides/../../xbps/index.html">XBPS Package Manager</a> running on a host
operating system to install the base system. The <strong>ROOTFS method</strong> installs the
base system by unpacking a ROOTFS tarball.</p>
<p>The <strong>XBPS method</strong> requires that the host operating system have XBPS installed.
This may be an existing installation of EvolutionOS, an official <a href="installation/guides/../live-images/prep.html">live
image</a>, or any Linux installation running a <a href="installation/guides/../../xbps/troubleshooting/static.html">statically
linked XBPS</a>.</p>
<h2 id="prepare-filesystems"><a class="header" href="#prepare-filesystems">Prepare Filesystems</a></h2>
<p><a href="installation/guides/../live-images/partitions.html">Partition your disks</a> and format them using
<a href="https://man.voidlinux.org/mke2fs.8">mke2fs(8)</a>,
<a href="https://man.voidlinux.org/mkfs.xfs.8">mkfs.xfs(8)</a>,
<a href="https://man.voidlinux.org/mkfs.btrfs.8">mkfs.btrfs(8)</a> or whatever tools are
necessary for your filesystem(s) of choice.</p>
<p><a href="https://man.voidlinux.org/mkfs.vfat.8">mkfs.vfat(8)</a> is also available to
create FAT32 partitions. However, due to restrictions associated with FAT
filesystems, it should only be used when no other filesystem is suitable (such
as for the EFI System Partition).</p>
<p><a href="https://man.voidlinux.org/cfdisk.8">cfdisk(8)</a> and
<a href="https://man.voidlinux.org/fdisk.8">fdisk(8)</a> are available on the live images
for partitioning, but you may wish to use
<a href="https://man.voidlinux.org/gdisk.8">gdisk(8)</a> (from the package <code>gptfdisk</code>) or
<a href="https://man.voidlinux.org/parted.8">parted(8)</a> instead.</p>
<p>For a UEFI booting system, make sure to create an EFI System Partition (ESP).
The ESP should have the partition type &quot;EFI System&quot; (code <code>EF00</code>) and be
formatted as FAT32 using <a href="https://man.voidlinux.org/mkfs.vfat.8">mkfs.vfat(8)</a>.</p>
<p>If you're unsure what partitions to create, create a 1GB partition of type &quot;EFI
System&quot; (code <code>EF00</code>), then create a second partition of type &quot;Linux Filesystem&quot;
(code <code>8300</code>) using the remainder of the drive.</p>
<p>Format these partitions as FAT32 and ext4, respectively:</p>
<pre><code># mkfs.vfat /dev/sda1
# mkfs.ext4 /dev/sda2
</code></pre>
<h3 id="create-a-new-root-and-mount-filesystems"><a class="header" href="#create-a-new-root-and-mount-filesystems">Create a New Root and Mount Filesystems</a></h3>
<p>This guide will assume the new root filesystem is mounted on <code>/mnt</code>. You may
wish to mount it elsewhere.</p>
<p>If using UEFI, mount the EFI System Partition as <code>/mnt/boot/efi</code>.</p>
<p>For example, if <code>/dev/sda2</code> is to be mounted as <code>/</code> and <code>dev/sda1</code> is the EFI
System Partition:</p>
<pre><code># mount /dev/sda2 /mnt/
# mkdir -p /mnt/boot/efi/
# mount /dev/sda1 /mnt/boot/efi/
</code></pre>
<p>Initialize swap space, if desired, using
<a href="https://man.voidlinux.org/mkswap.8">mkswap(8)</a>.</p>
<h2 id="base-installation"><a class="header" href="#base-installation">Base Installation</a></h2>
<p>Follow only one of the two following subsections.</p>
<p>If on aarch64, it will be necessary to install a kernel package in addition to
<code>base-system</code>. For example, <code>linux</code> is a kernel package that points to the
latest stable kernel packaged by EvolutionOS.</p>
<h3 id="the-xbps-method"><a class="header" href="#the-xbps-method">The XBPS Method</a></h3>
<p>Select a <a href="installation/guides/../../xbps/repositories/mirrors/index.html">mirror</a> and <strong>use the</strong>
<a href="installation/guides/../../xbps/repositories/index.html#the-main-repository"><strong>appropriate URL</strong></a> for
the type of system you wish to install. For simplicity, save this URL to a shell
variable. A glibc installation, for example, would use:</p>
<pre><code># REPO=https://evolution-linux.github.io/pkg
# REPO=https://repo-default.voidlinux.org/current
</code></pre>
<p>XBPS also needs to know what architecture is being installed. Available options
are <code>x86_64</code>, <code>x86_64-musl</code>, <code>i686</code> for PC architecture computers and <code>aarch64</code>.
For example:</p>
<pre><code># ARCH=x86_64
</code></pre>
<p>This architecture must be compatible with your current operating system, but
does not need to be the same. If your host is running an x86_64 operating
system, any of the three architectures can be installed (whether the host is
musl or glibc), but an i686 host can only install i686 distributions.</p>
<p>Copy the RSA keys from the installation medium to the target root directory:</p>
<pre><code># mkdir -p /mnt/var/db/xbps/keys
# cp /var/db/xbps/keys/* /mnt/var/db/xbps/keys/
</code></pre>
<p>Use <a href="https://man.voidlinux.org/xbps-install.1">xbps-install(1)</a> to bootstrap the
installation by installing the <code>base-system</code> metapackage:</p>
<pre><code># XBPS_ARCH=$ARCH xbps-install -S -r /mnt -R &quot;$REPO&quot; base-system
</code></pre>
<h2 id="configuration"><a class="header" href="#configuration">Configuration</a></h2>
<p>With the exception of the section &quot;Install base-system (ROOTFS method only)&quot;,
the remainder of this guide is common to both the XBPS and ROOTFS installation
methods.</p>
<h3 id="entering-the-chroot"><a class="header" href="#entering-the-chroot">Entering the Chroot</a></h3>
<p><a href="https://man.voidlinux.org/xchroot.1">xchroot(1)</a> (from <code>xtools</code>) can be used to
set up and enter the chroot. Alternatively, this can be <a href="installation/guides/../../config/containers-and-vms/chroot.html#manual-method">done
manually</a>.</p>
<pre><code># xchroot /mnt /bin/bash
</code></pre>
<h3 id="installation-configuration"><a class="header" href="#installation-configuration">Installation Configuration</a></h3>
<p>Specify the hostname in <code>/etc/hostname</code>. Go through the options in
<a href="installation/guides/../../config/rc-files.html#rcconf"><code>/etc/rc.conf</code></a>. If installing a glibc
distribution, edit <code>/etc/default/libc-locales</code>, uncommenting desired
<a href="installation/guides/../../config/locales.html">locales</a>.</p>
<p><a href="https://man.voidlinux.org/nvi.1">nvi(1)</a> is available in the chroot, but you
may wish to install your preferred text editor at this time.</p>
<p>For glibc builds, generate locale files with:</p>
<pre><code>[xchroot /mnt] # xbps-reconfigure -f glibc-locales
</code></pre>
<h3 id="set-a-root-password"><a class="header" href="#set-a-root-password">Set a Root Password</a></h3>
<p><a href="installation/guides/../../config/users-and-groups.html">Configure at least one super user account</a>.
Other user accounts can be configured later, but there should either be a root
password, or a new user account with <a href="https://man.voidlinux.org/sudo.8">sudo(8)</a>
privileges.</p>
<p>To set a root password, run:</p>
<pre><code>[xchroot /mnt] # passwd
</code></pre>
<h3 id="configure-fstab"><a class="header" href="#configure-fstab">Configure fstab</a></h3>
<p>The <a href="https://man.voidlinux.org/fstab.5">fstab(5)</a> file can be automatically
generated from currently mounted filesystems by copying the file <code>/proc/mounts</code>:</p>
<pre><code>[xchroot /mnt] # cp /proc/mounts /etc/fstab
</code></pre>
<p>Remove lines in <code>/etc/fstab</code> that refer to <code>proc</code>, <code>sys</code>, <code>devtmpfs</code> and <code>pts</code>.</p>
<p>Replace references to <code>/dev/sdXX</code>, <code>/dev/nvmeXnYpZ</code>, etc. with their respective
UUID, which can be found by running
<a href="https://man.voidlinux.org/blkid.8">blkid(8)</a>. Referring to filesystems by their
UUID guarantees they will be found even if they are assigned a different name at
a later time. In some situations, such as booting from USB, this is absolutely
essential. In other situations, disks will always have the same name unless
drives are physically added or removed. Therefore, this step may not be strictly
necessary, but is almost always recommended.</p>
<p>Change the last zero of the entry for <code>/</code> to <code>1</code>, and the last zero of every
other line to <code>2</code>. These values configure the behaviour of
<a href="https://man.voidlinux.org/fsck.8">fsck(8)</a>.</p>
<p>For example, the partition scheme used throughout previous examples yields the
following <code>fstab</code>:</p>
<pre><code>/dev/sda1       /boot/efi   vfat    rw,relatime,[...]       0 0
/dev/sda2       /           ext4    rw,relatime             0 0
</code></pre>
<p>The information from <code>blkid</code> results in the following <code>/etc/fstab</code>:</p>
<pre><code>UUID=6914[...]  /boot/efi   vfat    rw,relatime,[...]       0 2
UUID=dc1b[...]  /           ext4    rw,relatime             0 1
</code></pre>
<p>Note: The output of <code>/proc/mounts</code> will have a single space between each field.
The columns are aligned here for readability.</p>
<p>Add an entry to mount <code>/tmp</code> in RAM:</p>
<pre><code>tmpfs           /tmp        tmpfs   defaults,nosuid,nodev   0 0
</code></pre>
<p>If using swap space, add an entry for any swap partitions:</p>
<pre><code>UUID=1cb4[...]  swap        swap    rw,noatime,discard      0 0
</code></pre>
<h2 id="installing-grub"><a class="header" href="#installing-grub">Installing GRUB</a></h2>
<p>Use
<a href="https://www.gnu.org/software/grub/manual/grub/html_node/Installing-GRUB-using-grub_002dinstall.html">grub-install</a>
to install GRUB onto your boot disk.</p>
<p><strong>On a BIOS computer</strong>, install the package <code>grub</code>, then run <code>grub-install /dev/sdX</code>, where <code>/dev/sdX</code> is the drive (not partition) that you wish to
install GRUB to. For example:</p>
<pre><code>[xchroot /mnt] # xbps-install grub
[xchroot /mnt] # grub-install /dev/sda
</code></pre>
<p><strong>On a UEFI computer</strong>, install either <code>grub-x86_64-efi</code>, <code>grub-i386-efi</code> or
<code>grub-arm64-efi</code>, depending on your architecture, then run <code>grub-install</code>,
optionally specifying a bootloader label (this label may be used by your
computer's firmware when manually selecting a boot device):</p>
<pre><code>[xchroot /mnt] # xbps-install grub-x86_64-efi
[xchroot /mnt] # grub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=&quot;Void&quot;
</code></pre>
<h3 id="troubleshooting-grub-installation"><a class="header" href="#troubleshooting-grub-installation">Troubleshooting GRUB installation</a></h3>
<p>If EFI variables are not available, add the option <code>--no-nvram</code> to the
<code>grub-install</code> command.</p>
<h4 id="installing-on-removable-media-or-non-compliant-uefi-systems"><a class="header" href="#installing-on-removable-media-or-non-compliant-uefi-systems">Installing on removable media or non-compliant UEFI systems</a></h4>
<p>Unfortunately, not all systems have a fully standards compliant UEFI
implementation. In some cases, it is necessary to &quot;trick&quot; the firmware into
booting by using the default fallback location for the bootloader instead of a
custom one. In that case, or if installing onto a removable disk (such as USB),
add the option <code>--removable</code> to the <code>grub-install</code> command.</p>
<p>Alternatively, use <a href="https://man.voidlinux.org/mkdir.1">mkdir(1)</a> to create the
<code>/boot/efi/EFI/boot</code> directory and copy the installed GRUB executable, usually
located in <code>/boot/efi/EFI/Void/grubx64.efi</code> (its location can be found using
<a href="https://man.voidlinux.org/efibootmgr.8">efibootmgr(8)</a>), into the new folder:</p>
<pre><code>[xchroot /mnt] # mkdir -p /boot/efi/EFI/boot
[xchroot /mnt] # cp /boot/efi/EFI/Void/grubx64.efi /boot/efi/EFI/boot/bootx64.efi
</code></pre>
<h2 id="finalization"><a class="header" href="#finalization">Finalization</a></h2>
<p>Use <a href="https://man.voidlinux.org/xbps-reconfigure.1">xbps-reconfigure(1)</a> to
ensure all installed packages are configured properly:</p>
<pre><code>[xchroot /mnt] # xbps-reconfigure -fa
</code></pre>
<p>This will make <a href="https://man.voidlinux.org/dracut.8">dracut(8)</a> generate an
initramfs, and will make GRUB generate a working configuration.</p>
<p>At this point, the installation is complete. Exit the chroot and reboot your
computer:</p>
<pre><code>[xchroot /mnt] # exit
# umount -R /mnt
# shutdown -r now
</code></pre>
<p>After booting into your evolutionOS installation for the first time, <a href="installation/guides/../../xbps/index.html#updating">perform a system
update</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="full-disk-encryption"><a class="header" href="#full-disk-encryption">Full Disk Encryption</a></h1>
<p><strong>Warning</strong>: Your drive's block device and other information may be different,
so make sure it is correct.</p>
<h2 id="partitioning"><a class="header" href="#partitioning">Partitioning</a></h2>
<p>Boot a live image and login.</p>
<p>Create a single physical partition on the disk using
<a href="https://man.voidlinux.org/cfdisk">cfdisk</a>, marking it as bootable. For an MBR
system, the partition layout should look like the following.</p>
<pre><code># fdisk -l /dev/sda
Disk /dev/sda: 48 GiB, 51539607552 bytes, 100663296 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0x4d532059

Device     Boot Start       End   Sectors Size Id Type
/dev/sda1  *     2048 100663295 100661248  48G 83 Linux
</code></pre>
<p>UEFI systems will need the disk to have a GPT disklabel and an EFI system
partition. The required size for this may vary depending on needs, but 100M
should be enough for most cases. For an EFI system, the partition layout should
look like the following.</p>
<pre><code># fdisk -l /dev/sda
Disk /dev/sda: 48 GiB, 51539607552 bytes, 100663296 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: gpt
Disk identifier: EE4F2A1A-8E7F-48CA-B3D0-BD7A01F6D8A0

Device      Start       End   Sectors  Size Type
/dev/sda1    2048    264191    262144  128M EFI System
/dev/sda2  264192 100663262 100399071 47.9G Linux filesystem
</code></pre>
<h2 id="encrypted-volume-configuration"><a class="header" href="#encrypted-volume-configuration">Encrypted volume configuration</a></h2>
<p><a href="https://man.voidlinux.org/cryptsetup.8">Cryptsetup</a> defaults to LUKS2, yet GRUB
releases before 2.06 only had support for LUKS1.</p>
<p>LUKS2 is only partially supported by GRUB; specifically, only the PBKDF2 key
derivation function is
<a href="https://git.savannah.gnu.org/cgit/grub.git/commit/?id=365e0cc3e7e44151c14dd29514c2f870b49f9755">implemented</a>,
which is <em>not</em> the default KDF used with LUKS2, that being Argon2i (<a href="https://savannah.gnu.org/bugs/?59409">GRUB Bug
59409</a>). LUKS encrypted partitions using
Argon2i (as well as the other KDF) can <em>not</em> be decrypted. For that reason, this
guide only recommends LUKS1 be used.</p>
<p>Keep in mind the encrypted volume will be <code>/dev/sda2</code> on EFI systems, since
<code>/dev/sda1</code> is taken up by the EFI partition.</p>
<pre><code># cryptsetup luksFormat --type luks1 /dev/sda1

WARNING!
========
This will overwrite data on /dev/sda1 irrevocably.

Are you sure? (Type uppercase yes): YES
Enter passphrase:
Verify passphrase:
</code></pre>
<p>Once the volume is created, it needs to be opened. Replace <code>voidvm</code> with an
appropriate name. Again, this will be <code>/dev/sda2</code> on EFI systems.</p>
<pre><code># cryptsetup luksOpen /dev/sda1 voidvm
Enter passphrase for /dev/sda1:
</code></pre>
<p>Once the LUKS container is opened, create the LVM volume group using that
partition.</p>
<pre><code># vgcreate voidvm /dev/mapper/voidvm
  Volume group &quot;voidvm&quot; successfully created
</code></pre>
<p>There should now be an empty volume group named <code>voidvm</code>.</p>
<p>Next, logical volumes need to be created for the volume group. For this example,
I chose 10G for <code>/</code>, 2G for <code>swap</code>, and will assign the rest to <code>/home</code>.</p>
<pre><code># lvcreate --name root -L 10G voidvm
  Logical volume &quot;root&quot; created.
# lvcreate --name swap -L 2G voidvm
  Logical volume &quot;swap&quot; created.
# lvcreate --name home -l 100%FREE voidvm
  Logical volume &quot;home&quot; created.
</code></pre>
<p>Next, create the filesystems. The example below uses XFS as a personal
preference of the author. Any filesystem <a href="https://www.gnu.org/software/grub/manual/grub/grub.html#Features">supported by
GRUB</a> will
work.</p>
<pre><code># mkfs.xfs -L root /dev/voidvm/root
meta-data=/dev/voidvm/root       isize=512    agcount=4, agsize=655360 blks
...
# mkfs.xfs -L home /dev/voidvm/home
meta-data=/dev/voidvm/home       isize=512    agcount=4, agsize=2359040 blks
...
# mkswap /dev/voidvm/swap
Setting up swapspace version 1, size = 2 GiB (2147479552 bytes)
</code></pre>
<h2 id="system-installation"><a class="header" href="#system-installation">System installation</a></h2>
<p>Next, setup the chroot and install the base system.</p>
<pre><code># mount /dev/voidvm/root /mnt
# mkdir -p /mnt/home
# mount /dev/voidvm/home /mnt/home
</code></pre>
<p>On a UEFI system, the EFI system partition also needs to be mounted.</p>
<pre><code># mkfs.vfat /dev/sda1
# mkdir -p /mnt/boot/efi
# mount /dev/sda1 /mnt/boot/efi
</code></pre>
<p>Copy the RSA keys from the installation medium to the target root directory:</p>
<pre><code># mkdir -p /mnt/var/db/xbps/keys
# cp /var/db/xbps/keys/* /mnt/var/db/xbps/keys/
</code></pre>
<p>Before we enter the chroot to finish up configuration, we do the actual install.
Do not forget to use the <a href="installation/guides/../../xbps/repositories/index.html#the-main-repository">appropriate repository
URL</a> for the type of
system you wish to install.</p>
<pre><code># xbps-install -Sy -R https://repo-default.voidlinux.org/current -r /mnt base-system lvm2 cryptsetup grub
[*] Updating `https://repo-default.voidlinux.org/current/x86_64-repodata' ...
x86_64-repodata: 1661KB [avg rate: 2257KB/s]
130 packages will be downloaded:
...
</code></pre>
<p>UEFI systems will have a slightly different package selection. The installation
command for a UEFI system will be as follows.</p>
<pre><code># xbps-install -Sy -R https://repo-default.voidlinux.org/current -r /mnt base-system cryptsetup grub-x86_64-efi lvm2
</code></pre>
<p>When it's done, we can enter the chroot with
<a href="https://man.voidlinux.org/xchroot.1"><code>xchroot(1)</code></a> (from <code>xtools</code>) and finish
up the configuration. Alternatively, entering the chroot can be <a href="installation/guides/../../config/containers-and-vms/chroot.html#manual-method">done
manually</a>.</p>
<pre><code># xchroot /mnt
[xchroot /mnt] # chown root:root /
[xchroot /mnt] # chmod 755 /
[xchroot /mnt] # passwd root
[xchroot /mnt] # echo voidvm &gt; /etc/hostname
</code></pre>
<p>and, for glibc systems only:</p>
<pre><code>[xchroot /mnt] # echo &quot;LANG=en_US.UTF-8&quot; &gt; /etc/locale.conf
[xchroot /mnt] # echo &quot;en_US.UTF-8 UTF-8&quot; &gt;&gt; /etc/default/libc-locales
[xchroot /mnt] # xbps-reconfigure -f glibc-locales
</code></pre>
<h3 id="filesystem-configuration"><a class="header" href="#filesystem-configuration">Filesystem configuration</a></h3>
<p>The next step is editing <code>/etc/fstab</code>, which will depend on how you configured
and named your filesystems. For this example, the file should look like this:</p>
<pre><code># &lt;file system&gt;   &lt;dir&gt; &lt;type&gt;  &lt;options&gt;             &lt;dump&gt;  &lt;pass&gt;
tmpfs             /tmp  tmpfs   defaults,nosuid,nodev 0       0
/dev/voidvm/root  /     xfs     defaults              0       0
/dev/voidvm/home  /home xfs     defaults              0       0
/dev/voidvm/swap  swap  swap    defaults              0       0
</code></pre>
<p>UEFI systems will also have an entry for the EFI system partition.</p>
<pre><code>/dev/sda1	/boot/efi	vfat	defaults	0	0
</code></pre>
<h3 id="grub-configuration"><a class="header" href="#grub-configuration">GRUB configuration</a></h3>
<p>Next, configure GRUB to be able to unlock the filesystem. Add the following line
to <code>/etc/default/grub</code>:</p>
<pre><code>GRUB_ENABLE_CRYPTODISK=y
</code></pre>
<p>Next, the kernel needs to be configured to find the encrypted device. First,
find the UUID of the device.</p>
<pre><code>[xchroot /mnt] # blkid -o value -s UUID /dev/sda1
135f3c06-26a0-437f-a05e-287b036440a4
</code></pre>
<p>Edit the <code>GRUB_CMDLINE_LINUX_DEFAULT=</code> line in <code>/etc/default/grub</code> and add
<code>rd.lvm.vg=voidvm rd.luks.uuid=&lt;UUID&gt;</code> to it. Make sure the UUID matches the one
for the <code>sda1</code> device found in the output of the
<a href="https://man.voidlinux.org/blkid.8">blkid(8)</a> command above. This will be
<code>/dev/sda2</code> on EFI systems.</p>
<h2 id="luks-key-setup"><a class="header" href="#luks-key-setup">LUKS key setup</a></h2>
<p>And now to avoid having to enter the password twice on boot, a key will be
configured to automatically unlock the encrypted volume on boot. First, generate
a random key.</p>
<pre><code>[xchroot /mnt] # dd bs=1 count=64 if=/dev/urandom of=/boot/volume.key
64+0 records in
64+0 records out
64 bytes copied, 0.000662757 s, 96.6 kB/s
</code></pre>
<p>Next, add the key to the encrypted volume.</p>
<pre><code>[xchroot /mnt] # cryptsetup luksAddKey /dev/sda1 /boot/volume.key
Enter any existing passphrase:
</code></pre>
<p>Change the permissions to protect the generated key.</p>
<pre><code>[xchroot /mnt] # chmod 000 /boot/volume.key
[xchroot /mnt] # chmod -R g-rwx,o-rwx /boot
</code></pre>
<p>This keyfile also needs to be added to <code>/etc/crypttab</code>. Again, this will be
<code>/dev/sda2</code> on EFI systems.</p>
<pre><code>voidvm   /dev/sda1   /boot/volume.key   luks
</code></pre>
<p>And then the keyfile and <code>crypttab</code> need to be included in the initramfs. Create
a new file at <code>/etc/dracut.conf.d/10-crypt.conf</code> with the following line:</p>
<pre><code>install_items+=&quot; /boot/volume.key /etc/crypttab &quot;
</code></pre>
<h2 id="complete-system-installation"><a class="header" href="#complete-system-installation">Complete system installation</a></h2>
<p>Next, install the boot loader to the disk.</p>
<pre><code>[xchroot /mnt] # grub-install /dev/sda
</code></pre>
<p>Ensure an initramfs is generated:</p>
<pre><code>[xchroot /mnt] # xbps-reconfigure -fa
</code></pre>
<p>Exit the <code>chroot</code>, unmount the filesystems, and reboot the system.</p>
<pre><code>[xchroot /mnt] # exit
# umount -R /mnt
# reboot
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installing-evolutionos-on-a-zfs-root"><a class="header" href="#installing-evolutionos-on-a-zfs-root">Installing EvolutionOS on a ZFS Root</a></h1>
<p>Because the EvolutionOS installer does not support ZFS, it is necessary to install via
chroot. Aside from a few caveats regarding bootloader and initramfs support,
installing EvolutionOS on a ZFS root filesystem is not significantly different from any
other advanced installation. <a href="https://zfsbootmenu.org">ZFSBootMenu</a> is a
bootloader designed from the ground up to support booting Linux distributions
directly from a ZFS pool. However, it is also possible to use traditional
bootloaders with a ZFS root.</p>
<h2 id="zfsbootmenu"><a class="header" href="#zfsbootmenu">ZFSBootMenu</a></h2>
<p>ZFSBootMenu supports native ZFS encryption, offers a convenient recovery 
environment that can be used to clone prior snapshots or perform advanced 
manipulation in a pre-boot environment, and will support booting from any 
pool that is importable by modern ZFS drivers. The ZFSBootMenu documentation 
offers, among other content, several <a href="https://docs.zfsbootmenu.org/en/latest/guides/void-linux.html">step-by-step guides</a> for installing a EvolutionOS system from scratch. The <a href="https://docs.zfsbootmenu.org/en/latest/guides/void-linux/uefi.html">UEFI guide</a>
describes the procedure of bootstrapping a EvolutionOS system for modern systems. For
legacy BIOS systems, the <a href="https://docs.zfsbootmenu.org/en/latest/guides/void-linux/syslinux-mbr.html">syslinux guide</a>provides comparable instructions.</p>
<h2 id="traditional-bootloaders"><a class="header" href="#traditional-bootloaders">Traditional bootloaders</a></h2>
<p>For those that wish to forego ZFSBootMenu, it is possible to bootstrap a EvolutionOS
system with another bootloader. To avoid unnecessary complexity, systems that
use bootloaders other than ZFSBootMenu should plan to use a separate <code>/boot</code>
that is located on an ext4 or xfs filesystem.</p>
<h3 id="installation-media"><a class="header" href="#installation-media">Installation media</a></h3>
<p>Installing EvolutionOS to a ZFS root requires an installation medium with ZFS drivers.
It is possible to build a custom image from the official
<a href="https://github.com/evolution-linux/evolution-installer">evolution-installer</a> repository by providing
the command-line option <code>-p zfs</code> to the <code>mklive.sh</code> script. However, for
<code>x86_64</code> systems, it may be more convenient to fetch a pre-built
<a href="https://github.com/leahneukirchen/hrmpf/releases">hrmpf</a> image. These images,
maintained by the Void Linux projects, are extensions of the standard Void live
images that include pre-compiled ZFS modules in addition to other useful tools.
To use these, add https://evolution-linux.github.io to the repository list.</p>
<h3 id="partition-disks"><a class="header" href="#partition-disks">Partition disks</a></h3>
<p>After booting a live image with ZFS support, <a href="installation/guides/../live-images/partitions.html">partition your
disks</a>. The considerations in the partitioning
guide apply to ZFS installations as well, except that</p>
<ul>
<li>The boot partition should be considered necessary unless you intend to use
<code>gummiboot</code>, which expects that your EFI system partition will be mounted at
<code>/boot</code>. (This alternative configuration will not be discussed here.)</li>
<li>Aside from any EFI system partition, GRUB BIOS boot partition, swap or boot
partitions, the remainder of the disk should typically be a single partition
with type code <code>BF00</code> that will be dedicated to a single ZFS pool. There is
no benefit to creating separate ZFS pools on a single disk.</li>
</ul>
<p>As needed, format the EFI system partition using
<a href="https://man.voidlinux.org/mkfs.vfat.8">mkfs.vfat(8)</a> and the the boot partition
using <a href="https://man.voidlinux.org/mke2fs.8">mke2fs(8)</a> or
<a href="https://man.voidlinux.org/mkfs.xfs.8">mkfs.xfs(8)</a>. Initialize any swap space
using <a href="https://man.voidlinux.org">mkswap(8)</a>.</p>
<blockquote>
<p>It is possible to put Linux swap space on a ZFS zvol, although there may be a
risk of deadlocking the kernel when under high memory pressure. This guide
takes no position on the matter of swap space on a zvol. However, if you wish
to use suspension-to-disk (hibernation), note that the kernel is not capable
of resuming from memory images stored on a zvol. You will need a dedicated
swap partition to use hibernation. Apart from this caveat, there are no
special considerations required to resume a suspended image when using a ZFS
root.</p>
</blockquote>
<h3 id="create-a-zfs-pool"><a class="header" href="#create-a-zfs-pool">Create a ZFS pool</a></h3>
<p>Create a ZFS pool on the partition created for it using
<a href="https://man.voidlinux.org/zpool.8">zpool(8)</a>. For example, to create a pool on
<code>/dev/disk/by-id/wwn-0x5000c500deadbeef-part3</code>:</p>
<pre><code># zpool create -f -o ashift=12 \
    -O compression=lz4 \
    -O acltype=posixacl \
    -O xattr=sa \
    -O relatime=on \
    -o autotrim=on \
    -m none zroot /dev/disk/by-id/wwn-0x5000c500deadbeef-part3
</code></pre>
<p>Adjust the pool (<code>-o</code>) and filesystem (<code>-O</code>) options as desired, and replace the
partition identifier <code>wwn-0x5000c500deadbeef-part3</code> with that of the actual
partition to be used.</p>
<blockquote>
<p>When adding disks or partitions to ZFS pools, it is generally advisable to
refer to them by the symbolic links created in <code>/dev/disk/by-id</code> or (on UEFI
systems) <code>/dev/disk/by-partuuid</code> so that ZFS will identify the right
partitions even if disk naming should change at some point. Using traditional
device nodes like <code>/dev/sda3</code> may cause intermittent import failures.</p>
</blockquote>
<p>Next, export and re-import the pool with a temporary, alternate root path:</p>
<pre><code># zpool export zroot
# zpool import -N -R /mnt zroot
</code></pre>
<h3 id="create-initial-filesystems"><a class="header" href="#create-initial-filesystems">Create initial filesystems</a></h3>
<p>The filesystem layout on your ZFS pool is flexible. However, it is customary to
put operating system root filesystems (&quot;boot environments&quot;) under a <code>ROOT</code>
parent:</p>
<pre><code># zfs create -o mountpoint=none zroot/ROOT
# zfs create -o mountpoint=/ -o canmount=noauto zroot/ROOT/void
</code></pre>
<p>Setting <code>canmount=noauto</code> on filesystems with <code>mountpoint=/</code> is useful because
it permits the creation of multiple boot environments (which may be clones of a
common Void installation or contain completely separate distributions) without
fear that ZFS auto-mounting will attempt to mount one over another.</p>
<p>To separate user data from the operating system, create a filesystem to store
home directories:</p>
<pre><code># zfs create -o mountpoint=/home zroot/home
</code></pre>
<p>Other filesystems may be created as desired.</p>
<h3 id="mount-the-zfs-hierarchy"><a class="header" href="#mount-the-zfs-hierarchy">Mount the ZFS hierarchy</a></h3>
<p>All ZFS filesystems should be mounted under the <code>/mnt</code> alternate root
established by the earlier re-import. Mount the manual-only root filesystem
before allowing ZFS to automatically mount everything else:</p>
<pre><code># zfs mount zroot/ROOT/void
# zfs mount -a
</code></pre>
<p>At this point, the entire ZFS hierarchy should be mounted and ready for
installation. To improve boot-time import speed, it is useful to record the
current pool configuration in a cache file that EvolutionOS will use to avoid walking
the entire device hierarchy to identify importable pools:</p>
<pre><code># mkdir -p /mnt/etc/zfs
# zpool set cachefile=/mnt/etc/zfs/zpool.cache zroot
</code></pre>
<p>Mount non-ZFS filesystems at the appropriate places. For example, if <code>/dev/sda2</code>
holds an ext4 filesystem that should be mounted at <code>/boot</code> and <code>/dev/sda1</code> is
the EFI system partition:</p>
<pre><code># mkdir -p /mnt/boot
# mount /dev/sda2 /mnt/boot
# mkdir -p /mnt/boot/efi
# mount /dev/sda1 /mnnt/boot/efi
</code></pre>
<h3 id="installation-1"><a class="header" href="#installation-1">Installation</a></h3>
<p>At this point, ordinary installation can proceed from the <a href="https://docs.voidlinux.org/installation/guides/chroot.html#base-installation">&quot;Base Installation&quot;
section</a>.
of the standard chroot installation guide. However, before following the
<a href="installation/guides/./chroot.html#finalization">&quot;Finalization&quot;
instructions</a>,
make sure that the <code>zfs</code> package has been installed and <code>dracut</code> is configured
to identify a ZFS root filesystem:</p>
<pre><code>[xchroot /mnt] # mkdir -p /etc/dracut.conf.d
[xchroot /mnt] # cat &gt; /etc/dracut.conf.d/zol.conf &lt;&lt;EOF
nofsck=&quot;yes&quot;
add_dracutmodules+=&quot; zfs &quot;
omit_dracutmodules+=&quot; btrfs resume &quot;
EOF
[xchroot /mnt] # xbps-install zfs
</code></pre>
<p>Finally, follow the &quot;Finalization&quot; instructions and reboot into your new system.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="arm-devices"><a class="header" href="#arm-devices">ARM Devices</a></h1>
<p>ARM is not supported currently. A future update may add ARM support.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="supported-platforms"><a class="header" href="#supported-platforms">Supported Platforms</a></h1>
<p>ARM Is not currently supported.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="musl"><a class="header" href="#musl">musl</a></h1>
<p><a href="https://musl.libc.org/">musl</a> is a libc implementation which strives to be
lightweight, fast, simple, and correct.</p>
<p>EvolutionOS supports musl by using it in its codebase for all target
platforms (although binary packages are not available for i686). Additionally,
all compatible packages in our official repositories are available with
musl-linked binaries in addition to their glibc counterparts.</p>
<p>Currently, there are nonfree and debug sub-repositories for musl, but no
multilib sub-repo.</p>
<h2 id="incompatible-software"><a class="header" href="#incompatible-software">Incompatible software</a></h2>
<p>musl practices very strict and minimal standard compliance. Many commonly used
platform-specific extensions are not present. Because of this, it is common for
software to need modification to compile and/or function properly. EvolutionOS
developers work to patch such software and hopefully get portability/correctness
changes accepted into the upstream projects.</p>
<p>Proprietary software usually supports only glibc systems, though sometimes such
applications are available as
<a href="installation/../config/external-applications.html#flatpak">flatpaks</a> and can be run on a musl
system. In particular, the <a href="installation/../config/graphical-session/graphics-drivers/nvidia.html#nvidia-proprietary-driver">proprietary NVIDIA
drivers</a>
do not support musl, which should be taken into account when evaluating hardware
compatibility.</p>
<h3 id="glibc-chroot"><a class="header" href="#glibc-chroot">glibc chroot</a></h3>
<p>Software requiring glibc can be run in a glibc
<a href="installation/../config/containers-and-vms/chroot.html">chroot</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="configuration-1"><a class="header" href="#configuration-1">Configuration</a></h1>
<p>This section and its subsections provide information about configuring your EvolutionOS
system.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="package-documentation"><a class="header" href="#package-documentation">Package Documentation</a></h1>
<p>The most common media for documentation in EvolutionOS are <a href="config/package-documentation/./man.html">manual
pages</a>.</p>
<p>Many packages contain documentation in other formats, like HTML. This
documentation can usually be found in a <code>/usr/share/doc/&lt;package&gt;</code> directory.</p>
<p>More extensive documentation may be split into separate <code>*-doc</code> packages, such
as <code>julia-doc</code>. This is often the case for programming languages, databases and
big software libraries.</p>
<p>In addition to documentation provided by upstream projects, packages may also
contain description of initial setup or usage specific to EvolutionOS, provided by
distribution contributors. It will be located in
<code>/usr/share/doc/&lt;package&gt;/README.voidlinux</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="manual-pages"><a class="header" href="#manual-pages">Manual Pages</a></h1>
<p>Many EvolutionOS packages come with manual ('man') pages. The default installation
includes the <a href="https://mandoc.bsd.lv/">mandoc</a> manpage toolset, via the <code>mdocml</code>
package.</p>
<p>The <a href="https://man.voidlinux.org/man.1">man(1)</a> command can be used to show man
pages:</p>
<pre><code>$ man chroot
</code></pre>
<p>Every man page belongs to a particular <em>section</em>:</p>
<ul>
<li>1: User commands (Programs)</li>
<li>2: System calls</li>
<li>3: Library calls</li>
<li>4: Special files (devices)</li>
<li>5: File formats and configuration files</li>
<li>6: Games</li>
<li>7: Overview, conventions, and miscellaneous</li>
<li>8: System management commands</li>
</ul>
<p>Refer to <a href="https://man.voidlinux.org/man-pages.7">man-pages(7)</a> for details.</p>
<p>There are some man pages which have the same name, but are used in different
contexts, and are thus in a different section. You can specify which one to use
by including the section number in the call to <code>man</code>:</p>
<pre><code>$ man 1 printf
</code></pre>
<p><code>man</code> can be configured via <a href="https://man.voidlinux.org/man.conf.5">man.conf(5)</a>.</p>
<p>The <code>mandoc</code> toolset contains <a href="https://man.voidlinux.org/apropos.1">apropos(1)</a>,
which can be used to search for manual pages. <code>apropos</code> uses a database that can
be generated and updated with the
<a href="https://man.voidlinux.org/makewhatis.8">makewhatis(8)</a> command:</p>
<pre><code># makewhatis
$ apropos chroot
chroot(1) - run command or interactive shell with special root directory
xbps-uchroot(1) - XBPS utility to chroot and bind mount with Linux namespaces
xbps-uunshare(1) - XBPS utility to chroot and bind mount with Linux user namespaces
chroot(2) - change root directory
</code></pre>
<p>The <code>mdocml</code> package provides a cron job to update the database daily,
<code>/etc/cron.daily/makewhatis</code>. You will need to install and enable a <a href="config/package-documentation/../cron.html">cron
daemon</a> for this functionality to be activated.</p>
<p>Development and POSIX manuals are not installed by default, but are available
via the <code>man-pages-devel</code> and <code>man-pages-posix</code> packages.</p>
<h2 id="localized-manual-pages"><a class="header" href="#localized-manual-pages">Localized manual pages</a></h2>
<p>It is also possible to use localized man pages from packages which provide their
own as well as those provided by the <code>manpages-*</code> packages. However, this can
require some configuration.</p>
<h3 id="with-mdocml"><a class="header" href="#with-mdocml">With mdocml</a></h3>
<p>If <code>mdocml</code> is being used and the settings should be applied for all users, it
is necessary to add the relevant paths to
<a href="https://man.voidlinux.org/man.conf.5">man.conf(5)</a>. For example, German
speakers would add these two lines to their configuration file:</p>
<pre><code>/usr/share/man/de
/usr/share/man/de.UTF-8
</code></pre>
<p>Alternatively, each user can export the <code>MANPATH</code> variable in their environment,
as explained in <a href="https://man.voidlinux.org/man.1">man(1)</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="firmware"><a class="header" href="#firmware">Firmware</a></h1>
<p>EvolutionOS provides a number of firmware packages in the repositories. Some firmware
is only available if you have enabled the
<a href="config/../xbps/repositories/index.html#nonfree">nonfree</a> repository.</p>
<h2 id="microcode"><a class="header" href="#microcode">Microcode</a></h2>
<p>Microcode is loaded onto the CPU or GPU at boot by the BIOS, but can be replaced
later by the OS itself. An update to microcode can allow a CPU's or GPU's
behavior to be modified to work around certain yet to be discovered bugs,
without the need to replace the hardware.</p>
<h3 id="intel"><a class="header" href="#intel">Intel</a></h3>
<p>Install the Intel microcode package, <code>intel-ucode</code>. This package is in the
nonfree repo, which has to be <a href="config/../xbps/repositories/index.html#nonfree">enabled</a>.
After installing this package, it is necessary to regenerate your
<a href="config/./kernel.html#kernel-hooks">initramfs</a>. For subsequent updates, the microcode
will be added to the initramfs automatically.</p>
<h3 id="amd"><a class="header" href="#amd">AMD</a></h3>
<p>Install the AMD package, <code>linux-firmware-amd</code>, which contains microcode for both
AMD CPUs and GPUs. AMD CPUs and GPUs will automatically load the microcode, no
further configuration required.</p>
<h3 id="verification"><a class="header" href="#verification">Verification</a></h3>
<p>The <code>/proc/cpuinfo</code> file has some information under <code>microcode</code> that can be used
to verify the microcode update.</p>
<h2 id="removing-firmware"><a class="header" href="#removing-firmware">Removing firmware</a></h2>
<p>By default, <code>linuxX.Y</code> packages and the <code>base-system</code> package install a number
of firmware packages. It is not necessary to remove unused firmware packages,
but if you wish to do so, you can configure XBPS to
<a href="config/../xbps/advanced-usage.html#ignoring-packages">ignore</a> those packages, then
remove them.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="locales-and-translations"><a class="header" href="#locales-and-translations">Locales and Translations</a></h1>
<p>For a list of currently enabled locales, run</p>
<pre><code>$ locale -a
</code></pre>
<h2 id="enabling-locales"><a class="header" href="#enabling-locales">Enabling locales</a></h2>
<p>To enable a certain locale, un-comment or add the relevant lines in
<code>/etc/default/libc-locales</code> and <a href="config/../xbps/index.html">force-reconfigure</a> the
<code>glibc-locales</code> package.</p>
<h2 id="setting-the-system-locale"><a class="header" href="#setting-the-system-locale">Setting the system locale</a></h2>
<p>Set <code>LANG=xxxx</code> in <code>/etc/locale.conf</code>.</p>
<h2 id="application-locale"><a class="header" href="#application-locale">Application locale</a></h2>
<p>Some programs have their translations in a separate package that must be
installed in order to use them. You can
<a href="config/../xbps/index.html#finding-files-and-packages">search</a> for the desired language
(e.g. &quot;german&quot; or &quot;portuguese&quot;) in the package repositories and install the
packages relevant to the applications you use. An especially relevant case is
when installing individual packages from the LibreOffice suite, such as
<code>libreoffice-writer</code>, which require installing at least one of the
<code>libreoffice-i18n-*</code> packages to work properly. This isn't necessary when
installing the <code>libreoffice</code> meta-package, since doing so will install the most
common translation packages.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="users-and-groups"><a class="header" href="#users-and-groups">Users and Groups</a></h1>
<p>The <a href="https://man.voidlinux.org/useradd.8">useradd(8)</a>,
<a href="https://man.voidlinux.org/userdel.8">userdel(8)</a> and
<a href="https://man.voidlinux.org/usermod.8">usermod(8)</a> commands are used to add,
delete and modify users respectively. The
<a href="https://man.voidlinux.org/passwd.1">passwd(1)</a> command is used to change
passwords.</p>
<p>The <a href="https://man.voidlinux.org/groupadd.8">groupadd(8)</a>,
<a href="https://man.voidlinux.org/groupdel.8">groupdel(8)</a> and
<a href="https://man.voidlinux.org/groupmod.8">groupmod(8)</a> commands are used to add,
delete and modify groups respectively. The
<a href="https://man.voidlinux.org/groups.1">groups(1)</a> command lists all groups a user
belongs to.</p>
<h2 id="default-shell"><a class="header" href="#default-shell">Default shell</a></h2>
<p>The default shell for a user can be changed with
<a href="https://man.voidlinux.org/chsh.1">chsh(1)</a>:</p>
<pre><code>$ chsh -s &lt;shell&gt; &lt;user_name&gt;
</code></pre>
<p><code>&lt;shell&gt;</code> must be the path to the shell as specified by <code>/etc/shells</code> or the
output of <code>chsh -l</code>, which provides a list of installed shells.</p>
<h2 id="sudo"><a class="header" href="#sudo">sudo</a></h2>
<p><a href="https://man.voidlinux.org/sudo.8">sudo(8)</a> is installed by default, but might
not be configured appropriately for your needs. It is only necessary to
configure sudo if you wish to use it.</p>
<p>Use <a href="https://man.voidlinux.org/visudo.8">visudo(8)</a> as root to edit the
<a href="https://man.voidlinux.org/sudoers.5">sudoers(5)</a> file.</p>
<p>To create a superuser, uncomment the line</p>
<pre><code>#%wheel ALL=(ALL) ALL
</code></pre>
<p>and add users to the <code>wheel</code> group.</p>
<h2 id="default-groups"><a class="header" href="#default-groups">Default Groups</a></h2>
<p>EvolutionOS defines a number of groups by default.</p>
<div class="table-wrapper"><table><thead><tr><th>Group</th><th>Description</th></tr></thead><tbody>
<tr><td><code>root</code></td><td>Complete access to the system.</td></tr>
<tr><td><code>bin</code></td><td>Unused - present for historical reasons.</td></tr>
<tr><td><code>sys</code></td><td>Unused - present for historical reasons.</td></tr>
<tr><td><code>kmem</code></td><td>Ability to read from <code>/dev/mem</code> and <code>/dev/port</code>.</td></tr>
<tr><td><code>wheel</code></td><td>Elevated privileges for specific system administration tasks.</td></tr>
<tr><td><code>tty</code></td><td>Access to TTY-like devices:</td></tr>
<tr><td></td><td><code>/dev/tty*</code>, <code>/dev/pts*</code>, <code>/dev/vcs*</code>.</td></tr>
<tr><td><code>tape</code></td><td>Access to tape devices.</td></tr>
<tr><td><code>daemon</code></td><td>System daemons that need to write to files on disk.</td></tr>
<tr><td><code>floppy</code></td><td>Access to floppy drives.</td></tr>
<tr><td><code>disk</code></td><td>Raw access to <code>/dev/sd*</code> and <code>/dev/loop*</code>.</td></tr>
<tr><td><code>lp</code></td><td>Access to printers.</td></tr>
<tr><td><code>dialout</code></td><td>Access to serial ports.</td></tr>
<tr><td><code>audio</code></td><td>Access to audio devices.</td></tr>
<tr><td><code>video</code></td><td>Access to video devices.</td></tr>
<tr><td><code>utmp</code></td><td>Ability to write to <code>/var/run/utmp</code>, <code>/var/log/wtmp</code></td></tr>
<tr><td></td><td>and <code>/var/log/btmp</code>.</td></tr>
<tr><td><code>adm</code></td><td>Unused - present for historical reasons. This group was</td></tr>
<tr><td></td><td>traditionally used for system monitoring, such as viewing</td></tr>
<tr><td></td><td>files in <code>/var/log</code>.</td></tr>
<tr><td><code>cdrom</code></td><td>Access to CD devices.</td></tr>
<tr><td><code>optical</code></td><td>Access to DVD/CD-RW devices.</td></tr>
<tr><td><code>mail</code></td><td>Used by some mail packages, e.g. <code>dma</code>.</td></tr>
<tr><td><code>storage</code></td><td>Access to removable storage devices.</td></tr>
<tr><td><code>scanner</code></td><td>Ability to access scanners.</td></tr>
<tr><td><code>network</code></td><td>Unused - present for historical reasons.</td></tr>
<tr><td><code>kvm</code></td><td>Ability to use KVM for virtual machines, e.g. via QEMU.</td></tr>
<tr><td><code>input</code></td><td>Access to input devices: <code>/dev/mouse*</code>, <code>/dev/event*</code>.</td></tr>
<tr><td><code>plugdev</code></td><td>Access to pluggable devices.</td></tr>
<tr><td><code>nogroup</code></td><td>System daemons that don't need to own any files.</td></tr>
<tr><td><code>usbmon</code></td><td>Access to <code>/dev/usbmon*</code>.</td></tr>
<tr><td><code>users</code></td><td>Ordinary users.</td></tr>
<tr><td><code>xbuilder</code></td><td>To use xbps-uchroot(1) with <code>xbps-src</code>.</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="services-and-daemons---runit"><a class="header" href="#services-and-daemons---runit">Services and Daemons - runit</a></h1>
<p>EvolutionOS uses the <a href="https://man.voidlinux.org/runit.8">runit(8)</a> supervision suite to
run system services and daemons.</p>
<p>Some advantages of using runit include:</p>
<ul>
<li>a small code base, making it easier to audit for bugs and security issues.</li>
<li>each service is given a clean process state, regardless of how the service was
started or restarted: it will be started with the same environment, resource
limits, open file descriptors, and controlling terminals.</li>
<li>a reliable logging facility for services, where the log service stays up as
long as the relevant service is running and possibly writing to the log.</li>
</ul>
<p>If you don't need a program to be running constantly, but would like it to run
at regular intervals, you might like to consider using a <a href="config/services/../cron.html">cron
daemon</a>.</p>
<h2 id="section-contents-1"><a class="header" href="#section-contents-1">Section Contents</a></h2>
<ul>
<li><a href="config/services/./user-services.html">Per-User Services</a></li>
<li><a href="config/services/./logging.html">Logging</a></li>
</ul>
<h2 id="service-directories"><a class="header" href="#service-directories">Service Directories</a></h2>
<p>Each service managed by runit has an associated <em>service directory</em>.</p>
<p>A service directory requires only one file: an executable named <code>run</code>, which is
expected to exec a process in the foreground.</p>
<p>Optionally, a service directory may contain:</p>
<ul>
<li>an executable named <code>check</code>, which will be run to check whether the service is
up and available; it's considered available if <code>check</code> exits with 0.</li>
<li>an executable named <code>finish</code>, which will be run on shutdown/process stop.</li>
<li>a <code>conf</code> file; this can contain environment variables to be sourced and
referenced in <code>run</code>.</li>
<li>a directory named <code>log</code>; a pipe will be opened from the output of the <code>run</code>
process in the service directory to the input of the <code>run</code> process in the
<code>log</code> directory.</li>
</ul>
<p>When a new service is created, a <code>supervise</code> folder will be automatically
created on the first run.</p>
<h3 id="configuring-services"><a class="header" href="#configuring-services">Configuring Services</a></h3>
<p>Most services can take configuration options set by a <code>conf</code> file in the service
directory. This allows service customization without modifying the service
directory provided by the relevant package.</p>
<p>Check the service file for how to pass configuration parameters. A few services
have a field like <code>OPTS=&quot;--value ...&quot;</code> in their <code>conf</code> file.</p>
<p>To make more complex customizations, you should <a href="config/services/index.html#editing-services">edit the
service</a>.</p>
<h3 id="editing-services"><a class="header" href="#editing-services">Editing Services</a></h3>
<p>To edit a service, first copy its service directory to a different directory
name. Otherwise, <a href="https://man.voidlinux.org/xbps-install.1">xbps-install(1)</a> can
overwrite the service directory. Then, edit the new service file as needed.
Finally, the old service should be stopped and disabled, and the new one should
be started.</p>
<h2 id="managing-services"><a class="header" href="#managing-services">Managing Services</a></h2>
<h3 id="runsvdirs"><a class="header" href="#runsvdirs">Runsvdirs</a></h3>
<p>A <strong>runsvdir</strong> is a directory in <code>/etc/runit/runsvdir</code> containing enabled
services in the form of symlinks to service directories. On a running system,
the current runsvdir is accessible via the <code>/var/service</code> symlink.</p>
<p>The <code>runit-void</code> package comes with two runsvdirs, <code>single</code> and <code>default</code>:</p>
<ul>
<li><code>single</code> just runs <a href="https://man.voidlinux.org/sulogin.8">sulogin(8)</a> and the
necessary steps to rescue your system.</li>
<li><code>default</code> is the default runsvdir on a running system, unless <a href="config/services/index.html#booting-a-different-runsvdir">specified
otherwise by the kernel command line</a>.</li>
</ul>
<p>Additional runsvdirs can be created in <code>/etc/runit/runsvdir/</code>.</p>
<p>See <a href="https://man.voidlinux.org/runsvdir.8">runsvdir(8)</a> and
<a href="https://man.voidlinux.org/runsvchdir.8">runsvchdir(8)</a> for further information.</p>
<h4 id="booting-a-different-runsvdir"><a class="header" href="#booting-a-different-runsvdir">Booting A Different runsvdir</a></h4>
<p>To boot a runsvdir other than <code>default</code>, the name of the desired runsvdir can be
added to the <a href="config/services/../kernel.html#cmdline">kernel command-line</a>. As an example, adding
<code>single</code> to the kernel command line will boot the <code>single</code> runsvdir.</p>
<h3 id="basic-usage"><a class="header" href="#basic-usage">Basic Usage</a></h3>
<p>To start, stop, restart or get the status of a service:</p>
<pre><code># sv up &lt;services&gt;
# sv down &lt;services&gt;
# sv restart &lt;services&gt;
# sv status &lt;services&gt;
</code></pre>
<p>The <code>&lt;services&gt;</code> placeholder can be:</p>
<ul>
<li>Service names (service directory names) inside the <code>/var/service/</code> directory.</li>
<li>The full paths to the services.</li>
</ul>
<p>For example, the following commands show the status of a specific service and of
all enabled services:</p>
<pre><code># sv status dhcpcd
# sv status /var/service/*
</code></pre>
<p>See <a href="https://man.voidlinux.org/sv.8">sv(8)</a> for further information.</p>
<h4 id="enabling-services"><a class="header" href="#enabling-services">Enabling Services</a></h4>
<p>EvolutionOS provides service directories for most daemons in <code>/etc/sv/</code>.</p>
<p>To enable a service on a booted system, create a symlink to the service
directory in <code>/var/service/</code>:</p>
<pre><code># ln -s /etc/sv/&lt;service&gt; /var/service/
</code></pre>
<p>If the system is not currently running, the service can be linked directly into
the <code>default</code> <a href="config/services/index.html#runsvdirs">runsvdir</a>:</p>
<pre><code># ln -s /etc/sv/&lt;service&gt; /etc/runit/runsvdir/default/
</code></pre>
<p>This will automatically start the service. Once a service is linked it will
always start on boot and restart if it stops, unless administratively downed.</p>
<p>To prevent a service from starting at boot while allowing runit to manage it,
create a file named <code>down</code> in its service directory:</p>
<pre><code># touch /etc/sv/&lt;service&gt;/down
</code></pre>
<p>The <code>down</code> file mechanism also makes it possible to disable services that are
enabled by default, such as the <a href="https://man.voidlinux.org/agetty.8">agetty(8)</a>
services for ttys 1 to 6. This way, package updates which affect these services
(in this case, the <code>runit-void</code> package) won't re-enable them.</p>
<h4 id="disabling-services"><a class="header" href="#disabling-services">Disabling Services</a></h4>
<p>To disable a service, remove the symlink from the running runsvdir:</p>
<pre><code># rm /var/service/&lt;service&gt;
</code></pre>
<p>Or, for example, from the <code>default</code> runsvdir, if either the specific runsvdir,
or the system, is not currently running:</p>
<pre><code># rm /etc/runit/runsvdir/default/&lt;service&gt;
</code></pre>
<h4 id="testing-services"><a class="header" href="#testing-services">Testing Services</a></h4>
<p>To check if a service is working correctly when started by the service
supervisor, run it once before fully enabling it:</p>
<pre><code># touch /etc/sv/&lt;service&gt;/down
# ln -s /etc/sv/&lt;service&gt; /var/service/
# sv once &lt;service&gt;
</code></pre>
<p>If everything works, remove the <code>down</code> file to enable the service.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="per-user-services"><a class="header" href="#per-user-services">Per-User Services</a></h1>
<p>Sometimes it can be nice to have user-specific runit services. For example, you
might want to open an ssh tunnel as the current user, run a virtual machine, or
regularly run daemons on your behalf. The most common way to do this is to
create a system-level service that runs
<a href="https://man.voidlinux.org/runsvdir.8">runsvdir(8)</a> as your user, in order to
start and monitor the services in a personal services directory.</p>
<p>For example, you could create a service called <code>/etc/sv/runsvdir-&lt;username&gt;</code>
with the following <code>run</code> script, which should be executable:</p>
<pre><code>#!/bin/sh

export USER=&quot;&lt;username&gt;&quot;
export HOME=&quot;/home/&lt;username&gt;&quot;

groups=&quot;$(id -Gn &quot;$USER&quot; | tr ' ' ':')&quot;
svdir=&quot;$HOME/service&quot;

exec chpst -u &quot;$USER:$groups&quot; runsvdir &quot;$svdir&quot;
</code></pre>
<p>In this example <a href="https://man.voidlinux.org/chpst.8">chpst(8)</a> is used to start a
new <a href="https://man.voidlinux.org/runsvdir.8">runsvdir(8)</a> process as the specified
user. <a href="https://man.voidlinux.org/chpst.8">chpst(8)</a> does not read groups on its
own, but expects the user to list all required groups separated by a <code>:</code>. The
<code>id</code> and <code>tr</code> pipe is used to create a list of all the user's groups in a way
<a href="https://man.voidlinux.org/chpst.8">chpst(8)</a> understands it. Note that we
export <code>$USER</code> and <code>$HOME</code> because some user services may not work without them.</p>
<p>The user can then create new services or symlinks to them in the
<code>/home/&lt;username&gt;/service</code> directory. To control the services using the
<a href="https://man.voidlinux.org/sv.8">sv(8)</a> command, the user can specify the
services by path, or by name if the <code>SVDIR</code> environment variable is set to the
user's services directory. This is shown in the following examples:</p>
<pre><code>$ sv status ~/service/*
run: /home/duncan/service/gpg-agent: (pid 901) 33102s
run: /home/duncan/service/ssh-agent: (pid 900) 33102s
$ SVDIR=~/service sv restart gpg-agent
ok: run: gpg-agent: (pid 19818) 0s
</code></pre>
<p>It may be convenient to export the <code>SVDIR=~/service</code> variable in your shell
profile.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="logging"><a class="header" href="#logging">Logging</a></h1>
<h2 id="syslog"><a class="header" href="#syslog">Syslog</a></h2>
<p>The default installation comes with no syslog daemon. However, there are syslog
implementations available in the EvolutionOS repositories.</p>
<h3 id="socklog"><a class="header" href="#socklog">Socklog</a></h3>
<p><a href="https://man.voidlinux.org/socklog.8">socklog(8)</a> is a syslog implementation
from the author of <a href="https://man.voidlinux.org/runit.8">runit(8)</a>. Use socklog if
you're not sure which syslog implementation to use. To enable it, install the
<code>socklog-void</code> package and enable the <code>socklog-unix</code> and <code>nanoklogd</code> services.
Ensure no other syslog daemon is running.</p>
<p>The logs are saved in sub-directories of <code>/var/log/socklog/</code>, and <code>svlogtail</code>
can be used to access them conveniently.</p>
<p>The ability to read logs is limited to <code>root</code> and users who are part of the
<code>socklog</code> group.</p>
<h3 id="other-syslog-daemons"><a class="header" href="#other-syslog-daemons">Other syslog daemons</a></h3>
<p>The EvolutionOS repositories also include packages for <code>rsyslog</code> and <code>metalog</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rcconf-rclocal-and-rcshutdown"><a class="header" href="#rcconf-rclocal-and-rcshutdown">rc.conf, rc.local and rc.shutdown</a></h1>
<p>The files <code>/etc/rc.conf</code>, <code>/etc/rc.local</code> and <code>/etc/rc.shutdown</code> can be used to
configure certain parts of your EvolutionOS system. <code>rc.conf</code> is often configured by
<code>evolution-installer</code>.</p>
<h2 id="rcconf"><a class="header" href="#rcconf">rc.conf</a></h2>
<p>Sourced in runit stages 1 and 3. This file can be used to set variables,
including the following:</p>
<h3 id="keymap"><a class="header" href="#keymap">KEYMAP</a></h3>
<p>Specifies which keymap to use for the Linux console. Available keymaps are
listed in <code>/usr/share/kbd/keymaps</code>. For example:</p>
<pre><code>KEYMAP=fr
</code></pre>
<p>For further details, refer to
<a href="https://man.voidlinux.org/loadkeys.1">loadkeys(1)</a>.</p>
<h3 id="hardwareclock"><a class="header" href="#hardwareclock">HARDWARECLOCK</a></h3>
<p>Specifies whether the hardware clock is set to UTC or local time.</p>
<p>By default this is set to <code>utc</code>. However, Windows sets the hardware clock to
local time, so if you are dual-booting with Windows, you need to either
configure Windows to use UTC, or set this variable to <code>localtime</code>.</p>
<p>For further details, refer to <a href="https://man.voidlinux.org/hwclock.8">hwclock(8)</a>.</p>
<h3 id="font"><a class="header" href="#font">FONT</a></h3>
<p>Specifies which font to use for the Linux console. Available fonts are listed in
<code>/usr/share/kbd/consolefonts</code>. For example:</p>
<pre><code>FONT=eurlatgr
</code></pre>
<p>For further details, refer to <a href="https://man.voidlinux.org/setfont.8">setfont(8)</a>.</p>
<h2 id="rclocal"><a class="header" href="#rclocal">rc.local</a></h2>
<p>Sourced in runit stage 2. A shell script which can be used to specify
configuration to be done prior to login.</p>
<h2 id="rcshutdown"><a class="header" href="#rcshutdown">rc.shutdown</a></h2>
<p>Sourced in runit stage 3. A shell script which can be used to specify tasks to
be done during shutdown.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cron"><a class="header" href="#cron">Cron</a></h1>
<p><a href="https://en.wikipedia.org/wiki/Cron">cron</a> is a daemon for running programs at
regular intervals. The programs and intervals are specified in a <code>crontab</code> file,
which can be edited with <a href="https://man.voidlinux.org/crontab.1">crontab(1)</a>.
Running <code>crontab -e</code> as the superuser will edit the system crontab; otherwise,
it will edit the crontab for the current user.</p>
<p>By default, a cron daemon is not installed. However, multiple cron
implementations are available, including
<a href="https://github.com/cronie-crond/cronie/">cronie</a>,
<a href="http://www.jimpryor.net/linux/dcron.html">dcron</a>,
<a href="http://fcron.free.fr/">fcron</a> and more.</p>
<p>Once you have chosen and installed an implementation,
<a href="config/./services/index.html#enabling-services">enable</a> the corresponding service. There
is also a generic <code>crond</code> service which is maintained by the alternatives
system, but there is no real benefit in using it and just makes your setup
harder to follow.</p>
<p>As an alternative to the standard cron implementations, you can use
<a href="https://man.voidlinux.org/snooze.1">snooze(1)</a> together with the
<code>snooze-hourly</code>, <code>snooze-daily</code>, <code>snooze-weekly</code> and <code>snooze-monthly</code> services,
which are provided by the <code>snooze</code> package for this purpose. Each of these
services execute scripts in the respective <code>/etc/cron.*</code> directories.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="solid-state-drives"><a class="header" href="#solid-state-drives">Solid State Drives</a></h1>
<p>Post installation, you will need to enable TRIM for solid state drives. You can
check which devices allow TRIM by running:</p>
<pre><code>$ lsblk --discard
</code></pre>
<p>If the DISC-GRAN (discard granularity) and DISC-MAX (discard maximum bytes)
columns are non-zero, that means the block device has TRIM support. If your
solid state drive partition does not show TRIM support, please verify that you
chose a file system with TRIM support (ext4, Btrfs, F2FS, etc.). Note that F2FS
requires kernel 4.19 or above to support TRIM.</p>
<p>To run TRIM one-shot, you can run
<a href="https://man.voidlinux.org/fstrim.8"><code>fstrim(8)</code></a> manually. For example, if your
/ directory is on an SSD:</p>
<pre><code># fstrim /
</code></pre>
<p>To automate running TRIM, use cron or add the <code>discard</code> option to <code>/etc/fstab</code>.</p>
<h2 id="periodic-trim-with-cron"><a class="header" href="#periodic-trim-with-cron">Periodic TRIM with cron</a></h2>
<p>Add the following lines to <code>/etc/cron.weekly/fstrim</code>:</p>
<pre><code>#!/bin/sh

fstrim /
</code></pre>
<p>Finally, make the script executable:</p>
<pre><code># chmod u+x /etc/cron.weekly/fstrim
</code></pre>
<h2 id="continuous-trim-with-fstab-discard"><a class="header" href="#continuous-trim-with-fstab-discard">Continuous TRIM with fstab discard</a></h2>
<p>You can use either continuous or periodic TRIM, but usage of continuous TRIM is
discouraged if you have an SSD that doesn't handle NCQ correctly. Refer to the
kernel
<a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/ata/libata-core.c?h=v5.8&amp;id=bcf876870b95592b52519ed4aafcf9d95999bc9c#n3774">blacklist</a>.</p>
<p>Edit <code>/etc/fstab</code> and add the <code>discard</code> option to block devices that need TRIM.</p>
<p>For example, if <code>/dev/sda1</code> was an SSD partition, formatted as ext4, and mounted
at <code>/</code>:</p>
<pre><code>/dev/sda1  /           ext4  defaults,discard   0  1
</code></pre>
<h2 id="lvm"><a class="header" href="#lvm">LVM</a></h2>
<p>To enable TRIM for LVM's commands (<code>lvremove</code>, <code>lvreduce</code>, etc.), open
<code>/etc/lvm/lvm.conf</code>, uncomment the <code>issue_discards</code> option, and set it to <code>1</code>:</p>
<pre><code>issue_discards=1
</code></pre>
<h2 id="luks"><a class="header" href="#luks">LUKS</a></h2>
<p><strong>Warning</strong>: Before enabling discard for your LUKS partition, please be aware of
the <a href="https://wiki.archlinux.org/index.php/Dm-crypt/Specialties#Discard/TRIM_support_for_solid_state_drives_(SSD)">security
implications</a>.</p>
<p>To open an encrypted LUKS device and allow discards to pass through, open the
device with the <code>--allow-discards</code> option:</p>
<pre><code># cryptsetup luksOpen --allow-discards /dev/sdaX luks
</code></pre>
<h3 id="non-root-devices"><a class="header" href="#non-root-devices">Non-root devices</a></h3>
<p>Edit <code>/etc/crypttab</code> and set the <code>discard</code> option for devices on the SSD. For
example, if you have a LUKS device with the name <code>externaldrive1</code>, device
<code>/dev/sdb2</code>, and password <code>none</code>:</p>
<pre><code>externaldrive1  /dev/sdb2   none    luks,discard
</code></pre>
<h3 id="root-devices"><a class="header" href="#root-devices">Root devices</a></h3>
<p>If your root device is on LUKS, add <code>rd.luks.allow-discards</code> to
<code>CMDLINE_LINUX_DEFAULT</code>. In the case of GRUB, edit <code>/etc/default/grub</code>:</p>
<pre><code>GRUB_CMDLINE_LINUX_DEFAULT=&quot;rd.luks.allow-discards&quot;
</code></pre>
<h3 id="verifying-configuration"><a class="header" href="#verifying-configuration">Verifying configuration</a></h3>
<p>To verify that you have configured TRIM correctly for LUKS, run:</p>
<pre><code># dmsetup table /dev/mapper/crypt_dev --showkeys
</code></pre>
<p>If this command output contains the string <code>allow_discards</code>, you have
successfully enabled TRIM on your LUKS device.</p>
<h2 id="zfs"><a class="header" href="#zfs">ZFS</a></h2>
<p>Before running <code>trim</code> on a ZFS pool, ensure that all devices in the pool support
it:</p>
<pre><code># zpool get all | grep trim
</code></pre>
<p>If the pool allows <code>autotrim</code> (set <code>off</code> by default), you can <code>trim</code> the pool
periodically or automatically. To one-shot <code>trim</code> <code>yourpoolname</code>:</p>
<pre><code># zpool trim yourpoolname
</code></pre>
<h3 id="periodic-trim"><a class="header" href="#periodic-trim">Periodic TRIM</a></h3>
<p>Add the following lines to <code>/etc/cron.daily/ztrim</code>:</p>
<pre><code>#!/bin/sh
zpool trim yourpoolname
</code></pre>
<p>Finally, make the script executable:</p>
<pre><code># chmod u+x /etc/cron.daily/ztrim
</code></pre>
<h3 id="autotrim"><a class="header" href="#autotrim">Autotrim</a></h3>
<p>To set autotrim for <code>yourpoolname</code>, run:</p>
<pre><code># zpool set autotrim=on yourpoolname
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="security"><a class="header" href="#security">Security</a></h1>
<p>There are several ways you can make your installation more secure. This section
explores some of them.</p>
<h2 id="section-contents-2"><a class="header" href="#section-contents-2">Section Contents</a></h2>
<ul>
<li><a href="config/security/./apparmor.html">AppArmor</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="apparmor"><a class="header" href="#apparmor">AppArmor</a></h1>
<p>AppArmor is a mandatory access control mechanism (like SELinux). It can
constrain programs based on pre-defined or generated policy definitions.</p>
<p>EvolutionOS ships with some default profiles for several services, such as <code>dhcpcd</code> and
<code>wpa_supplicant</code>. Container runtimes such as LXC and podman integrate with
AppArmor for better security for container payloads.</p>
<p>To use AppArmor on a system, one must:</p>
<ol>
<li>Install the <code>apparmor</code> package.</li>
<li>Set <code>apparmor=1 security=apparmor</code> on the kernel commandline.</li>
</ol>
<p>To accomplish the second step, consult <a href="config/security/./../kernel.html#cmdline">the documentation on how to modify the
kernel cmdline</a>.</p>
<p>The <code>APPARMOR</code> variable in <code>/etc/default/apparmor</code> controls how profiles will be
loaded at boot, the value is set to <code>complain</code> by default and corresponds to
AppArmor modes (<code>disable</code>, <code>complain</code>, <code>enforce</code>).</p>
<p>AppArmor tools <a href="https://man.voidlinux.org/aa-genprof.8">aa-genprof(8)</a> and
<a href="https://man.voidlinux.org/aa-logprof.8">aa-logprof(8)</a> require either
configured <a href="config/security/../services/logging.html">syslog</a> or a running
<a href="https://man.voidlinux.org/auditd.8">auditd(8)</a> service.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="date-and-time"><a class="header" href="#date-and-time">Date and Time</a></h1>
<p>To view your system's current date and time information, as well as make direct
changes to it, use <a href="https://man.voidlinux.org/date.1">date(1)</a>.</p>
<h2 id="timezone-1"><a class="header" href="#timezone-1">Timezone</a></h2>
<p>The default system timezone can be set by linking the timezone file to
<code>/etc/localtime</code>:</p>
<pre><code># ln -sf /usr/share/zoneinfo/&lt;timezone&gt; /etc/localtime
</code></pre>
<blockquote>
<p>Note: If the variable <code>TIMEZONE</code> is set in <code>/etc/rc.conf</code>, it should be
removed or commented out, as this will override what has been set with <code>ln</code> on
reboot.</p>
</blockquote>
<p>To change the timezone on a per user basis, the <code>TZ</code> variable can be exported
from your shell's profile:</p>
<pre><code>export TZ=&lt;timezone&gt;
</code></pre>
<p>Note that setting the <em>timezone</em> does not set the <em>time</em> (or date); instead, it
simply specifies an offset from
<a href="https://en.wikipedia.org/wiki/Coordinated_Universal_Time">UTC</a>, as described in
<a href="https://man.voidlinux.org/timezone.3">timezone(3)</a>.</p>
<h2 id="hardware-clock"><a class="header" href="#hardware-clock">Hardware clock</a></h2>
<p>By default, the hardware clock in EvolutionOS is stored as UTC. Windows does not use
UTC by default, and if you are dual-booting, this will conflict with EvolutionOS. You
can either change Windows to use UTC, or change EvolutionOS Linux to use <code>localtime</code> by
setting the <code>HARDWARECLOCK</code> variable in <code>/etc/rc.conf</code>:</p>
<pre><code>export HARDWARECLOCK=localtime
</code></pre>
<p>For more details, see <a href="https://man.voidlinux.org/hwclock.8">hwclock(8)</a>.</p>
<h2 id="ntp"><a class="header" href="#ntp">NTP</a></h2>
<p>To maintain accuracy of your system's clock, you can use the <a href="https://en.wikipedia.org/wiki/Network_Time_Protocol">Network Time
Protocol</a> (NTP).</p>
<p>EvolutionOS provides packages for three NTP daemons: NTP, OpenNTPD and Chrony.</p>
<p>Once you have installed an NTP daemon, you can <a href="config/../config/services/index.html#managing-services">enable the
service</a> for it, either through
its own service or the <code>ntpd</code> service managed by
<a href="https://man.voidlinux.org/xbps-alternatives.1">xbps-alternatives(1)</a>.</p>
<h3 id="ntp-1"><a class="header" href="#ntp-1">NTP</a></h3>
<p>NTP is the official reference implementation of the Network Time Protocol.</p>
<p>The <code>ntp</code> package provides NTP and the <code>isc-ntpd</code> service.</p>
<p>For further information, visit <a href="https://www.ntp.org/">the NTP site</a>.</p>
<h3 id="openntpd"><a class="header" href="#openntpd">OpenNTPD</a></h3>
<p>OpenNTPD focuses on providing a secure, lean NTP implementation which &quot;just
works&quot; with reasonable accuracy for a majority of use-cases.</p>
<p>The <code>openntpd</code> package provides OpenNTPD and the <code>openntpd</code> service.</p>
<p>For further information, visit <a href="https://www.openntpd.org/">the OpenNTPD site</a>.</p>
<h3 id="chrony"><a class="header" href="#chrony">Chrony</a></h3>
<p>Chrony is designed to work well in a variety of conditions; it can synchronize
faster and with greater accuracy than NTP.</p>
<p>The <code>chrony</code> package provides Chrony and the <code>chronyd</code> service.</p>
<p>The Chrony site provides <a href="https://chrony.tuxfamily.org/faq.html#_how_does_chrony_compare_to_ntpd">a brief overview of its advantages over
NTP</a>, as
well as <a href="https://chrony.tuxfamily.org/comparison.html">a detailed feature comparison between Chrony, NTP and
OpenNTPD</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="kernel"><a class="header" href="#kernel">Kernel</a></h1>
<h2 id="kernel-series"><a class="header" href="#kernel-series">Kernel series</a></h2>
<p>EvolutionOS provides many kernel series in the default repository. These are
named <code>linux&lt;x&gt;.&lt;y&gt;</code>: for example, <code>linux4.19</code>. You can query for all available
kernel series by running:</p>
<pre><code>$ xbps-query --regex -Rs '^linux[0-9.]+-[0-9._]+'
</code></pre>
<p>The <code>linux</code> meta package, installed by default, depends on one of the kernel
packages, usually the package containing the latest mainline kernel that works
with all DKMS modules. Newer kernels might be available in the repository, but
are not necessarily considered stable enough to be the default; use these at
your own risk. If you wish to use a more recent kernel and have DKMS modules
that you need to build, install the relevant <code>linux&lt;x&gt;.&lt;y&gt;-headers</code> package,
then use <a href="https://man.voidlinux.org/xbps-reconfigure.1">xbps-reconfigure(1)</a> to
reconfigure the <code>linux&lt;x&gt;.&lt;y&gt;</code> package you installed. This will build the DKMS
modules.</p>
<h2 id="removing-old-kernels"><a class="header" href="#removing-old-kernels">Removing old kernels</a></h2>
<p>When updating the kernel, old versions are left behind in case it is necessary
to roll back to an older version. Over time, old kernel versions can accumulate,
consuming disk space and increasing the time taken by DKMS module updates.
Furthermore, if <code>/boot</code> is a separate partition and fills up with old kernels,
updating can fail or result in incomplete initramfs filesystems to be generated
and result in kernel panics if they are being booted. Thus, it may be advisable
to clean old kernels from time to time.</p>
<p>Removing old kernels is done using the
<a href="https://man.voidlinux.org/vkpurge.8">vkpurge(8)</a> utility. <code>vkpurge</code> comes
pre-installed on every Void Linux system. This utility runs the necessary
<a href="config/kernel.html#kernel-hooks">hooks</a> when removing old kernels. Note that <code>vkpurge</code> does not
remove kernel <em>packages</em>, only particular <em>kernels</em>.</p>
<h2 id="removing-the-default-kernel-series"><a class="header" href="#removing-the-default-kernel-series">Removing the default kernel series</a></h2>
<p>If you've installed a kernel package for a series other than the default, and
want to remove the default kernel packages, you should install the <code>linux-base</code>
package or <a href="https://man.voidlinux.org/xbps-pkgdb.1">mark it as a manual package</a>
in case it is already installed. After this procedure, you can remove the
default kernel packages with
<a href="https://man.voidlinux.org/xbps-remove.1">xbps-remove(1)</a>. It might be necessary
to add <code>linux</code> and <code>linux-headers</code> to an <code>ignorepkg</code> entry in
<a href="https://man.voidlinux.org/xbps.d.5">xbps.d(5)</a>, since base packages can depend
on them.</p>
<h2 id="switching-to-another-kernel-series"><a class="header" href="#switching-to-another-kernel-series">Switching to another kernel series</a></h2>
<p>If you'd like to use the <code>linux-lts</code> or <code>linux-mainline</code> kernel series instead
of the default <code>linux</code>, first install the desired series metapackage (and the
<code>linux-lts-headers</code> or <code>linux-mainline-headers</code> metapackage if needed). Then you
can add <code>linux</code> and <code>linux-headers</code> to an <code>ignorepkg</code> entry in
<a href="https://man.voidlinux.org/xbps.d.5">xbps.d(5)</a> and uninstall those packages.</p>
<h2 id="changing-the-default-initramfs-generator"><a class="header" href="#changing-the-default-initramfs-generator">Changing the default initramfs generator</a></h2>
<p>By default, EvolutionOS uses <a href="https://man.voidlinux.org/dracut.8">dracut</a> to
prepare initramfs images for installed kernels. Alternatives such as
<a href="https://man.voidlinux.org/mkinitcpio.8">mkinitcpio</a> are available. Each
initramfs generator registers an <a href="https://man.voidlinux.org/xbps-alternatives.1">XBPS
alternative</a> in the <code>initramfs</code>
group to link its <a href="config/kernel.html#kernel-hooks">kernel hooks</a> to be used when creating or
removing initramfs images for a given kernel.</p>
<p>To replace dracut with, <em>e.g.</em>, mkinitcpio, install the <code>mkinitcpio</code> package;
confirm that <code>mkinitcpio</code> appears in the list of available alternatives by
running</p>
<pre><code>$ xbps-alternatives -l -g initramfs
</code></pre>
<p>Issue the command</p>
<pre><code># xbps-alternatives -s mkinitcpio
</code></pre>
<p>to replace the dracut kernel hooks with those provided by mkinitcpio. With
subsequent kernel updates (or updates to DKMS packages that trigger initramfs
regeneration), mkinitcpio will be used instead of dracut to prepare initramfs
images. To force images to regenerate, reconfigure your kernel packages by
invoking</p>
<pre><code># xbps-reconfigure -f linux&lt;x&gt;.&lt;y&gt;
</code></pre>
<p>for each <code>linux&lt;x&gt;.&lt;y&gt;</code> package that is currently installed.</p>
<h2 id="cmdline"><a class="header" href="#cmdline">cmdline</a></h2>
<p>The kernel, the initial RAM disk (initrd) and some system programs can be
configured at boot by kernel command line arguments. The parameters understood
by the kernel are explained in the <a href="https://www.kernel.org/doc/html/latest/admin-guide/kernel-parameters.html">kernel-parameters
documentation</a>
and by <a href="https://man.voidlinux.org/bootparam.7">bootparam(7)</a>. Parameters
understood by dracut can be found in
<a href="https://man.voidlinux.org/dracut.cmdline.7">dracut.cmdline(7)</a>.</p>
<p>Once the system is booted, the current kernel command line parameters can be
found in the <code>/proc/cmdline</code> file. Some system programs can change their
behavior based on the parameters passed in the command line, which is what
happens when <a href="config/./services/index.html#booting-a-different-runsvdir">booting a different
runsvdir</a>, for example.</p>
<p>There are different ways of setting these parameters, some of which are
explained below.</p>
<h3 id="grub"><a class="header" href="#grub">GRUB</a></h3>
<p>Kernel command line arguments can be added through the GRUB bootloader by
editing <code>/etc/default/grub</code>, changing the <code>GRUB_CMDLINE_LINUX_DEFAULT</code> variable
and then running <code>update-grub</code>.</p>
<h3 id="dracut"><a class="header" href="#dracut">dracut</a></h3>
<p>Dracut offers a <a href="https://man.voidlinux.org/dracut.conf.5"><code>kernel_cmdline</code> configuration
option</a> and <a href="https://man.voidlinux.org/dracut.8"><code>--kernel-cmdline</code>
command-line option</a> that will encode
command-line arguments directly in the initramfs image. When dracut is used to
create a UEFI executable, arguments set with these options will be passed to the
kernel. However, when an ordinary initramfs is produced, these options will
<em>not</em> be passed to the kernel at boot. Instead, they will be written to a
configuration file in <code>/etc/cmdline.d</code> within the image. While dracut parses
this configuration to control its own boot-time behavior, the kernel itself will
not be aware of anything set via this mechanism.</p>
<p>After modifying a dracut configuration, <a href="config/kernel.html#kernel-hooks">regenerate</a> the
initramfs to ensure that it includes the changes.</p>
<h2 id="kernel-hardening"><a class="header" href="#kernel-hardening">Kernel hardening</a></h2>
<p>EvolutionOS Linux ships with some kernel security options enabled by default. This was
originally provided by kernel command line arguments <code>slub_debug=P page_poison=1</code>, but since kernel series 5.3, these have been replaced with
<code>init_on_alloc</code> and <code>init_on_free</code> (see <a href="https://github.com/torvalds/linux/commit/6471384af">this
commit</a>).</p>
<p>Evolution's kernels come with the <code>init_on_alloc</code> option enabled by default where
available (i.e. <code>linux5.4</code> and greater). In most cases you should usually not
disable it, as it has a fairly minimal impact on performance (within 1%). The
<code>init_on_free</code> option is more expensive (around 5% on average) and needs to be
enabled manually by passing <code>init_on_free=1</code> on the kernel command line. If you
need to disable <code>init_on_alloc</code>, you can do that similarly by passing
<code>init_on_alloc=0</code>.</p>
<p>There is a chance that your existing system still has the old options enabled.
They still work in newer kernels, but have a performance impact more in line
with <code>init_on_free=1</code>. On older hardware this can be quite noticeable. If you
are running a kernel series older than 5.4, you can keep them (or add them) for
extra security at the cost of speed; otherwise you should remove them.</p>
<h2 id="kernel-modules"><a class="header" href="#kernel-modules">Kernel modules</a></h2>
<p>Kernel modules are typically drivers for devices or filesystems.</p>
<h3 id="loading-kernel-modules-during-boot"><a class="header" href="#loading-kernel-modules-during-boot">Loading kernel modules during boot</a></h3>
<p>Normally the kernel automatically loads required modules, but sometimes it may
be necessary to explicitly specify modules to be loaded during boot.</p>
<p>To load kernel modules during boot, a <code>.conf</code> file like
<code>/etc/modules-load.d/virtio.conf</code> needs to be created with the contents:</p>
<pre><code># load virtio-net
virtio-net
</code></pre>
<h3 id="blacklisting-kernel-modules"><a class="header" href="#blacklisting-kernel-modules">Blacklisting kernel modules</a></h3>
<p>Blacklisting kernel modules is a method for preventing modules from being loaded
by the kernel. There are two different methods for blacklisting kernel modules,
one for modules loaded by the initramfs and one for modules loaded after the
initramfs process is done. Modules loaded by the initramfs have to be
blacklisted in the initramfs configuration.</p>
<p>To blacklist modules loaded after the initramfs process, create a <code>.conf</code> file,
like <code>/etc/modprobe.d/radeon.conf</code>, with the contents:</p>
<pre><code>blacklist radeon
</code></pre>
<h4 id="blacklisting-modules-in-the-initramfs"><a class="header" href="#blacklisting-modules-in-the-initramfs">Blacklisting modules in the initramfs</a></h4>
<p>After making the necessary changes to the configuration files, the initramfs
needs to be <a href="config/kernel.html#kernel-hooks">regenerated</a> for the changes to take effect on the
next boot.</p>
<h5 id="dracut-1"><a class="header" href="#dracut-1">dracut</a></h5>
<p>Dracut can be configured to not include kernel modules through a configuration
file. To blacklist modules from being included in a dracut initramfs, create a
<code>.conf</code> file, like <code>/etc/dracut.conf.d/radeon.conf</code>, with the contents:</p>
<pre><code>omit_drivers+=&quot; radeon &quot;
</code></pre>
<h5 id="mkinitcpio"><a class="header" href="#mkinitcpio">mkinitcpio</a></h5>
<p>To blacklist modules from being included in a mkinitcpio initramfs a <code>.conf</code>
file needs to be created like <code>/etc/modprobe.d/radeon.conf</code> with the contents:</p>
<pre><code>blacklist radeon
</code></pre>
<h2 id="kernel-hooks"><a class="header" href="#kernel-hooks">Kernel hooks</a></h2>
<p>EvolutionOS provides directories for kernel hooks in
<code>/etc/kernel.d/{pre-install,post-install,pre-remove,post-remove}</code>.</p>
<p>These hooks are used to update the boot menus for bootloaders like <code>grub</code>,
<code>gummiboot</code> and <code>lilo</code>.</p>
<h3 id="install-hooks"><a class="header" href="#install-hooks">Install hooks</a></h3>
<p>The <code>{pre,post}-install</code> hooks are executed by
<a href="https://man.voidlinux.org/xbps-reconfigure.1">xbps-reconfigure(1)</a> when
configuring a Linux kernel, such as building its initramfs. This happens when a
kernel series is installed for the first time or updated, but can also be run
manually:</p>
<pre><code># xbps-reconfigure --force linux&lt;x&gt;.&lt;y&gt;
</code></pre>
<p>If run manually, they serve to apply initramfs configuration changes to the next
boot.</p>
<h3 id="remove-hooks"><a class="header" href="#remove-hooks">Remove hooks</a></h3>
<p>The <code>{pre,post}-remove</code> hooks are executed by
<a href="https://man.voidlinux.org/vkpurge.8">vkpurge(8)</a> when removing old kernels.</p>
<h2 id="dynamic-kernel-module-support-dkms"><a class="header" href="#dynamic-kernel-module-support-dkms">Dynamic Kernel Module Support (DKMS)</a></h2>
<p>There are kernel modules that are not part of the Linux source tree that are
built at install time using DKMS and <a href="config/kernel.html#kernel-hooks">kernel hooks</a>. The
available modules can be listed by searching for <code>dkms</code> in the package
repositories.</p>
<p>DKMS build logs are available in <code>/var/lib/dkms/</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="power-management"><a class="header" href="#power-management">Power Management</a></h1>
<h2 id="acpid"><a class="header" href="#acpid">acpid</a></h2>
<p>The <code>acpid</code> service for <a href="https://man.voidlinux.org/acpid.8">acpid(8)</a> is
installed. ACPI events are handled by <code>/etc/acpi/handler.sh</code>, which uses 
<a href="https://man.voidlinux.org/zzz.8">zzz(8)</a> for suspend-to-RAM events.</p>
<h2 id="elogind"><a class="header" href="#elogind">elogind</a></h2>
<p>The <code>elogind</code> service is provided by the <code>elogind</code> package. By default,
<a href="https://man.voidlinux.org/elogind.8">elogind(8)</a> listens for, and processes,
ACPI events related to lid-switch activation and the <em>power</em>, <em>suspend</em> and
<em>hibernate</em> keys. This will conflict with the <code>acpid</code> service if it is installed
and enabled. Either disable <code>acpid</code> when enabling <code>elogind</code>, or configure
<code>elogind</code> to <code>ignore</code> ACPI events in
<a href="https://man.voidlinux.org/logind.conf.5">logind.conf(5)</a>. There are several
configuration options, all starting with the keyword <code>Handle</code>, that should be
set to <code>ignore</code> to avoid interfering with <code>acpid</code>.</p>
<h2 id="power-saving---tlp"><a class="header" href="#power-saving---tlp">Power Saving - tlp</a></h2>
<p>Laptop battery life can be extended by using
<a href="https://man.voidlinux.org/tlp.8">tlp(8)</a>. To use it, install the <code>tlp</code> package,
and <a href="config/./services/index.html#enabling-services">enable</a> the <code>tlp</code> service. Refer to
<a href="https://linrunner.de/tlp/">the TLP documentation</a> for details.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="network-1"><a class="header" href="#network-1">Network</a></h1>
<p>Network configuration in EvolutionOS can be done in several ways. The default
installation comes with the <a href="https://man.voidlinux.org/dhcpcd.8">dhcpcd(8)</a>
service enabled.</p>
<h2 id="interface-names"><a class="header" href="#interface-names">Interface Names</a></h2>
<p>Newer versions of <a href="https://man.voidlinux.org/udev.7">udev(7)</a> no longer use the
traditional Linux naming scheme for interfaces (<code>eth0</code>, <code>eth1</code>, <code>wlan0</code>, ...).</p>
<p>This behavior can be reverted by adding <code>net.ifnames=0</code> to the <a href="config/network/../kernel.html#cmdline">kernel
cmdline</a>.</p>
<h2 id="static-configuration"><a class="header" href="#static-configuration">Static Configuration</a></h2>
<p>A simple way to configure a static network at boot is to add the necessary
<a href="https://man.voidlinux.org/ip.8">ip(8)</a> commands to the <code>/etc/rc.local</code> file:</p>
<pre><code>ip link set dev eth0 up
ip addr add 192.168.1.2/24 brd + dev eth0
ip route add default via 192.168.1.1
</code></pre>
<h2 id="bridge-interfaces"><a class="header" href="#bridge-interfaces">Bridge Interfaces</a></h2>
<p>To configure bridge interfaces at boot, the <code>/etc/rc.local</code> file can be used to
run <a href="https://man.voidlinux.org/ip.8">ip(8)</a> commands to add the bridge <code>br0</code> and
set it as the master for the <code>eth0</code> interface as example:</p>
<pre><code>ip link add name br0 type bridge
ip link set eth0 master br0
ip link set eth0 up
</code></pre>
<h2 id="dhcpcd"><a class="header" href="#dhcpcd">dhcpcd</a></h2>
<p>To run <a href="https://man.voidlinux.org/dhcpcd.8">dhcpcd(8)</a> on all interfaces, enable
the <code>dhcpcd</code> service.</p>
<p>To run <code>dhcpcd</code> only on a specific interface, copy the <code>dhcpcd-eth0</code> service and
modify it to match your interface:</p>
<pre><code>$ ip link show
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
2: enp3s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT group default qlen 1000
        link/ether ff:ff:ff:ff:ff:ff brd ff:ff:ff:f
# cp -R /etc/sv/dhcpcd-eth0 /etc/sv/dhcpcd-enp3s0
# sed -i 's/eth0/enp3s0/' /etc/sv/dhcpcd-enp3s0/run
# ln -s /etc/sv/dhcpcd-enp3s0 /var/service/
</code></pre>
<p>For more information on configuring <code>dhcpcd</code>, refer to
<a href="https://man.voidlinux.org/dhcpcd.conf.5">dhcpcd.conf(5)</a></p>
<h2 id="wireless"><a class="header" href="#wireless">Wireless</a></h2>
<p>Before using wireless networking, use
<a href="https://man.voidlinux.org/rfkill.8">rfkill(8)</a> to check whether the relevant
interfaces are soft- or hard-blocked.</p>
<p>EvolutionOS provides several ways to connect to wireless networks:</p>
<ul>
<li><a href="config/network/./wpa_supplicant.html">wpa_supplicant</a></li>
<li><a href="config/network/./iwd.html">iwd</a></li>
<li><a href="config/network/./networkmanager.html">NetworkManager</a></li>
<li><a href="config/network/./connman.html">ConnMan</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="firewalls"><a class="header" href="#firewalls">Firewalls</a></h1>
<h2 id="iptables"><a class="header" href="#iptables">iptables</a></h2>
<p>By default, the <code>iptables</code> package is installed on the base system. It provides
<a href="https://man.voidlinux.org/iptables.8">iptables(8)/ip6tables(8)</a>. The related
services use the <code>/etc/iptables/iptables.rules</code> and
<code>/etc/iptables/ip6tables.rules</code> ruleset files, which must be created by the
system administrator.</p>
<p>Two example rulesets are provided in the <code>/etc/iptables</code> directory:
<code>empty.rules</code> and <code>simple_firewall.rules</code>.</p>
<h3 id="applying-the-rules-at-boot"><a class="header" href="#applying-the-rules-at-boot">Applying the rules at boot</a></h3>
<p>To apply iptables rules at runit stage 1, install the <code>runit-iptables</code> package.
This adds a core-service which restores the <code>iptables.rules</code> and
<code>ip6tables.rules</code> rulesets.</p>
<p>Alternatively, to apply these rules at stage 2, add the following to
<code>/etc/rc.local</code>:</p>
<pre><code>if [ -e /etc/iptables/iptables.rules ]; then
  iptables-restore /etc/iptables/iptables.rules
fi

if [ -e /etc/iptables/ip6tables.rules ]; then
  ip6tables-restore /etc/iptables/ip6tables.rules
fi
</code></pre>
<p>After rebooting, check the active firewall rules:</p>
<pre><code># iptables -L
# ip6tables -L
</code></pre>
<h3 id="applying-the-rules-at-runtime"><a class="header" href="#applying-the-rules-at-runtime">Applying the rules at runtime</a></h3>
<p><code>iptables</code> comes with two runit services, <code>iptables</code> and <code>ip6tables</code>, to quickly
flush or restore the <code>iptables.rules</code> and <code>ip6tables.rules</code> rulesets. Once these
services are <a href="config/network/../services/index.html#enabling-services">enabled</a>, you can flush
the rulesets by downing the relevant service, e.g.:</p>
<pre><code># sv down iptables
</code></pre>
<p>and restore them by upping the relevant service, e.g.:</p>
<pre><code># sv up ip6tables
</code></pre>
<h2 id="nftables"><a class="header" href="#nftables">nftables</a></h2>
<p><code>nftables</code> replaces <code>iptables</code>, <code>ip6tables</code>, <code>arptables</code> and <code>ebtables</code>
(collectively referred to as <code>xtables</code>). The <a href="https://wiki.nftables.org/wiki-nftables/index.php/Main_Page">nftables
wiki</a> describes
<a href="https://wiki.nftables.org/wiki-nftables/index.php/Main_differences_with_iptables">the main
differences</a>
from the <code>iptables</code> toolset.</p>
<p>To use <code>nftables</code>, install the <code>nftables</code> package, which provides
<a href="https://man.voidlinux.org/nft.8">nft(8)</a>. It also provides
<a href="https://man.voidlinux.org/iptables-translate.8">iptables-translate(8)/ip6tables-translate(8)</a>
and
<a href="https://man.voidlinux.org/iptables-restore-translate.8">iptables-restore-translate(8)/ip6tables-restore-translate(8)</a>,
which convert <code>iptables</code> rules to <code>nftables</code> rules.</p>
<h3 id="applying-the-rules-at-boot-1"><a class="header" href="#applying-the-rules-at-boot-1">Applying the rules at boot</a></h3>
<p>To apply nftables rules at runit stage 1, install the <code>runit-nftables</code> package.
This adds a core-service which restores the ruleset in <code>/etc/nftables.conf</code>.</p>
<h3 id="applying-the-rules-at-runtime-1"><a class="header" href="#applying-the-rules-at-runtime-1">Applying the rules at runtime</a></h3>
<p>The <code>nftables</code> package provides the <code>nftables</code> service, which uses rules from
<code>/etc/nftables.conf</code>. Once you <a href="config/network/../services/index.html#enabling-service">enable</a>
the <code>nftables</code> service, to load the rules, run:</p>
<pre><code># sv up nftables
</code></pre>
<p>To flush the rules, run:</p>
<pre><code># sv down nftables
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="wpa_supplicant"><a class="header" href="#wpa_supplicant">wpa_supplicant</a></h1>
<p>The <code>wpa_supplicant</code> package is installed by default on the base system. It
includes utilities to configure wireless interfaces and handle wireless security
protocols. To use wpa_supplicant, you will need to enable <a href="config/network/wpa_supplicant.html#the-wpa_supplicant-service">the wpa_supplicant
service</a>.</p>
<p><a href="https://man.voidlinux.org/wpa_supplicant.8">wpa_supplicant(8)</a> is a daemon that
manages wireless interfaces based on
<a href="https://man.voidlinux.org/wpa_supplicant.conf.5">wpa_supplicant.conf(5)</a>
configuration files. An extensive overview of configuration options, including
examples, can be found in
<code>/usr/share/examples/wpa_supplicant/wpa_supplicant.conf</code>.</p>
<p><a href="https://man.voidlinux.org/wpa_passphrase.8">wpa_passphrase(8)</a> helps create
pre-shared keys for use in configuration files.
<a href="https://man.voidlinux.org/wpa_cli.8">wpa_cli(8)</a> provides a CLI for managing
the <code>wpa_supplicant</code> daemon.</p>
<h2 id="wpa-psk"><a class="header" href="#wpa-psk">WPA-PSK</a></h2>
<p>To use WPA-PSK, generate a pre-shared key with
<a href="https://man.voidlinux.org/wpa_passphrase.8">wpa_passphrase(8)</a> and append the
output to the relevant <code>wpa_supplicant.conf</code> file:</p>
<pre><code># wpa_passphrase &lt;MYSSID&gt; &lt;passphrase&gt; &gt;&gt; /etc/wpa_supplicant/wpa_supplicant-&lt;device_name&gt;.conf
</code></pre>
<h2 id="wpa-eap"><a class="header" href="#wpa-eap">WPA-EAP</a></h2>
<p>WPA-EAP is often used for institutional logins, notably eduroam. This does not
use PSK, but a password hash can be generated like this:</p>
<pre><code>$ echo -n &lt;passphrase&gt; | iconv -t utf16le | openssl md4
</code></pre>
<h2 id="wep"><a class="header" href="#wep">WEP</a></h2>
<p>For WEP configuration, add the following lines to your device's
<code>wpa-supplicant.conf</code>:</p>
<pre><code>network={
    ssid=&quot;MYSSID&quot;
    key_mgmt=NONE
    wep_key0=&quot;YOUR AP WEP KEY&quot;
    wep_tx_keyidx=0
    auth_alg=SHARED
}
</code></pre>
<h3 id="the-wpa_supplicant-service"><a class="header" href="#the-wpa_supplicant-service">The wpa_supplicant service</a></h3>
<p>The <code>wpa_supplicant</code> service checks the following options in
<code>/etc/sv/wpa_supplicant/conf</code>:</p>
<ul>
<li><code>OPTS</code>: Options to be passed to the service. Overrides any other options.</li>
<li><code>CONF_FILE</code>: Path to file to be used for configuration. Defaults to
<code>/etc/wpa_supplicant/wpa_supplicant.conf</code>.</li>
<li><code>WPA_INTERFACE</code>: Interface to be matched. May contain a wildcard; defaults to
all interfaces.</li>
<li><code>DRIVER</code>: Driver to use. See <code>wpa_supplicant -h</code> for available drivers.</li>
</ul>
<p>If no <code>conf</code> file is found, the service searches for the following files in
<code>/etc/wpa_supplicant</code>:</p>
<ul>
<li><code>wpa_supplicant-&lt;interface&gt;.conf</code>: If found, these files are bound to the
named interface.</li>
<li><code>wpa_supplicant.conf</code>: If found, this file is loaded and binds to all other
interfaces found.</li>
</ul>
<p>Once you are satisfied with your configuration,
<a href="config/network/../services/index.html#enabling-services">enable</a> the <code>wpa_supplicant</code> service.</p>
<h3 id="using-wpa_cli"><a class="header" href="#using-wpa_cli">Using wpa_cli</a></h3>
<p>When using <code>wpa_cli</code> to manage <code>wpa_supplicant</code> from the command line, be sure
to specify which network interface to use via the <code>-i</code> option, e.g.:</p>
<pre><code># wpa_cli -i wlp2s0
</code></pre>
<p>Not doing so can result in various <code>wpa_cli</code> commands (for example, <code>scan</code> and
<code>scan_results</code>) not producing the expected output.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="iwd"><a class="header" href="#iwd">IWD</a></h1>
<p><a href="https://iwd.wiki.kernel.org/">IWD</a> (iNet Wireless Daemon) is a wireless daemon
for Linux that aims to replace <a href="config/network/./wpa_supplicant.html">WPA supplicant</a>.</p>
<h2 id="installation-2"><a class="header" href="#installation-2">Installation</a></h2>
<p>Install the <code>iwd</code> package and enable the <code>dbus</code> and <code>iwd</code> services.</p>
<h2 id="usage"><a class="header" href="#usage">Usage</a></h2>
<p>The command-line client <a href="https://man.voidlinux.org/iwctl.1">iwctl(1)</a> can be
used to add, remove, and configure network connections. Commands can be passed
as arguments; when run without arguments, it provides an interactive session. To
list available commands, run <code>iwctl help</code>, or run <code>iwctl</code> and enter <code>help</code> at
the interactive prompt.</p>
<p>By default, only the root user and those in the <code>wheel</code> group have permission to
operate <code>iwctl</code>.</p>
<h2 id="configuration-2"><a class="header" href="#configuration-2">Configuration</a></h2>
<p>Configuration options and examples are described below. Consult the relevant
manual pages and the <a href="https://iwd.wiki.kernel.org/networkconfigurationsettings">upstream
documentation</a> for
further information.</p>
<h3 id="daemon-configuration"><a class="header" href="#daemon-configuration">Daemon configuration</a></h3>
<p>The main configuration file is located in <code>/etc/iwd/main.conf</code>. If it does not
exist, you may create it. It is documented in
<a href="https://man.voidlinux.org/iwd.config.5">iwd.config(5)</a>.</p>
<h3 id="network-configuration"><a class="header" href="#network-configuration">Network configuration</a></h3>
<p>Network configuration, including examples, is documented in
<a href="https://man.voidlinux.org/iwd.network.5">iwd.network(5)</a>. IWD stores
information on known networks, and reads information on pre-provisioned networks
from network configuration files located in <code>/var/lib/iwd</code>; IWD monitors the
directory for changes. Network configuration filenames consist of the encoding
of the SSID followed by <code>.open</code>, <code>.psk</code>, or <code>.8021x</code> as determined by the
security type.</p>
<p>As an example, a basic configuration file for a WPA2/PSK secured network would
be called <code>&lt;ssid&gt;.psk</code>, and it would contain the plain text password:</p>
<pre><code>[Security]
Passphrase=&lt;password&gt;
</code></pre>
<h2 id="troubleshooting"><a class="header" href="#troubleshooting">Troubleshooting</a></h2>
<p>By default, IWD will create and destroy the wireless interfaces (e.g. <code>wlan0</code>)
that it manages. This can interfere with <code>udevd</code>, which may attempt to rename
the interface using its rules for persistent network interface names. The
following messages may be printed to your screen as a symptom of this
interference:</p>
<pre><code>[   39.441723] udevd[1100]: Error changing net interface name wlan0 to wlp59s0: Device or resource busy
[   39.442472] udevd[1100]: could not rename interface '3' from 'wlan0' to 'wlp59s0': Device or resource busy
</code></pre>
<p>A simple fix is to prevent IWD from manipulating the network interfaces in this
way by adding <code>UseDefaultInterface=true</code> to the <code>[General]</code> section of
<code>/etc/iwd/main.conf</code>.</p>
<p>An alternative approach is to disable the use of persistent network interface
names by <code>udevd</code>. This may be accomplished either by adding <code>net.ifnames=0</code> to
your kernel <a href="config/network/../kernel.html#cmdline">cmdline</a> or by creating a symbolic link to
<code>/dev/null</code> at <code>/etc/udev/rules.d/80-net-name-slot.rules</code> to mask the renaming
rule. This alternative approach will affect the naming of all network devices.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="networkmanager"><a class="header" href="#networkmanager">NetworkManager</a></h1>
<p><a href="https://man.voidlinux.org/NetworkManager.8">NetworkManager(8)</a> is a daemon that
manages Ethernet, Wi-Fi, and mobile broadband network connections. Install the
<code>NetworkManager</code> package for the basic NetworkManager utilities.</p>
<h2 id="starting-networkmanager"><a class="header" href="#starting-networkmanager">Starting NetworkManager</a></h2>
<p>Before enabling the NetworkManager daemon, <a href="config/network/../services/index.html">disable</a> any
other network management services, such as <a href="config/network/./index.html#dhcpcd">dhcpcd</a>,
<a href="config/network/./wpa_supplicant.html">wpa_supplicant</a>, or <code>wicd</code>. These services all control
network interface configuration, and will interfere with NetworkManager.</p>
<p>Also ensure that the <code>dbus</code> service is <a href="config/network/../services/index.html">enabled</a> and
running. NetworkManager uses <code>dbus</code> to expose networking information and a
control interface to clients, and will fail to start without it.</p>
<p>Finally, enable the <code>NetworkManager</code> service.</p>
<h2 id="configuring-networkmanager"><a class="header" href="#configuring-networkmanager">Configuring NetworkManager</a></h2>
<p>Users of NetworkManager must belong to the <code>network</code> group.</p>
<p>The <code>NetworkManager</code> package includes a command line tool,
<a href="https://man.voidlinux.org/nmcli.1">nmcli(1)</a>, and a text-based user interface,
<a href="https://man.voidlinux.org/nmtui.1">nmtui(1)</a>, to control network settings.</p>
<p>There are many other front-ends to NetworkManager, including <code>nm-applet</code> for
system trays, <code>nm-plasma</code> for KDE Plasma, and a built-in network configuration
tool in GNOME.</p>
<h2 id="eduroam-with-networkmanager"><a class="header" href="#eduroam-with-networkmanager">Eduroam with NetworkManager</a></h2>
<p>Eduroam is a roaming service providing international, secure Internet access at
universities and other academic institutions. More information can be found
<a href="https://eduroam.org/">here</a>.</p>
<h3 id="dependencies"><a class="header" href="#dependencies">Dependencies</a></h3>
<p>Install the <code>python3-dbus</code> package.</p>
<h3 id="installation-3"><a class="header" href="#installation-3">Installation</a></h3>
<p>Download the correct eduroam_cat installer for your institution from
<a href="https://cat.eduroam.org/">here</a> and execute it. It will provide a user
interface guiding you through the process.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="connman"><a class="header" href="#connman">ConnMan</a></h1>
<p><a href="https://man.voidlinux.org/connman.8">ConnMan(8)</a> is a daemon that manages
network connections, is designed to be slim and to use as few resources as
possible. The <code>connman</code> package contains the basic utilities to run ConnMan.</p>
<h2 id="starting-connman"><a class="header" href="#starting-connman">Starting ConnMan</a></h2>
<p>To enable the ConnMan daemon, first <a href="config/network/../services/index.html">disable</a> any other
network managing services like <a href="config/network/./index.html#dhcpcd">dhcpcd</a>,
<a href="config/network/./wpa_supplicant.html">wpa_supplicant</a>, or <code>wicd</code>. These services all control
network interface configuration, and interfere with each other.</p>
<p>Finally, enable the <code>connmand</code> service.</p>
<h2 id="configuring-connman"><a class="header" href="#configuring-connman">Configuring ConnMan</a></h2>
<h3 id="connman-cli"><a class="header" href="#connman-cli">ConnMan CLI</a></h3>
<p>The <code>connman</code> package includes a command line tool,
<a href="https://man.voidlinux.org/connmanctl.1">connmanctl(1)</a> to control network
settings. If you do not provide any commands, <code>connmanctl</code> starts as an
interactive shell.</p>
<p>Establishing a connection to an access point using the <code>connmanctl</code> interactive
shell might look as follows:</p>
<pre><code># connmanctl
&gt; enable wifi
&gt; agent on
&gt; scan wifi
&gt; services
&gt; connect wifi_&lt;uniqueid&gt;
&gt; exit
</code></pre>
<h3 id="connman-front-end-tools"><a class="header" href="#connman-front-end-tools">ConnMan Front-End Tools</a></h3>
<p>There are many other front-ends to ConnMan, including <code>connman-ui</code> for system
trays, <code>connman-gtk</code> for GTK, <code>cmst</code> for QT and <code>connman-ncurses</code> for ncurses
based UI.</p>
<h2 id="preventing-dns-overrides-by-connman"><a class="header" href="#preventing-dns-overrides-by-connman">Preventing DNS overrides by ConnMan</a></h2>
<p>Create <code>/etc/sv/connmand/conf</code> with the following content:</p>
<pre><code>OPTS=&quot;--nodnsproxy&quot;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="network-filesystems"><a class="header" href="#network-filesystems">Network Filesystems</a></h1>
<h2 id="nfs"><a class="header" href="#nfs">NFS</a></h2>
<h3 id="mounting-an-nfs-share"><a class="header" href="#mounting-an-nfs-share">Mounting an NFS Share</a></h3>
<p>To mount an NFS share, start by installing the <code>nfs-utils</code> and <code>sv-netmount</code>
packages.</p>
<p>Before mounting an NFS share, <a href="config/./services/index.html#enabling-services">enable</a>
the <code>statd</code>, <code>rpcbind</code>, and <code>netmount</code> services. If the server supports <code>nfs4</code>,
the <code>statd</code> service isn't necessary.</p>
<p>To mount an NFS share:</p>
<pre><code># mount -t &lt;mount_type&gt; &lt;host&gt;:/path/to/sourcedir /path/to/destdir
</code></pre>
<p><code>&lt;mount_type&gt;</code> should be <code>nfs4</code> if the server supports it, or <code>nfs</code> otherwise.
<code>&lt;host&gt;</code> can be either the hostname or IP address of the server.</p>
<p>Mounting options can be found in
<a href="https://man.voidlinux.org/mount.nfs.8">mount.nfs(8)</a>, while unmounting options
can be found in <a href="https://man.voidlinux.org/umount.nfs.8">umount.nfs(8)</a>.</p>
<p>For example, to connect <code>/volume</code> on a server at <code>192.168.1.99</code> to an existing
<code>/mnt/volume</code> directory on your local system:</p>
<pre><code># mount -t nfs 192.168.1.99:/volume /mnt/volume
</code></pre>
<p>To have the directory mounted when the system boots, add an entry to
<a href="https://man.voidlinux.org/fstab.5">fstab(5)</a>:</p>
<pre><code>192.168.1.99:/volume /mnt/volume nfs rw,hard 0 0
</code></pre>
<p>Refer to <a href="https://man.voidlinux.org/nfs.5">nfs(5)</a> for information about the
available mounting options.</p>
<h3 id="setting-up-a-server-nfsv4-kerberos-disabled"><a class="header" href="#setting-up-a-server-nfsv4-kerberos-disabled">Setting up a server (NFSv4, Kerberos disabled)</a></h3>
<p>To run an NFS server, start by installing the <code>nfs-utils</code> package.</p>
<p>Edit <code>/etc/exports</code> to add a shared volume:</p>
<pre><code>/storage/foo    *.local(rw,no_subtree_check,no_root_squash)
</code></pre>
<p>This line exports the <code>/storage/foo</code> directory to any host in the local domain,
with read/write access. For information about the <code>no_subtree_check</code> and
<code>no_root_squash</code> options, and available options more generally, refer to
<a href="https://man.voidlinux.org/exports.5">exports(5)</a>.</p>
<p>Finally, <a href="config/./services/index.html#enabling-services">enable</a> the <code>rpcbind</code>, <code>statd</code>,
and <code>nfs-server</code> services.</p>
<p>This will start your NFS server. To check if the shares are working, use the
<a href="https://man.voidlinux.org/showmount.8">showmount(8)</a> utility to check the NFS
server status:</p>
<pre><code># showmount -e localhost
</code></pre>
<p>You can use <a href="https://man.voidlinux.org/nfs.conf.5">nfs.conf(5)</a> to configure
your server.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="session-and-seat-management"><a class="header" href="#session-and-seat-management">Session and Seat Management</a></h1>
<p>Session and seat management is not necessary for every setup, but it can be used
to safely create temporary runtime directories, provide access to hardware
devices and multi-seat capabilities, and control system shutdown.</p>
<h2 id="d-bus"><a class="header" href="#d-bus">D-Bus</a></h2>
<p>D-Bus is an IPC (inter-process communication) mechanism used by userspace
software in Linux. D-Bus can provide a system bus and/or a session bus, the
latter being specific to a user session.</p>
<ul>
<li>To provide a system bus, you should <a href="config/./services/index.html">enable</a> the <code>dbus</code>
service. This might require a system reboot to work properly.</li>
<li>To provide a session bus, you can start a given program (usually a window
manager or interactive shell) with
<a href="https://man.voidlinux.org/dbus-run-session.1">dbus-run-session(1)</a>. Most
desktop environments, if launched through an adequate display manager, will
launch a D-Bus session themselves.</li>
</ul>
<p>Note that some software assumes the presence of a system bus, while other
software assumes the presence of a session bus.</p>
<h2 id="elogind-1"><a class="header" href="#elogind-1">elogind</a></h2>
<p><a href="https://man.voidlinux.org/elogind.8">elogind(8)</a> manages user logins and system
power, as a standalone version of <code>systemd-logind</code>. elogind provides necessary
features for most desktop environments and Wayland compositors. It can also be
one of the mechanisms for rootless <a href="config/./graphical-session/xorg.html">Xorg</a>.</p>
<p>Please read the &quot;<a href="config/./power-management.html">Power Management</a>&quot; section for things
to consider before installing elogind.</p>
<p>To make use of its features, install the <code>elogind</code> package and make sure the
<a href="config/session-management.html#d-bus">system D-Bus</a> is enabled. You might need to log out and in again.</p>
<p>If you're having any issues with elogind, <a href="config/./services/index.html">enable</a> its
service, as waiting for a D-Bus activation can lead to issues.</p>
<h2 id="seatd"><a class="header" href="#seatd">seatd</a></h2>
<p><a href="https://man.voidlinux.org/seatd.1">seatd(1)</a> is a minimal seat management
daemon and an alternative to elogind primarily for <a href="config/./graphical-session/wayland.html#standalone-compositors">wlroots
compositors</a>.</p>
<p>To use it, install the <code>seatd</code> package and enable its service. If you want
non-root users to be able to access the seatd session, add them to the <code>_seatd</code>
group.</p>
<p>Note that, unlike elogind, seatd doesn't do anything besides managing seats.</p>
<h2 id="xdg_runtime_dir"><a class="header" href="#xdg_runtime_dir">XDG_RUNTIME_DIR</a></h2>
<p><code>XDG_RUNTIME_DIR</code> is an environment variable defined by the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory
Specification</a>.
Its value sets the path to the base directory where programs should store
user-specific runtime files.</p>
<p>Install <a href="config/session-management.html#elogind">elogind</a> as your session manager to automatically set up
<code>XDG_RUNTIME_DIR</code>.</p>
<p>Alternatively, manually set the environment variable through the shell. Make
sure to create a dedicated user directory and set its permissions to <code>700</code>. A
good default location is <code>/run/user/$(id -u)</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="graphical-session"><a class="header" href="#graphical-session">Graphical Session</a></h1>
<p>In order to configure a graphical session, you need:</p>
<ul>
<li><a href="config/graphical-session/./graphics-drivers/index.html">Graphics drivers</a></li>
<li>A basis for your graphical session: <a href="config/graphical-session/./xorg.html">Xorg</a> or
<a href="config/graphical-session/./wayland.html">Wayland</a></li>
</ul>
<p>You may also need:</p>
<ul>
<li><a href="config/graphical-session/../session-management.html">Session management tools</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="graphics-drivers"><a class="header" href="#graphics-drivers">Graphics Drivers</a></h1>
<p>This section covers basic graphics setup depending on the hardware configuration
of your system.</p>
<h2 id="section-contents-3"><a class="header" href="#section-contents-3">Section Contents</a></h2>
<ul>
<li><a href="config/graphical-session/graphics-drivers/./amd.html">AMD or ATI</a></li>
<li><a href="config/graphical-session/graphics-drivers/./intel.html">Intel</a></li>
<li><a href="config/graphical-session/graphics-drivers/./nvidia.html">NVIDIA</a></li>
<li><a href="config/graphical-session/graphics-drivers/./optimus.html">NVIDIA Optimus</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="amd-or-ati"><a class="header" href="#amd-or-ati">AMD or ATI</a></h1>
<p>AMD GPU support requires the <code>linux-firmware-amd</code> package. If you have installed
the <code>linux</code> or <code>linux-lts</code> packages, it will be installed as a dependency. If
you installed a version-specific kernel package (e.g., <code>linux5.4</code>), it may be
necessary to manually install <code>linux-firmware-amd</code>.</p>
<h2 id="opengl"><a class="header" href="#opengl">OpenGL</a></h2>
<p>Install the Mesa DRI package, <code>mesa-dri</code>. This is already included in the <code>xorg</code>
meta-package, but it is needed when installing Xorg via <code>xorg-minimal</code> or for
running a Wayland compositor.</p>
<h2 id="vulkan"><a class="header" href="#vulkan">Vulkan</a></h2>
<p>Install <code>vulkan-loader</code>, the Khronos Vulkan Loader. Then install one or both of
the Mesa AMD Vulkan driver, <code>mesa-vulkan-radeon</code>; or the GPUOpen AMD Vulkan
driver, <code>amdvlk</code>.</p>
<h2 id="xorg"><a class="header" href="#xorg">Xorg</a></h2>
<p>Installing the <code>xorg</code> meta-package will pull in both <code>xf86-video-amdgpu</code> and,
for older hardware, <code>xf86-video-ati</code>. If you install <code>xorg-minimal</code>, choose one
of these Xorg driver packages to match your hardware. The <code>amdgpu</code> driver should
support cards built on AMD's &quot;Graphics Core Next 1.2&quot; architecture, introduced
circa 2012.</p>
<h2 id="video-acceleration"><a class="header" href="#video-acceleration">Video acceleration</a></h2>
<p>Install the <code>mesa-vaapi</code> and <code>mesa-vdpau</code> packages.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="intel-1"><a class="header" href="#intel-1">Intel</a></h1>
<p>Intel GPU support requires the <code>linux-firmware-intel</code> package. If you have
installed the <code>linux</code> or <code>linux-lts</code> packages, it will be installed as a
dependency. If you installed a version-specific kernel package (e.g.,
<code>linux5.4</code>), it may be necessary to manually install <code>linux-firmware-intel</code>.</p>
<h2 id="opengl-1"><a class="header" href="#opengl-1">OpenGL</a></h2>
<p>OpenGL requires the Mesa DRI package, <code>mesa-dri</code>. This is provided by the <code>xorg</code>
meta-package, but will need to be installed manually when using the
<code>xorg-minimal</code> package or running a Wayland compositor.</p>
<h2 id="vulkan-1"><a class="header" href="#vulkan-1">Vulkan</a></h2>
<p>Install the Khronos Vulkan Loader and the Mesa Intel Vulkan driver packages,
respectively <code>vulkan-loader</code> and <code>mesa-vulkan-intel</code>.</p>
<h2 id="video-acceleration-1"><a class="header" href="#video-acceleration-1">Video acceleration</a></h2>
<p>Install the <code>intel-video-accel</code> meta-package:</p>
<p>This will install all the Intel VA-API drivers. <code>intel-media-driver</code> will be
used by default, but this choice can be overridden at runtime via the
environment variable <code>LIBVA_DRIVER_NAME</code>:</p>
<div class="table-wrapper"><table><thead><tr><th>Driver Package</th><th>Supported GPU Gen</th><th>Explicit selection</th></tr></thead><tbody>
<tr><td><code>libva-intel-driver</code></td><td>up to Coffee Lake</td><td><code>LIBVA_DRIVER_NAME=i965</code></td></tr>
<tr><td><code>intel-media-driver</code></td><td>from Broadwell</td><td><code>LIBVA_DRIVER_NAME=iHD</code></td></tr>
</tbody></table>
</div>
<h2 id="troubleshooting-1"><a class="header" href="#troubleshooting-1">Troubleshooting</a></h2>
<p>The kernels packaged by EvolutionOS are configured with
<code>CONFIG_INTEL_IOMMU_DEFAULT_ON=y</code>, which can lead to issues with their graphics
drivers, as reported by the <a href="https://www.kernel.org/doc/html/latest/x86/iommu.html#graphics-problems">kernel
documentation</a>.
To fix this, it is necessary to disable IOMMU for the integrated GPU. This can
be done by adding <code>intel_iommu=igfx_off</code> to your <a href="config/graphical-session/graphics-drivers/../../kernel.html#cmdline">kernel
cmdline</a>. This problem is expected to happen on the
Broadwell generation of internal GPUs. If you have another internal GPU and your
issues are fixed by this kernel option, you should file a bug reporting the
problem to kernel developers.</p>
<p>For newer Intel chipsets, the <a href="config/graphical-session/graphics-drivers/../xorg.html#ddx">DDX</a> drivers may interfere with
correct operation. This is characterized by graphical acceleration not working
and general graphical instability. If this is the case, try removing all
<code>xf86-video-*</code> packages.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="nvidia"><a class="header" href="#nvidia">NVIDIA</a></h1>
<h2 id="nouveau-open-source-driver"><a class="header" href="#nouveau-open-source-driver">nouveau (Open Source Driver)</a></h2>
<p>This is a reverse engineered driver largely developed by the community, with
some documentation provided by Nvidia. It tends to perform well on older
hardware, and is required to use a large portion of the available Wayland
compositors.</p>
<p>At the time of writing, graphics cards starting with second generation Maxwell
(GTX 9xx) are unable to perform at their full potential with <code>nouveau</code>. This is
because the <code>linux-firmware</code> collection is missing signed firmware blobs needed
to reclock these cards past their boot frequencies.</p>
<p>To use <code>nouveau</code> with Wayland, you only need the <code>mesa-dri</code> package, which
provides the accelerated OpenGL driver. On X11, you also need an appropriate
Xorg driver. You can either install <code>xf86-video-nouveau</code> or use the universal
<code>modesetting</code> driver bundled with Xorg (this is the only option on Tegra based
ARM boards). The former can make use of GPU-specific 2D acceleration paths,
which is primarily useful on older cards with specialized fixed function
hardware (the <code>modesetting</code> driver will accelerate 2D using OpenGL via GLAMOR).
When in doubt, it's a good idea to try <code>xf86-video-nouveau</code> first.</p>
<p>Note: <code>xf86-video-nouveau</code> is usually installed by default if you use the <code>xorg</code>
metapackage. If you use <code>xorg-minimal</code>, you will need to install it manually,
either directly or through <code>xorg-video-drivers</code>.</p>
<h2 id="nvidia-proprietary-driver"><a class="header" href="#nvidia-proprietary-driver">nvidia (Proprietary Driver)</a></h2>
<p>The proprietary drivers are available in the <a href="config/graphical-session/graphics-drivers/../../../xbps/repositories/index.html#nonfree">nonfree
repository</a>.</p>
<p>Check if your graphics card belongs to the <a href="https://www.nvidia.com/en-us/drivers/unix/legacy-gpu/">legacy
branch</a>. If it does not,
install the <code>nvidia</code> package. Otherwise you should install the appropriate
legacy driver, <code>nvidia470</code> or <code>nvidia390</code>. The older legacy driver, <code>nvidia340</code>,
is no longer available, and users are encouraged to <a href="config/graphical-session/graphics-drivers/nvidia.html#reverting-from-nvidia-to-nouveau">switch to
nouveau</a>.</p>
<div class="table-wrapper"><table><thead><tr><th>Brand</th><th>Type</th><th>Model</th><th>Driver Package</th></tr></thead><tbody>
<tr><td>NVIDIA</td><td>Proprietary</td><td>800+</td><td><code>nvidia</code></td></tr>
<tr><td>NVIDIA</td><td>Proprietary</td><td>600/700</td><td><code>nvidia470</code></td></tr>
<tr><td>NVIDIA</td><td>Proprietary</td><td>400/500 Series</td><td><code>nvidia390</code></td></tr>
</tbody></table>
</div>
<p>The proprietary driver integrates in the kernel through
<a href="config/graphical-session/graphics-drivers/../../kernel.html#dynamic-kernel-module-support-dkms">DKMS</a>.</p>
<p>This driver offers better performance and power handling, and is recommended
where performance is needed.</p>
<h2 id="32-bit-program-support-glibc-only"><a class="header" href="#32-bit-program-support-glibc-only">32-bit program support (glibc only)</a></h2>
<p>In order to run 32-bit programs with driver support, you need to install
additional packages.</p>
<p>If using the <code>nouveau</code> driver, install the <code>mesa-dri-32bit</code> package.</p>
<p>If using the <code>nvidia</code> driver, install the <code>nvidia&lt;x&gt;-libs-32bit</code> package. <code>&lt;x&gt;</code>
represents the legacy driver version (<code>470</code> or <code>390</code>) or can be left empty for
the main driver.</p>
<h2 id="reverting-from-nvidia-to-nouveau"><a class="header" href="#reverting-from-nvidia-to-nouveau">Reverting from nvidia to nouveau</a></h2>
<h3 id="uninstalling-nvidia"><a class="header" href="#uninstalling-nvidia">Uninstalling nvidia</a></h3>
<p>In order to revert to the <code>nouveau</code> driver, install the <a href="config/graphical-session/graphics-drivers/nvidia.html#nouveau-open-source-driver"><code>nouveau</code>
driver</a> (if it was not installed already), then
remove the <code>nvidia</code>, <code>nvidia470</code>, or <code>nvidia390</code> package, as appropriate.</p>
<p>If you were using the obsolete <code>nvidia340</code> driver, you might need to install the
<code>libglvnd</code> package after removing the <code>nvidia340</code> package.</p>
<h3 id="keeping-both-drivers"><a class="header" href="#keeping-both-drivers">Keeping both drivers</a></h3>
<p>It is possible to use the <code>nouveau</code> driver while still having the <code>nvidia</code>
driver installed. To do so, remove the blacklisting of <code>nouveau</code> in
<code>/etc/modprobe.d/nouveau_blacklist.conf</code>, <code>/usr/lib/modprobe.d/nvidia.conf</code>, or
<code>/usr/lib/modprobe.d/nvidia-dkms.conf</code> by commenting it out:</p>
<pre><code>#blacklist nouveau
</code></pre>
<p>For Xorg, specify that it should load the <code>nouveau</code> driver rather than the
<code>nvidia</code> driver by creating the file <code>/etc/X11/xorg.conf.d/20-nouveau.conf</code> with
the following content:</p>
<pre><code>Section &quot;Device&quot;
    Identifier &quot;Nvidia card&quot;
    Driver &quot;nouveau&quot;
EndSection
</code></pre>
<p>You may need to reboot your system for these changes to take effect.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="nvidia-optimus"><a class="header" href="#nvidia-optimus">NVIDIA Optimus</a></h1>
<p>NVIDIA Optimus refers to a dual graphics configuration found on laptops
consisting of an Intel integrated GPU and a discrete NVIDIA GPU.</p>
<p>There are different methods to take advantage of the NVIDIA GPU, which depend on
the driver version supported by your hardware.</p>
<p>In order to determine the correct driver to install, it is not enough to look at
the &quot;Supported Products&quot; list on NVIDIA's website, because they are not
guaranteed to work in an Optimus configuration. So the only way is to try
installing the latest <code>nvidia</code>, rebooting, and looking at the kernel log. If
your device is not supported, you will see a message like this:</p>
<pre><code>NVRM: The NVIDIA GPU xxxx:xx:xx.x (PCI ID: xxxx:xxxx)
NVRM: installed in this system is not supported by the xxx.xx
NVRM: NVIDIA Linux driver release.  Please see 'Appendix
NVRM: A - Supported NVIDIA GPU Products' in this release's
NVRM: README, available on the Linux driver download page
NVRM: at www.nvidia.com.
</code></pre>
<p>which means you have to uninstall <code>nvidia</code> and install the legacy <code>nvidia390</code>.</p>
<p>A summary of the methods supported by EvolutionOS, which are mutually exclusive:</p>
<p><a href="config/graphical-session/graphics-drivers/optimus.html#prime-render-offload">PRIME Render Offload</a></p>
<ul>
<li>available on <code>nvidia</code> and <code>nvidia470</code></li>
<li>allows to switch to the NVIDIA GPU on a per-application basis</li>
<li>more flexible but power saving capabilities depend on the hardware (pre-Turing
devices are not shut down completely)</li>
</ul>
<p>Offloading Graphics Display with RandR 1.4</p>
<ul>
<li>available on <code>nvidia</code>, <code>nvidia470</code>, and <code>nvidia390</code></li>
<li>allows to choose which GPU to use at the start of the X session</li>
<li>less flexible, but allows the user to completely shut down the NVIDIA GPU when
not in use, thus saving power</li>
</ul>
<p><a href="config/graphical-session/graphics-drivers/optimus.html#bumblebee">Bumblebee</a></p>
<ul>
<li>available on <code>nvidia</code>, <code>nvidia470</code>, and <code>nvidia390</code></li>
<li>allows to switch to the NVIDIA GPU on a per-application basis</li>
<li>unofficial method, offers poor performance</li>
</ul>
<p><a href="config/graphical-session/graphics-drivers/optimus.html#nouveau-prime">Nouveau PRIME</a></p>
<ul>
<li>uses the open source driver <code>nouveau</code></li>
<li>allows to switch to the NVIDIA GPU on a per-application basis</li>
<li><code>nouveau</code> is a reverse-engineered driver and offers poor performance</li>
</ul>
<p>You can check the currently used GPU by searching for <code>renderer string</code> in the
output of the <code>glxinfo</code> command. It is necessary to install the <code>glxinfo</code>
package for this. For the first two alternatives below, it is also possible to
verify that a process is using the NVIDIA GPU by checking the output of
<code>nvidia-smi</code>.</p>
<h2 id="prime-render-offload"><a class="header" href="#prime-render-offload">PRIME Render Offload</a></h2>
<p>In this method, GPU switching is done by setting environment variables when
executing the application to be rendered on the NVIDIA GPU. The wrapper script
<code>prime-run</code> is available from the <code>nvidia</code> package, and can be used as shown
below:</p>
<pre><code>$ prime-run &lt;application&gt;
</code></pre>
<p>For more information, see NVIDIA's
<a href="https://download.nvidia.com/XFree86/Linux-x86_64/440.44/README/primerenderoffload.html">README</a></p>
<h2 id="bumblebee"><a class="header" href="#bumblebee">Bumblebee</a></h2>
<p>Enable the <code>bumblebeed</code> service and add the user to the <code>bumblebee</code> group. This
requires a re-login to take effect.</p>
<p>Run the application to be rendered on the NVIDIA GPU with <code>optirun</code>:</p>
<pre><code>$ optirun &lt;application&gt;
</code></pre>
<h2 id="nouveau-prime"><a class="header" href="#nouveau-prime">Nouveau PRIME</a></h2>
<p>This method uses the open source <code>nouveau</code> driver. If the NVIDIA drivers are
installed, it is necessary to <a href="config/graphical-session/graphics-drivers/./nvidia.html#reverting-from-nvidia-to-nouveau">configure the system to use
<code>nouveau</code></a>.</p>
<p>Set <code>DRI_PRIME=1</code> to run an application on the NVIDIA GPU:</p>
<pre><code>$ DRI_PRIME=1 &lt;application&gt;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="xorg-1"><a class="header" href="#xorg-1">Xorg</a></h1>
<p>This section details the manual installation and configuration of the Xorg
display server and common related services and utilities. If you would just like
to install a full desktop environment, it is recommended to try the <a href="config/graphical-session/../../installation/live-images/index.html#xfce-image">xfce
image</a>.</p>
<h2 id="installation-4"><a class="header" href="#installation-4">Installation</a></h2>
<p>EvolutionOS provides a comprehensive <code>xorg</code> package which installs the server and all
of the free video drivers, input drivers, fonts, and base applications. This
package is a safe option, and should be adequate for most systems which don't
require proprietary video drivers.</p>
<p>If you would like to select only the packages you need, the <code>xorg-minimal</code>
package contains the base xorg server <em>only</em>. If you install only
<code>xorg-minimal</code>, you will likely need to install a font package (like
<code>xorg-fonts</code>), a terminal emulator (like <code>xterm</code>), and a window manager to have
a usable graphics system.</p>
<h2 id="video-drivers"><a class="header" href="#video-drivers">Video Drivers</a></h2>
<p>EvolutionOS provides both open-source and proprietary (non-free) video drivers.</p>
<h3 id="open-source-drivers"><a class="header" href="#open-source-drivers">Open Source Drivers</a></h3>
<p>Xorg can use two categories of open source drivers: DDX or modesetting.</p>
<h4 id="ddx"><a class="header" href="#ddx">DDX</a></h4>
<p>The DDX drivers are installed with the <code>xorg</code> package by default, or may be
installed individually if the <code>xorg-minimal</code> package was installed. They are
provided by the <code>xf86-video-*</code> packages.</p>
<p>For advanced configuration, see the man page corresponding to the vendor name,
like <a href="https://man.voidlinux.org/intel.4">intel(4)</a>.</p>
<h4 id="modesetting"><a class="header" href="#modesetting">Modesetting</a></h4>
<p>Modesetting requires the <code>mesa-dri</code> package, and no additional vendor-specific
driver package.</p>
<p>Xorg defaults to DDX drivers if they are present, so in this case modesetting
must be explicitly selected: see <a href="config/graphical-session/xorg.html#forcing-the-modesetting-driver">Forcing the modesetting
driver</a>.</p>
<p>For advanced configuration, see
<a href="https://man.voidlinux.org/modesetting.4">modesetting(4)</a>.</p>
<h3 id="proprietary-drivers"><a class="header" href="#proprietary-drivers">Proprietary Drivers</a></h3>
<p>EvolutionOS also provides <a href="config/graphical-session/./graphics-drivers/nvidia.html">proprietary NVIDIA drivers</a>,
which are available in the <a href="config/graphical-session/../../xbps/repositories/index.html#nonfree">nonfree
repository</a>.</p>
<h2 id="input-drivers"><a class="header" href="#input-drivers">Input Drivers</a></h2>
<p>A number of input drivers are available for Xorg. If <code>xorg-minimal</code> was
installed and a device is not responding, or behaving unexpectedly, a different
driver may correct the issue. These drivers can grab everything from power
buttons to mice and keyboards. They are provided by the <code>xf86-input-*</code> packages.</p>
<h2 id="xorg-configuration"><a class="header" href="#xorg-configuration">Xorg Configuration</a></h2>
<p>Although Xorg normally auto-detects drivers and configuration is not needed, a
config for a specific keyboard driver may look something like a file
<code>/etc/X11/xorg.conf.d/30-keyboard.conf</code> with the contents:</p>
<pre><code>Section &quot;InputClass&quot;
  Identifier &quot;keyboard-all&quot;
  Driver &quot;evdev&quot;
  MatchIsKeyboard &quot;on&quot;
EndSection
</code></pre>
<h3 id="forcing-the-modesetting-driver"><a class="header" href="#forcing-the-modesetting-driver">Forcing the modesetting driver</a></h3>
<p>Create the file <code>/etc/X11/xorg.conf.d/10-modesetting.conf</code>:</p>
<pre><code>Section &quot;Device&quot;
    Identifier &quot;GPU0&quot;
    Driver &quot;modesetting&quot;
EndSection
</code></pre>
<p>and restart Xorg. Verify that the configuration has been picked up with:</p>
<pre><code>$ grep -m1 '(II) modeset([0-9]+):' /var/log/Xorg.0.log
</code></pre>
<p>If there is a match, modesetting is being used.</p>
<h2 id="starting-x-sessions"><a class="header" href="#starting-x-sessions">Starting X Sessions</a></h2>
<h3 id="startx"><a class="header" href="#startx">startx</a></h3>
<p>The <code>xinit</code> package provides the <a href="https://man.voidlinux.org/startx.1">startx(1)</a>
script as a frontend to <a href="https://man.voidlinux.org/xinit.1">xinit(1)</a>, which can
be used to start X sessions from the console. For example, to start
<a href="https://man.voidlinux.org/i3.1">i3(1)</a>, edit <code>~/.xinitrc</code> to contain <code>exec /bin/i3</code> on the last line.</p>
<p>To start arbitrary programs together with an X session, add them in <code>~/.xinitrc</code>
before the last line. For example, to start
<a href="https://man.voidlinux.org/pipewire.1">pipewire(1)</a> before starting i3, add
<code>pipewire &amp;</code> before the last line.</p>
<p>A <code>~/.xinitrc</code> file which starts <code>pipewire</code> and <code>i3</code> is shown below:</p>
<pre><code>pipewire &amp;
exec /bin/i3
</code></pre>
<p>Then call <code>startx</code> to start a session.</p>
<p>If a D-Bus session bus is required, you can <a href="config/graphical-session/../session-management.html#d-bus">manually start
one</a>.</p>
<h3 id="display-managers"><a class="header" href="#display-managers">Display Managers</a></h3>
<p>Display managers (DMs) provide a graphical login UI. A number of DMs are
available in the EvolutionOS repositories, including <code>greetd / gtkgreet</code> (the recommended DM),<code>gdm</code> (the GNOME DM), <code>sddm</code> (the
KDE DM) and <code>lightdm</code>. When setting up a display manager, be sure to <a href="config/graphical-session/../services/index.html#testing-services">test the
service</a> before enabling it.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="wayland"><a class="header" href="#wayland">Wayland</a></h1>
<p>This section details the manual installation and configuration of Wayland
compositors and related services and utilities.</p>
<h2 id="installation-5"><a class="header" href="#installation-5">Installation</a></h2>
<p>Unlike <a href="config/graphical-session/./xorg.html">Xorg</a>, Wayland implementations combine the display server,
the window manager and the compositor in a single application.</p>
<h3 id="desktop-environments"><a class="header" href="#desktop-environments">Desktop Environments</a></h3>
<p>GNOME, KDE Plasma and Enlightenment have Wayland sessions. GNOME uses its
Wayland session by default. When using these desktop environments, applications
built with GTK+ will automatically choose the Wayland backend, while Qt5 and EFL
applications might require <a href="config/graphical-session/wayland.html#native-applications">setting some environment
variables</a> if used outside KDE or Enlightenment,
respectively.</p>
<h3 id="standalone-compositors"><a class="header" href="#standalone-compositors">Standalone compositors</a></h3>
<p>EvolutionOS currently packages the following Wayland compositors:</p>
<ul>
<li>Weston: reference compositor for Wayland</li>
<li>Sway: an i3-compatible Wayland compositor</li>
<li>Wayfire: 3D Wayland compositor</li>
<li>Hikari: a stacking compositor with some tiling features</li>
<li>Cage: a Wayland kiosk</li>
<li>River: a dynamic tiling Wayland compositor</li>
<li>labwc: a window-stacking compositor, inspired by Openbox</li>
</ul>
<p>Note that evolution-desktop exists, which uses Wayfire and bundles gtkgreet and polkit for
ease of access.</p>
<h3 id="video-drivers-1"><a class="header" href="#video-drivers-1">Video drivers</a></h3>
<p>Both GNOME and KDE Plasma have EGLStreams backends for Wayland, which means they
can use the proprietary NVIDIA drivers. Most other Wayland compositors require
drivers that implement the GBM interface. The main driver for this purpose is
provided by the <code>mesa-dri</code> package. The &quot;<a href="config/graphical-session/./graphics-drivers/index.html">Graphics
Drivers</a>&quot; section has more details regarding
setting up graphics in different systems.</p>
<h3 id="seat-management"><a class="header" href="#seat-management">Seat management</a></h3>
<p>Wayland compositors require some way of controlling the video display and
accessing input devices. In EvolutionOS systems, this requires a seat manager service,
which can be either elogind or seatd. Enabling them is explained in the
<a href="config/graphical-session/../session-management.html">&quot;Session and Seat Management&quot;</a> session.</p>
<h3 id="native-applications"><a class="header" href="#native-applications">Native applications</a></h3>
<p><a href="https://wayland.freedesktop.org/qt5.html">Qt5</a>-based applications require
installing the <code>qt5-wayland</code> package and setting the environment variable
<code>QT_QPA_PLATFORM=wayland-egl</code> to enable their Wayland backend. Some KDE specific
applications also require installing the <code>kwayland</code> package.
<a href="https://wayland.freedesktop.org/efl.html">EFL</a>-based applications require
setting the environment variable <code>ELM_DISPLAY=wl</code>, and can have issues without
it, due to not supporting XWayland properly. <a href="https://libsdl.org">SDL</a>-based
applications require setting the environment variable <code>SDL_VIDEODRIVER=wayland</code>.
<a href="https://wiki.gnome.org/Initiatives/Wayland/GTK%2B">GTK+</a>-based applications
should use the Wayland backend automatically. Information about other toolkits
can be found in the <a href="https://wayland.freedesktop.org/toolkits.html">Wayland
documentation</a>.</p>
<p>Media applications, such as <a href="https://man.voidlinux.org/mpv.1">mpv(1)</a>,
<a href="https://man.voidlinux.org/vlc.1">vlc(1)</a> and <code>imv</code> work natively on Wayland.</p>
<h4 id="web-browsers"><a class="header" href="#web-browsers">Web browsers</a></h4>
<p>Mozilla Firefox ships with a Wayland backend which is disabled by default. To
enable the Wayland backend, either set the environment variable
<code>MOZ_ENABLE_WAYLAND=1</code> before running <code>firefox</code> or use the provided
<code>firefox-wayland</code> script.</p>
<p>Browsers based on GTK+ or Qt5, such as Midori and
<a href="https://man.voidlinux.org/qutebrowser.1">qutebrowser(1)</a>, should work on
Wayland natively.</p>
<h4 id="running-x-applications-inside-wayland"><a class="header" href="#running-x-applications-inside-wayland">Running X applications inside Wayland</a></h4>
<p>If an application doesn't support Wayland, it can still be used in a Wayland
context. XWayland is an X server that bridges this gap for most Wayland
compositors, and is installed as a dependency for most of them. Its package is
<code>xorg-server-xwayland</code>. For Weston, the correct package is <code>weston-xwayland</code>.</p>
<h2 id="configuration-3"><a class="header" href="#configuration-3">Configuration</a></h2>
<p>The Wayland library requires the
<a href="config/graphical-session/../session-management.html#xdg_runtime_dir"><code>XDG_RUNTIME_DIR</code></a> environment
variable to determine the directory for the Wayland socket.</p>
<p>It is also possible that some applications use the <code>XDG_SESSION_TYPE</code>
environment variable in some way, which requires that you set it to <code>wayland</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="fonts"><a class="header" href="#fonts">Fonts</a></h1>
<p>To customize font display in your graphical session, you can use configurations
provided in <code>/usr/share/fontconfig/conf.avail/</code>. To do so, create a symlink to
the relevant <code>.conf</code> file in <code>/etc/fonts/conf.d/</code>, then use
<a href="https://man.voidlinux.org/xbps-reconfigure.1">xbps-reconfigure(1)</a> to
reconfigure the <code>fontconfig</code> package.</p>
<p>For example, to disable use of bitmap fonts:</p>
<pre><code># ln -s /usr/share/fontconfig/conf.avail/70-no-bitmaps.conf /etc/fonts/conf.d/
# xbps-reconfigure -f fontconfig
</code></pre>
<p>Use <a href="https://man.voidlinux.org/fc-conflist.1">fc-conflist(1)</a> to list which
configurations are in effect.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="icons"><a class="header" href="#icons">Icons</a></h1>
<h2 id="gtk"><a class="header" href="#gtk">GTK</a></h2>
<p>By default, GTK-based applications try to use the Adwaita icon theme for
application icons. Consequently, installation of the <code>gtk+3</code> package will also
install the <code>adwaita-icon-theme</code> package. If you wish to use a different theme,
install the relevant package, then specify the theme in
<code>/etc/gtk-3.0/settings.ini</code> or <code>~/.config/gtk-3.0/settings.ini</code>.
<code>adwaita-icon-theme</code> can be removed after
<a href="config/graphical-session/../../xbps/advanced-usage.html#ignoring-packages">ignoring</a> the package.</p>
<p>For information about how to specify a different GTK icon theme in
<code>settings.ini</code>, refer to <a href="https://developer.gnome.org/gtk3/stable/GtkSettings.html#GtkSettings.properties">the GtkSettings
documentation</a>,
in particular the
&quot;<a href="https://developer.gnome.org/gtk3/stable/GtkSettings.html#GtkSettings--gtk-icon-theme-name">gtk-icon-theme-name</a>&quot;
property.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="gnome"><a class="header" href="#gnome">GNOME</a></h1>
<h2 id="pre-installation"><a class="header" href="#pre-installation">Pre-installation</a></h2>
<p>GNOME supports both X and Wayland sessions. Follow the &quot;<a href="config/graphical-session/./wayland.html">Wayland</a>&quot;
or &quot;<a href="config/graphical-session/./xorg.html">Xorg</a>&quot; sections to setup your preferred environment.</p>
<p>Install the <code>dbus</code> package, ensure the <code>dbus</code> service is enabled, and reboot for
the changes to take effect.</p>
<h2 id="installation-6"><a class="header" href="#installation-6">Installation</a></h2>
<p>Install the <code>gnome</code> package for a GNOME environment which includes the base
GNOME desktop and a subset of GNOME applications. Additional applications are
available via the <code>gnome-apps</code> package.</p>
<p>A minimal GNOME environment can be created by installing the <code>gnome-core</code>
package. Note, however, that not all GNOME features may be present or
functional.</p>
<p>If you require <a href="http://www.zeroconf.org/">ZeroConf</a> support, install the <code>avahi</code>
package and enable the <code>avahi-daemon</code> service.</p>
<h2 id="starting-gnome"><a class="header" href="#starting-gnome">Starting GNOME</a></h2>
<p>The <code>gdm</code> package provides the <code>gdm</code> service for the GNOME Display Manager;
<a href="config/graphical-session/../services/index.html#testing-services">test the service</a> before enabling it.
GDM defaults to providing a Wayland session via the <code>mutter</code> window manager, but
an X session can be chosen instead.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="kde"><a class="header" href="#kde">KDE</a></h1>
<h2 id="installation-7"><a class="header" href="#installation-7">Installation</a></h2>
<p>Install the <code>kde5</code> package, and optionally, the <code>kde5-baseapps</code> package.</p>
<p>To use the &quot;Networks&quot; widget, enable the <code>dbus</code> and <code>NetworkManager</code> services.</p>
<p>Installing the <code>kde5</code> package also installs the <code>sddm</code> package, which provides
the <code>sddm</code> service for the Simple Desktop Display Manager. This service depends
on the <code>dbus</code> service being enabled; <a href="config/graphical-session/../services/index.html#testing-services">test the
service</a> before enabling it. If you are
not intending to run SDDM via a remote X server, you will need to install either
the <code>xorg-minimal</code> package or the <code>xorg</code> package. By default, SDDM will start an
X-based Plasma session, but you can request a Wayland-based Plasma session
instead.</p>
<p>If you wish to start an X-based session from the console, use
<a href="config/graphical-session/./xorg.html#startx">startx</a> to run <code>startplasma-x11</code>. For a Wayland-based
session, run <code>startplasma-wayland</code> directly.</p>
<h2 id="dolphin"><a class="header" href="#dolphin">Dolphin</a></h2>
<p>Dolphin is the default file manager of the KDE desktop environment. It can be
installed on its own by installing the <code>dolphin</code> package, or it can be installed
as part of the <code>kde5-baseapps</code> meta-package.</p>
<h3 id="thumbnail-previews"><a class="header" href="#thumbnail-previews">Thumbnail Previews</a></h3>
<p>To enable thumbnail file previews, install the <code>kdegraphics-thumbnailers</code>
package. If you want video thumbnails, the <code>ffmpegthumbs</code> package is also
necessary. Enable previews in &quot;Control&quot; -&gt; &quot;Configure Dolphin&quot; -&gt; &quot;General&quot; -&gt;
&quot;Previews&quot; by checking the corresponding boxes. File previews will be shown for
the selected file types after clicking &quot;Preview&quot; in Dolphin's toolbar.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="multimedia"><a class="header" href="#multimedia">Multimedia</a></h1>
<h2 id="audio-setup"><a class="header" href="#audio-setup">Audio setup</a></h2>
<p>To setup audio on your EvolutionOS system you have to decide if you want to use
<a href="config/media/./pulseaudio.html">PulseAudio</a>, <a href="config/media/./pipewire.html">PipeWire</a> or just
<a href="config/media/./alsa.html">ALSA</a>.</p>
<p>Some applications require PulseAudio, especially closed source programs, but
<a href="config/media/./pipewire.html">PipeWire</a> provides a drop-in replacement for PulseAudio.</p>
<p>If <a href="config/media/../session-management.html">elogind</a> is not enabled, it is necessary to be in
the <code>audio</code> group in order to have access to audio devices.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="alsa"><a class="header" href="#alsa">ALSA</a></h1>
<p>To use ALSA, install the <code>alsa-utils</code> package and make sure your user is a
member of the <code>audio</code> group.</p>
<p>The <code>alsa-utils</code> package provides the <code>alsa</code> service. When enabled, this service
saves and restores the state of ALSA (e.g. volume) at shutdown and boot,
respectively.</p>
<p>To allow use of software requiring PulseAudio, install the <code>apulse</code> package.
<code>apulse</code> provides part of the PulseAudio interface expected by applications,
translating calls to that interface into calls to ALSA. For details about using
<code>apulse</code>, consult <a href="https://github.com/i-rinat/apulse/blob/master/README.md">the project
README</a>.</p>
<h2 id="configuration-4"><a class="header" href="#configuration-4">Configuration</a></h2>
<p>The default sound card can be specified via ALSA configuration files or via
kernel module options.</p>
<p>To obtain information about the order of loaded sound card modules:</p>
<pre><code>$ cat /proc/asound/modules
 0 snd_hda_intel
 1 snd_hda_intel
 2 snd_usb_audio
</code></pre>
<p>To set a different card as the default, edit <code>/etc/asound.conf</code> or the per-user
configuration file <code>~/.asoundrc</code>:</p>
<pre><code>defaults.ctl.card 2;
defaults.pcm.card 2;
</code></pre>
<p>or specify sound card module order in <code>/etc/modprobe.d/alsa.conf</code>:</p>
<pre><code>options snd_usb_audio index=0
</code></pre>
<h2 id="dmix"><a class="header" href="#dmix">Dmix</a></h2>
<p>The <code>dmix</code> ALSA plugin allows playing sound from multiple sources. <code>dmix</code> is
enabled by default for soundcards which do not support hardware mixing. To
enable it for digital output, edit <code>/etc/asound.conf</code>:</p>
<pre><code>pcm.dsp {
    type plug
    slave.pcm &quot;dmix&quot;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pipewire"><a class="header" href="#pipewire">PipeWire</a></h1>
<p>To use PipeWire, install the <code>pipewire</code> package.</p>
<p><a href="https://man.voidlinux.org/pipewire.1">pipewire(1)</a> should be started as a user.
Run the pipewire command in a terminal emulator in your session.</p>
<pre><code>$ pipewire
</code></pre>
<p>When pipewire works as expected, use the autostarting mechanism of your desktop
environment or <a href="config/media/../graphical-session/xorg.html#startx">startx</a>. The <code>pipewire</code>
package ships <a href="https://specifications.freedesktop.org/desktop-entry-spec/latest/">Desktop
Entry</a> files
for <code>pipewire</code> and <code>pipewire-pulse</code> in <code>/usr/share/applications</code>. If your
environment supports the <a href="https://specifications.freedesktop.org/autostart-spec/autostart-spec-latest.html">Desktop Application Autostart
Specification</a>,
you can enable pipewire by symlinking the desktop files to the autostart
directory:</p>
<pre><code># ln -s /usr/share/applications/pipewire.desktop /etc/xdg/autostart/pipewire.desktop
</code></pre>
<h2 id="session-management"><a class="header" href="#session-management">Session Management</a></h2>
<p>In PipeWire, a session manager assumes responsibility for interconnecting media
sources and sinks as well as enforcing routing policy. Without a session
manager, PipeWire will not function. The reference
<a href="https://gitlab.freedesktop.org/pipewire/media-session"><code>pipewire-media-session</code></a>
was originally provided in the EvolutionOS <code>pipewire</code> package and configured to run by
default to satisfy this requirement. However, <code>pipewire-media-session</code> is
deprecated and the authors recommend using
<a href="https://pipewire.pages.freedesktop.org/wireplumber/">WirePlumber</a> in its place.
Install the <code>wireplumber</code> package to use this session manager with PipeWire.</p>
<blockquote>
<p>If you have installed an earlier version of the EvolutionOS <code>pipewire</code> package, make
sure to update your system to eliminate any stale system configuration that
may attempt to launch <code>pipewire-media-session</code>. Users who previously overrode
the system configuration to use <code>wireplumber</code>, <em>e.g.</em> by placing a custom
<code>pipewire.conf</code> file in <code>/etc/pipewire</code> or <code>${XDG_CONFIG_HOME}/pipewire</code>, may
wish to reconcile these overrides with <code>/usr/share/pipewire/pipewire.conf</code>
installed by the most recent <code>pipewire</code> package. If the sole purpose of a
prior override was to disable <code>pipewire-media-session</code>, deleting the custom
configuration may be sufficient.</p>
</blockquote>
<p>There are several methods for starting <code>wireplumber</code> alongside <code>pipewire</code>. If
your window manager or desktop environment auto-start mechanism is used to start
<code>pipewire</code>, it is recommended to use the same mechanism for starting
<code>wireplumber</code>. The <code>wireplumber</code> package includes a <code>wireplumber.desktop</code>
Desktop Entry file that may be useful in this situation.</p>
<blockquote>
<p>Be aware that <code>wireplumber</code> must launch <em>after</em> the <code>pipewire</code> executable. The
Desktop Application Autostart Specification makes no provision for ordering of
services started via Desktop Entry files. When relying on these files to
launch <code>pipewire</code> and <code>wireplumber</code>, consult the documentation for your window
manager or desktop environment to determine whether proper ordering of
services can be achieved.</p>
</blockquote>
<p>If proper ordering of separate <code>pipewire</code> and <code>wireplumber</code> services is
infeasible, it is possible to configure <code>pipewire</code> to launch the session manager
directly. This can be accomplished by running</p>
<pre><code># mkdir -p /etc/pipewire/pipewire.conf.d
# ln -s /usr/share/examples/wireplumber/10-wireplumber.conf /etc/pipewire/pipewire.conf.d/
</code></pre>
<p>for system configurations or, for per-user configurations, running</p>
<pre><code>$ true &quot;${XDG_CONFIG_HOME:=${HOME}/.config}&quot;
$ mkdir -p &quot;${XDG_CONFIG_HOME}/pipewire/pipewire.conf.d&quot;
# ln -s /usr/share/examples/wireplumber/10-wireplumber.conf &quot;${XDG_CONFIG_HOME}/pipewire/pipewire.conf.d/&quot;
</code></pre>
<p>With either of these configurations, launching <code>pipewire</code> should be sufficient
to establish a working PipeWire session that uses <code>wireplumber</code> for session
management.</p>
<p>In its default configuration, WirePlumber requires an active <a href="config/media/../session-management.html#d-bus">D-Bus
session</a>. If your desktop environment or window
manager is configured to provide a D-Bus session as well as launch <code>pipewire</code>
and <code>wireplumber</code>, no further configuration should be required. Users wishing to
launch <code>pipewire</code> on its own, <em>e.g.</em>, in a <code>.xinitrc</code> script, may find it
necessary to configure <code>pipewire</code> to launch <code>wireplumber</code> directly and wrap the
<code>pipewire</code> invocation as</p>
<pre><code>dbus-run-session pipewire
</code></pre>
<h2 id="pulseaudio-replacement"><a class="header" href="#pulseaudio-replacement">PulseAudio replacement</a></h2>
<p>Before starting <code>pipewire-pulse</code>, make sure that the PulseAudio service is
<a href="config/media/../services/index.html#disabling-services">disabled</a> and that no other PulseAudio
server instance is running.</p>
<p>Start the PulseAudio server by running <code>pipewire-pulse</code> in a terminal emulator.</p>
<p>To check if the replacement is working correctly, use
<a href="https://man.voidlinux.org/pactl.1">pactl(1)</a> (provided by the
<code>pulseaudio-utils</code> package):</p>
<pre><code>$ pactl info

[...]
Server Name: PulseAudio (on PipeWire 0.3.18)
[...]
</code></pre>
<p>Once you confirmed that <code>pipewire-pulse</code> works as expected, it's recommended to
autostart it from the same place where you start PipeWire. Alternatively, the
<code>pipewire</code> configuration can be modified to launch <code>pipewire-pulse</code> directly:</p>
<pre><code># mkdir -p /etc/pipewire/pipewire.conf.d
# ln -s /usr/share/examples/pipewire/20-pipewire-pulse.conf /etc/pipewire/pipewire.conf.d/
</code></pre>
<p>for system configurations, or</p>
<pre><code>$ true &quot;${XDG_CONFIG_HOME:=${HOME}/.config}&quot;
$ mkdir -p &quot;${XDG_CONFIG_HOME}/pipewire/pipewire.conf.d&quot;
# ln -s /usr/share/examples/pipewire/20-pipewire-pulse.conf &quot;${XDG_CONFIG_HOME}/pipewire/pipewire.conf.d/&quot;
</code></pre>
<p>for per-user configurations.</p>
<h2 id="bluetooth-audio"><a class="header" href="#bluetooth-audio">Bluetooth audio</a></h2>
<p>For bluetooth audio to work, install the <code>libspa-bluetooth</code> package.</p>
<h2 id="alsa-integration"><a class="header" href="#alsa-integration">ALSA integration</a></h2>
<p>Install <code>alsa-pipewire</code>, then enable the PipeWire ALSA device and make it the
default:</p>
<pre><code># mkdir -p /etc/alsa/conf.d
# ln -s /usr/share/alsa/alsa.conf.d/50-pipewire.conf /etc/alsa/conf.d
# ln -s /usr/share/alsa/alsa.conf.d/99-pipewire-default.conf /etc/alsa/conf.d
</code></pre>
<h2 id="jack-replacement"><a class="header" href="#jack-replacement">JACK replacement</a></h2>
<p>Install <code>libjack-pipewire</code>.</p>
<p>Use <a href="https://man.voidlinux.org/pw-jack.1">pw-jack(1)</a> to launch JACK clients
manually:</p>
<pre><code>$ pw-jack &lt;application&gt;
</code></pre>
<p>Alternatively, override the library provided by <code>libjack</code> (see
<a href="https://man.voidlinux.org/ld.so.8">ld.so(8)</a>). The following approach will work
on glibc-based systems:</p>
<pre><code># echo &quot;/usr/lib/pipewire-0.3/jack&quot; &gt; /etc/ld.so.conf.d/pipewire-jack.conf
# ldconfig
</code></pre>
<h2 id="troubleshooting-2"><a class="header" href="#troubleshooting-2">Troubleshooting</a></h2>
<p>The PulseAudio replacement requires the
<a href="config/media/../session-management.html#xdg_runtime_dir"><code>XDG_RUNTIME_DIR</code></a> environment
variable to work correctly.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pulseaudio"><a class="header" href="#pulseaudio">PulseAudio</a></h1>
<p>Depending on which applications you use, you might need to provide PulseAudio
with a D-BUS session bus (e.g. via <code>dbus-run-session</code>) or a D-BUS system bus
(via the <code>dbus</code> service).</p>
<p>For applications which use ALSA directly and don't support PulseAudio, the
<code>alsa-plugins-pulseaudio</code> package can make them use PulseAudio through ALSA.</p>
<p>PulseAudio will automatically start when needed. If it is not starting
automatically, it can be started manually by invoking
<a href="https://man.voidlinux.org/pulseaudio.1">pulseaudio(1)</a> from the terminal as
follows:</p>
<pre><code>$ pulseaudio --daemonize=no --exit-idle-time=-1
</code></pre>
<p>On the other hand, PulseAudio can also end up being auto activated when it isn't
desired. To inhibit this behavior, the <code>autospawn</code> directive from
<a href="https://man.voidlinux.org/pulse-client.conf.5">pulse-client.conf(5)</a> can be set
to <code>no</code>.</p>
<p>There are several methods of allowing PulseAudio to access to audio devices. The
simplest one is to add your user to the <code>audio</code> group. Alternatively, you can
use a session manager, like <code>elogind</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sndio"><a class="header" href="#sndio">sndio</a></h1>
<p>Install the <code>sndio</code> package and enable the
<a href="https://man.voidlinux.org/sndiod.8">sndiod(8)</a> service.</p>
<h2 id="configuration-5"><a class="header" href="#configuration-5">Configuration</a></h2>
<p>The service can be configured by adding
<a href="https://man.voidlinux.org/sndiod.8">sndiod(8)</a> flags to the <code>OPTS</code> variable in
the service configuration file (<code>/etc/sv/sndiod/conf</code>).</p>
<h3 id="default-device"><a class="header" href="#default-device">Default device</a></h3>
<p><a href="https://man.voidlinux.org/sndiod.8">sndiod(8)</a> uses the first ALSA device by
default. To use another ALSA device for sndio's default device <code>snd/0</code> add the
flags to use specific devices to the service configuration file.</p>
<pre><code># echo 'OPTS=&quot;-f rsnd/Speaker&quot;' &gt;/etc/sv/sndiod/conf
</code></pre>
<p>Use the <code>-f</code> flag to chooses a device by its ALSA device index or its ALSA
device name.</p>
<h2 id="volume-control"><a class="header" href="#volume-control">Volume control</a></h2>
<p>The master and per application volume controls are controlled with MIDI messages
by hardware or software.</p>
<p><a href="https://man.voidlinux.org/aucatctl.1">aucatctl(1)</a> is a tool specific to sndio
to send MIDI control messages to the
<a href="https://man.voidlinux.org/sndiod.8">sndiod(8)</a> daemon. It can be found in the
<code>aucatctl</code> package.</p>
<h2 id="application-specific-configurations"><a class="header" href="#application-specific-configurations">Application specific configurations</a></h2>
<h3 id="firefox"><a class="header" href="#firefox">Firefox</a></h3>
<p>Firefox is built with sndio support and should work out of the box since version
71 if libsndio is installed and the <code>snd/0</code> device is available.</p>
<p>The following <code>about:config</code> changes are required for versions prior to 71 and
should be removed when using version 71 or later:</p>
<pre><code>media.cubeb.backend;sndio
media.cubeb.sandbox;false
security.sandbox.content.read_path_whitelist;/home/&lt;username&gt;/.sndio/cookie
security.sandbox.content.write_path_whitelist;/home/&lt;username&gt;/.sndio/cookie
</code></pre>
<h3 id="openal"><a class="header" href="#openal">OpenAL</a></h3>
<p>libopenal comes with sndio support, but prioritizes ALSA over sndio by default.
You can configure this behavior per user in <code>~/.alsoftrc</code> or system wide in
<code>/etc/openal/alsoft.conf</code> by adding the following lines:</p>
<pre><code>[general]
drivers = sndio
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="bluetooth"><a class="header" href="#bluetooth">Bluetooth</a></h1>
<p>Ensure the Bluetooth controller is not blocked. Use <code>rfkill</code> to check whether
there are any blocks and to remove soft blocks. If there is a hard block, there
is likely either a physical hardware switch or an option in the BIOS to enable
the Bluetooth controller.</p>
<pre><code>$ rfkill
ID TYPE     DEVICE      SOFT      HARD
0 wlan      phy0   unblocked unblocked
1 bluetooth hci0     blocked unblocked

# rfkill unblock bluetooth
</code></pre>
<h2 id="installation-8"><a class="header" href="#installation-8">Installation</a></h2>
<p>Install the <code>bluez</code> package and enable the <code>bluetoothd</code> and <code>dbus</code> services.
Then, add your user to the <code>bluetooth</code> group and restart the <code>dbus</code> service, or
simply reboot the system. Note that restarting the <code>dbus</code> service may kill
processes making use of it.</p>
<p>To use an audio device such as a wireless speaker or headset, ALSA users need to
install the <code>bluez-alsa</code> package. <a href="config/./media/pulseaudio.html">PulseAudio</a> users do
not need any additional software. <a href="config/./media/pipewire.html">PipeWire</a> users need
<code>libspa-bluetooth</code>.</p>
<h2 id="usage-1"><a class="header" href="#usage-1">Usage</a></h2>
<p>Manage Bluetooth connections and controllers using <code>bluetoothctl</code>, which
provides a command line interface and also accepts commands on standard input.</p>
<p>Consult the <a href="https://wiki.archlinux.org/index.php/Bluetooth#Pairing">Arch Wiki</a>
for an example of how to pair a device.</p>
<h2 id="configuration-6"><a class="header" href="#configuration-6">Configuration</a></h2>
<p>The main configuration file is <code>/etc/bluetooth/main.conf</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="tex-live"><a class="header" href="#tex-live">TeX Live</a></h1>
<p>In EvolutionOS, the <code>texlive-bin</code> package provides a basic TeX installation, including
the <code>tlmgr</code> program. Use <code>tlmgr</code> to install TeX packages and package collections
from CTAN mirrors. Install the <code>gnupg</code> package to allow <code>tlmgr</code> to verify TeX
packages.</p>
<p>The <code>texlive-bin</code> package contains the latest TeX Live version; however, earlier
versions, such as <code>texlive2018-bin</code>, are also available.</p>
<p>The <code>texlive</code> package and <code>texlive-*</code> packages are also available, and provide
TeX packages directly via xbps. TeX packages installed via those packages cannot
interact with TeX packages installed directly from CTAN (via <code>tlmgr</code>). For
example: <code>pdflatex</code> from <code>texlive-pdflatex</code> cannot be used to compile a TeX
document that uses a package installed via <code>tlmgr</code>; <code>tlmgr install pdflatex</code>
would be required for that.</p>
<h2 id="configuring-tex-live"><a class="header" href="#configuring-tex-live">Configuring TeX Live</a></h2>
<p>After installing TeX Live, update the value of <code>PATH</code>:</p>
<pre><code>$ source /etc/profile
</code></pre>
<p>Check that <code>/opt/texlive/&lt;year&gt;/bin/x86_64-linux</code> (or
<code>/opt/texlive/&lt;year&gt;/bin/i386-linux</code>) is in your <code>PATH</code>:</p>
<pre><code>$ echo $PATH
</code></pre>
<p>If required, change the global default paper size:</p>
<pre><code># tlmgr paper &lt;letter|a4&gt;
</code></pre>
<h2 id="installingupdating-tex-packages"><a class="header" href="#installingupdating-tex-packages">Installing/Updating TeX packages</a></h2>
<p>To install all available packages:</p>
<pre><code># tlmgr install scheme-full
</code></pre>
<p>To install specific packages, you can install the collection(s) including them.
To list the available collections:</p>
<pre><code>$ tlmgr info collections
</code></pre>
<p>To see the list of files owned by a collection:</p>
<pre><code>$ tlmgr info --list collection-&lt;name&gt;
</code></pre>
<p>To install the collection:</p>
<pre><code># tlmgr install collection-&lt;name&gt;
</code></pre>
<p>To install a standalone package, first check if the package exists:</p>
<pre><code>$ tlmgr search --global &lt;package&gt;
</code></pre>
<p>and then install it:</p>
<pre><code># tlmgr install &lt;package&gt;
</code></pre>
<p>To find the package providing a particular file (for example, a font):</p>
<pre><code>$ tlmgr search --file &lt;filename&gt; --global
</code></pre>
<p>To remove a package or a collection:</p>
<pre><code># tlmgr remove &lt;package&gt;
</code></pre>
<p>To update installed packages:</p>
<pre><code># tlmgr update --all
</code></pre>
<p>For a full description, check:</p>
<p><a href="https://www.tug.org/texlive/doc/tlmgr.html">https://www.tug.org/texlive/doc/tlmgr.html</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="external-applications"><a class="header" href="#external-applications">External Applications</a></h1>
<h2 id="programming-languages"><a class="header" href="#programming-languages">Programming Languages</a></h2>
<p>The EvolutionOS repositories have a number of Python and Lua packages. If possible,
install packages from the EvolutionOS repositories or consider packaging the library or
application you need. Packaging your application allows for easier system
maintenance and can benefit other EvolutionOS users, so consider making a pull
request for it. The contribution instructions can be found
<a href="https://github.com/evolution-linux/evolution-packages/blob/master/CONTRIBUTING.md">here</a>.</p>
<p>To keep packages smaller, EvolutionOS has separate <code>devel</code> packages for header files
and development tools. If you install a library or application via a language's
package manager (e.g. <code>pip</code>, <code>gem</code>), or compile one from source, you may need to
install the programming language's <code>-devel</code> package. This is specially relevant
for <code>musl</code> libc users, due to pre-built binaries usually targeting <code>glibc</code>
instead.</p>
<div class="table-wrapper"><table><thead><tr><th>Language</th><th>Package Manager</th><th>Evolution Package</th></tr></thead><tbody>
<tr><td>Python3</td><td>pip, anaconda, virtualenv, etc</td><td><code>python3-devel</code></td></tr>
<tr><td>Python2</td><td>pip, anaconda, virtualenv, etc</td><td><code>python2-devel</code></td></tr>
<tr><td>Ruby</td><td>gem</td><td><code>ruby-devel</code></td></tr>
<tr><td>lua</td><td>luarocks</td><td><code>lua-devel</code></td></tr>
</tbody></table>
</div>
<h2 id="restricted-packages"><a class="header" href="#restricted-packages">Restricted Packages</a></h2>
<p>Some packages have legal restrictions on their distribution (e.g. Discord), may
be too large, or have another condition that makes it difficult for EvolutionOS to
distribute. These packages have build templates, but the packages themselves are
not built or distributed. As such, they must be built locally. For more
information see the page on <a href="config/../xbps/repositories/restricted.html">restricted
packages</a>.</p>
<h2 id="non-x86_64-arch"><a class="header" href="#non-x86_64-arch">Non-x86_64 Arch</a></h2>
<p>The EvolutionOS build system runs on x86_64 servers, both for compiling and cross
compiling packages. However, some packages (e.g. <code>libreoffice</code>) do not support
cross-compilation. These packages have to be built locally on a computer running
the same architecture and libc as the system on which the package is to be used.
To learn how to build packages, refer to <a href="https://github.com/evolution-linux/evolution-packages/blob/master/README.md">the README for the evolution-packages
repository</a>.</p>
<h2 id="flatpak"><a class="header" href="#flatpak">Flatpak</a></h2>
<p>Flatpak is another method for installing external proprietary applications on
Linux. For information on using Flatpak with EvolutionOS, see the <a href="https://flatpak.org/setup/Void%20Linux/">official
Flatpak documentation</a>.</p>
<p>If sound is not working for programs installed using Flatpak,
<a href="config/./media/pulseaudio.html">PulseAudio</a> auto-activation might not be working
correctly. Make sure PulseAudio is running before launching the program.</p>
<p>Note that Flatpak's sandboxing will not necessarily protect you from any
security and/or privacy-violating features of proprietary software.</p>
<h3 id="troubleshooting-3"><a class="header" href="#troubleshooting-3">Troubleshooting</a></h3>
<p>Some apps may not function properly (e.g. not being able to access the host
system's files). Some of these issues can be fixed by installing one or more of
the <code>xdg-desktop-portal</code>, <code>xdg-desktop-portal-gtk</code>, <code>xdg-user-dirs</code>,
<code>xdg-user-dirs-gtk</code> or <code>xdg-utils</code> packages.</p>
<p>Some Flatpaks require <a href="config/./session-management.html#d-bus">D-Bus</a> and/or
<a href="config/./media/pulseaudio.html">Pulseaudio</a>.</p>
<h2 id="appimages"><a class="header" href="#appimages">AppImages</a></h2>
<p>An <a href="https://appimage.org/">AppImage</a> is a file that bundles an application with
everything needed to run it. An AppImage can be used by making it executable and
running it; installation is not required. AppImages can be run in a sandbox,
such as <a href="https://firejail.wordpress.com/">firejail</a>.</p>
<p>Some of the applications for which an AppImage is available can be found on
<a href="https://appimage.github.io/">AppImageHub</a>.</p>
<p>AppImages do not yet work on musl installations.</p>
<h2 id="octave-packages"><a class="header" href="#octave-packages">Octave Packages</a></h2>
<p>Some Octave packages require external dependencies to compile and run. For
example, to build the control package, you must install the <code>openblas-devel</code>,
<code>libgomp-devel</code>, <code>libgfortran-devel</code>, <code>gcc-fortran</code>, and <code>gcc</code> packages.</p>
<h2 id="matlab"><a class="header" href="#matlab">MATLAB</a></h2>
<p>To use MATLAB's help browser, live scripts, add-on installer, and simulink,
install the <code>libselinux</code> package.</p>
<h2 id="steam"><a class="header" href="#steam">Steam</a></h2>
<p>Steam can be installed either via a native package, which requires <a href="config/../xbps/repositories/index.html#nonfree">enabling the
&quot;nonfree&quot; repository</a>, or via
<a href="config/external-applications.html#flatpak">Flatpak</a>. The list of dependencies for different platforms and
troubleshooting information for the native package can be found in its
<a href="config/./package-documentation/index.html">Evolution-specific documentation</a>, while this
section deals with potential issues faced by Flatpak users.</p>
<p>If you are using a different drive to store your game library, the
<code>--filesystem</code> option from
<a href="https://man.voidlinux.org/flatpak-override.1">flatpak-override(1)</a> can prove
useful.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="printing"><a class="header" href="#printing">Printing</a></h1>
<p>CUPS (Common Unix Printing System) is the supported mechanism for connecting to
printers on EvolutionOS.</p>
<p>As prerequisites, install the <code>cups</code> package and enable the <code>cupsd</code> service.
Wait until the service is marked available.</p>
<h2 id="installing-printing-drivers"><a class="header" href="#installing-printing-drivers">Installing Printing Drivers</a></h2>
<p>If the printer is being accessed over the network and supports PostScript or
PCL, CUPS alone should be sufficient. However, additional driver packages are
necessary for local printer support. The <code>cups-filters</code> package provides driver
support for CUPS.</p>
<p>Depending on the hardware in question, additional drivers may be necessary.</p>
<p>Some CUPS drivers contain proprietary or binary-only extensions. These are
available only in the nonfree repository, and sometimes only for specific
architectures.</p>
<h3 id="driverless-printing"><a class="header" href="#driverless-printing">Driverless printing</a></h3>
<p>Most modern network printers support printing driverlessly using the IPP
Everywhere standard. See <a href="https://www.pwg.org/printers/">https://www.pwg.org/printers/</a> for a list of
self-certified printers supporting this standard. Even if a printer is not on
this list, there is still a high chance it is supported.</p>
<p>Do note that <code>cups-filters</code> is still required for driverless printing.</p>
<h3 id="gutenprint-drivers"><a class="header" href="#gutenprint-drivers">Gutenprint drivers</a></h3>
<p>Gutenprint provides support for many printers. These drivers are contained in
the <code>gutenprint</code> package.</p>
<h3 id="hp-drivers"><a class="header" href="#hp-drivers">HP drivers</a></h3>
<p>Printers from Hewlett-Packard require the <code>hplip</code> package.</p>
<p>Running the following command will guide you through the driver installation
process. The default configuration selections it suggests are typically
sufficient.</p>
<pre><code># hp-setup -i
</code></pre>
<h3 id="brother-drivers"><a class="header" href="#brother-drivers">Brother drivers</a></h3>
<p>For Brother printer support, install the foomatic drivers, which are contained
in the <code>foomatic-db</code> and <code>foomatic-db-nonfree</code> packages. Support for various
laser models is provided by the <code>brother-brlaser</code> package.</p>
<h3 id="drivers-for-epson-inkjet-printers"><a class="header" href="#drivers-for-epson-inkjet-printers">Drivers for Epson Inkjet printers</a></h3>
<p>Install the <code>epson-inkjet-printer-escpr</code> package for Epson Inkjet printers.</p>
<h3 id="canon-pixmamaxify-drivers"><a class="header" href="#canon-pixmamaxify-drivers">Canon PIXMA/MAXIFY drivers</a></h3>
<p>The <code>cnijfilter2</code> package contains drivers for various Canon PIXMA and MAXIFY
models. Please note that installing the driver package requires <a href="config/print/../../xbps/repositories/index.html#nonfree">enabling the
&quot;nonfree&quot; repository</a>.</p>
<h2 id="configuring-a-new-printer"><a class="header" href="#configuring-a-new-printer">Configuring a New Printer</a></h2>
<p>CUPS provides a web interface and command line tools that can be used to
configure printers. Additionally, various native GUI options are available and
may be better suited, depending on the use-case.</p>
<h3 id="automatically"><a class="header" href="#automatically">Automatically</a></h3>
<p>Printers with support for IPP Everywhere can be discovered and configured
automatically using <a href="http://www.zeroconf.org/">ZeroConf</a>. To enable this,
install the <code>avahi</code> and <code>nss-mdns</code> package and enable the <code>avahi-daemon</code>
service.</p>
<h3 id="web-interface"><a class="header" href="#web-interface">Web interface</a></h3>
<p>To configure the printer using the CUPS web interface, navigate to
<a href="http://localhost:631">http://localhost:631</a> in a browser. Under the &quot;Administration&quot; tab, select
&quot;Printers &gt; Add Printer&quot;. When asked to log in, use an account that is in the
<code>lpadmin</code> group.</p>
<h3 id="command-line"><a class="header" href="#command-line">Command line</a></h3>
<p>The <a href="https://man.voidlinux.org/lpadmin.8">lpadmin(8)</a> tool may be used to
configure a printer using the command line.</p>
<h3 id="graphical-interface"><a class="header" href="#graphical-interface">Graphical interface</a></h3>
<p>The <code>system-config-printer</code> package offers simple and robust configuration of
new printers. Install and invoke it:</p>
<pre><code># system-config-printer
</code></pre>
<p>Normally this tool requires root privileges. However, if you are using
PolicyKit, you can install the <code>cups-pk-helper</code> package to allow unprivileged
users to use <code>system-config-printer</code>.</p>
<p>While <code>system-config-printer</code> is shown here, your desktop environment may have a
native printer dialog, which may be found by consulting the documentation for
your DE.</p>
<h2 id="troubleshooting-4"><a class="header" href="#troubleshooting-4">Troubleshooting</a></h2>
<h3 id="usb-printer-not-shown"><a class="header" href="#usb-printer-not-shown">USB printer not shown</a></h3>
<p>The device URI can be found manually by running:</p>
<pre><code># /usr/lib/cups/backend/usb
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="containers-and-virtual-machines"><a class="header" href="#containers-and-virtual-machines">Containers and Virtual Machines</a></h1>
<p>This section describes how to set up some of the container and virtual machine
software available on EvolutionOS.</p>
<h2 id="section-contents-4"><a class="header" href="#section-contents-4">Section Contents</a></h2>
<ul>
<li><a href="config/containers-and-vms/./chroot.html">Chroots and Containers</a></li>
<li><a href="config/containers-and-vms/./libvirt.html">libvirt</a></li>
<li><a href="config/containers-and-vms/./lxc.html">LXC</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="creating-and-using-chroots-and-containers"><a class="header" href="#creating-and-using-chroots-and-containers">Creating and using chroots and containers</a></h1>
<p>chroots and containers can be set up and used for many purposes, including:</p>
<ul>
<li>running glibc software on musl (and vice versa)</li>
<li>running software in a more controlled or sandboxed environment</li>
<li>creating a rootfs for bootstrapping a system</li>
</ul>
<h2 id="chroot-creation"><a class="header" href="#chroot-creation">Chroot Creation</a></h2>
<h3 id="xvoidstrap"><a class="header" href="#xvoidstrap">xvoidstrap</a></h3>
<p><a href="https://man.voidlinux.org/xvoidstrap.1"><code>xvoidstrap(1)</code></a> (from <code>xtools</code>) can be
used to create the chroot:</p>
<pre><code># mkdir &lt;chroot_dir&gt;
# XBPS_ARCH=&lt;chroot_arch&gt; xvoidstrap &lt;chroot_dir&gt; base-voidstrap &lt;other_pkgs&gt;
</code></pre>
<p><code>&lt;other_pkgs&gt;</code> is only needed if you want to pre-install other packages in the
chroot.</p>
<h3 id="manual-creation"><a class="header" href="#manual-creation">Manual Creation</a></h3>
<p>Alternatively, this process can be done manually.</p>
<p>Create a directory that will contain the chroot, then install a base system in
it via the <code>base-voidstrap</code> package:</p>
<pre><code># mkdir -p &quot;&lt;chroot_dir&gt;/var/db/xbps/keys&quot;
# cp -a /var/db/xbps/keys/* &quot;&lt;chroot_dir&gt;/var/db/xbps/keys&quot;
# XBPS_ARCH=&lt;chroot_arch&gt; xbps-install -S -r &lt;chroot_dir&gt; -R &lt;repository&gt; base-voidstrap &lt;other_pkgs&gt;
</code></pre>
<p>The <code>&lt;repository&gt;</code> may <a href="config/containers-and-vms/../../xbps/repositories/index.html#the-main-repository">vary depending on
architecture</a>.</p>
<p><code>&lt;other_pkgs&gt;</code> is only needed if you want to pre-install other packages in the
chroot.</p>
<h2 id="chroot-usage"><a class="header" href="#chroot-usage">Chroot Usage</a></h2>
<h3 id="xchroot"><a class="header" href="#xchroot">xchroot</a></h3>
<p><a href="https://man.voidlinux.org/xchroot.1"><code>xchroot(1)</code></a> (from <code>xtools</code>) can be used
to automatically set up and enter the chroot.</p>
<h3 id="manual-method"><a class="header" href="#manual-method">Manual Method</a></h3>
<p>Alternatively, this process can be done manually.</p>
<p>If network access is required, copy <code>/etc/resolv.conf</code> into the chroot;
<code>/etc/hosts</code> may need to be copied as well.</p>
<p>Several directories then need to be mounted as follows:</p>
<pre><code># mount -t proc none &lt;chroot_dir&gt;/proc
# mount -t sysfs none &lt;chroot_dir&gt;/sys
# mount --rbind /dev &lt;chroot_dir&gt;/dev
# mount --rbind /run &lt;chroot_dir&gt;/run
</code></pre>
<p>Use <a href="https://man.voidlinux.org/chroot.1">chroot(1)</a> to change to the new root,
then run programs and do tasks as usual. Once finished with the chroot, unmount
the chroot using <a href="https://man.voidlinux.org/umount.8">umount(8)</a>. If any
destructive actions are taken on the chroot directory without unmounting first,
you may need to reboot to repopulate the affected directories.</p>
<h3 id="alternatives"><a class="header" href="#alternatives">Alternatives</a></h3>
<h4 id="bubblewrap"><a class="header" href="#bubblewrap">Bubblewrap</a></h4>
<p><a href="https://man.voidlinux.org/bwrap.1">bwrap(1)</a> (from the <code>bubblewrap</code> package)
has additional features like the ability for sandboxing and does not require
root access.</p>
<p><code>bwrap</code> is very flexible and can be used in many ways, for example:</p>
<pre><code>$ bwrap --bind &lt;chroot_dir&gt; / \
	--dev /dev \
	--proc /proc \
	--bind /sys /sys \
	--bind /run /run \
	--ro-bind /etc/resolv.conf /etc/resolv.conf \
	--ro-bind /etc/passwd /etc/passwd \
	--ro-bind /etc/group /etc/group \
	&lt;command&gt;
</code></pre>
<p>In this example, you will not be able to add or edit users or groups. When
running graphical applications with Xorg, you may need to also bind-mount
<code>~/.Xauthority</code> or other files or directories.</p>
<p>The <a href="https://man.voidlinux.org/bwrap.1">bwrap(1) manpage</a> and the <a href="https://wiki.archlinux.org/title/Bubblewrap#Usage_examples">Arch Wiki
article</a> contain
more examples of <code>bwrap</code> usage.</p>
<h4 id="flatpak-1"><a class="header" href="#flatpak-1">Flatpak</a></h4>
<p><a href="config/containers-and-vms/../external-applications.html#flatpak">Flatpak</a> is a convenient option for
running many applications, including graphical or proprietary ones, on both
glibc and musl systems.</p>
<h4 id="application-containers"><a class="header" href="#application-containers">Application Containers</a></h4>
<p>If a more integrated and polished solution is desired, EvolutionOS also <a href="https://github.com/void-linux/void-docker/pkgs/container/void-linux">provides OCI
containers</a>
that work with tools like <a href="https://www.docker.com">docker</a> and
<a href="https://man.voidlinux.org/podman.1">podman</a>. These containers do not require
the creation of a chroot directory before usage.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="libvirt"><a class="header" href="#libvirt">libvirt</a></h1>
<p><a href="https://libvirt.org/">libvirt</a> is an API and daemon for managing platform
virtualization, supporting virtualization technologies such as LXC, KVM, QEMU,
Bhyve, Xen, VMWare, and Hyper-V.</p>
<p>To use libvirt, install the <code>libvirt</code> package, ensure the <code>dbus</code> package is
installed, and <a href="config/containers-and-vms/../services/index.html#enabling-services">enable</a> the <code>dbus</code>,
<code>libvirtd</code>, <code>virtlockd</code> and <code>virtlogd</code> services. The <code>libvirtd</code> daemon can be
reconfigured at runtime via
<a href="https://man.voidlinux.org/virt-admin.1">virt-admin(1)</a>.</p>
<p>The <code>libvirt</code> package provides the <a href="https://man.voidlinux.org/virsh.1">virsh(1)</a>
interface to libvirtd. <code>virsh</code> is an interactive shell and batch-scriptable tool
for performing management tasks, including creating, configuring and running
virtual machines, and managing networks and storage. Note that <code>virsh</code> usually
needs to be run as root, as described in the <code>virsh</code> man page:</p>
<blockquote>
<p>Most virsh commands require root privileges to run due to the communications
channels used to talk to the hypervisor. Running as non root will return an
error.</p>
</blockquote>
<p>However, if you have the <code>polkit</code> and <code>dbus</code> packages installed and you enable
the <code>dbus</code> service, <code>libvirtd</code> will grant necessary privileges to any user added
to the <code>libvirt</code> group.</p>
<p>An alternative to <code>virsh</code> is provided by the <code>virt-manager</code> and
<code>virt-manager-tools</code> packages.</p>
<p>For general information on libvirt, refer to <a href="https://wiki.libvirt.org/page/Main_Page">the libvirt
wiki</a> and <a href="https://wiki.libvirt.org/page/FAQ">the wiki's
FAQ</a>. For an introduction to libvirt usage,
refer to <a href="https://wiki.libvirt.org/page/VM_lifecycle">the &quot;VM lifecycle&quot; page</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="lxc"><a class="header" href="#lxc">LXC</a></h1>
<p>The <a href="https://linuxcontainers.org/">Linux Containers project</a> includes three
subprojects: <a href="https://linuxcontainers.org/lxc/introduction/">LXC</a>,
<a href="https://linuxcontainers.org/lxd/introduction/">LXD</a> and
<a href="https://linuxcontainers.org/lxcfs/introduction/">LXCFS</a>. The project also
included the CGManager project, which has been deprecated in favor of the CGroup
namespace in recent kernels.</p>
<h2 id="configuring-lxc"><a class="header" href="#configuring-lxc">Configuring LXC</a></h2>
<p>Install the <code>lxc</code> package.</p>
<p>Creating and running privileged containers as <code>root</code> does not require any
configuration; simply use the various <code>lxc-*</code> commands, such as
<a href="https://man.voidlinux.org/lxc-create.1">lxc-create(1)</a>,
<a href="https://man.voidlinux.org/lxc-start.1">lxc-start(1)</a>,
<a href="https://man.voidlinux.org/lxc-attach.1">lxc-attach(1)</a>, etc.</p>
<h3 id="creating-unprivileged-containers"><a class="header" href="#creating-unprivileged-containers">Creating unprivileged containers</a></h3>
<p>User IDs (UIDs) and group IDs (GIDs) normally range from 0 to 65535.
Unprivileged containers enhance security by mapping UID and GID ranges inside
each container to ranges not in use by the host system. The unused host ranges
must be <em>subordinated</em> to the user who will be running the unprivileged
containers.</p>
<p>Subordinate UIDs and GIDs are assigned in the
<a href="https://man.voidlinux.org/subuid.5">subuid(5)</a> and
<a href="https://man.voidlinux.org/subgid.5">subgid(5)</a> files, respectively.</p>
<p>To create unprivileged containers, first edit <code>/etc/subuid</code> and <code>/etc/subgid</code> to
delegate ranges. For example:</p>
<pre><code>root:1000000:65536
user:2000000:65536
</code></pre>
<p>In each colon-delimited entry:</p>
<ul>
<li>the first field is the user to which a subordinate range will be assigned;</li>
<li>the second field is the smallest numeric ID defining a subordinate range; and</li>
<li>the third field is the number of consecutive IDs in the range.</li>
</ul>
<p>The <a href="https://man.voidlinux.org/usermod.8">usermod(8)</a> program may also be used
to manipulate suborinated IDs.</p>
<p>Generally, the number of consecutive IDs should be an integer multiple of 65536;
the starting value is not important, except to ensure that the various ranges
defined in the file do not overlap. In this example, <code>root</code> controls UIDs (or,
from <code>subgid</code>, GIDs) ranging from 1000000 to 1065535, inclusive; <code>user</code> controls
IDs ranging from 2000000 to 2065535.</p>
<p>Before creating a container, the user owning the container will need an
<a href="https://man.voidlinux.org/lxc.conf.5">lxc.conf(5)</a> file specifying the subuid
and subgid range to use. For root-owned containers, this file resides at
<code>/etc/lxc/default.conf</code>; for unprivileged users, the file resides at
<code>~/.config/lxc/default.conf</code>. Mappings are described in lines of the form</p>
<pre><code>lxc.idmap = u 0 1000000 65536
lxc.idmap = g 0 1000000 65536
</code></pre>
<p>The isolated <code>u</code> character indicates a UID mapping, while the isolated <code>g</code>
indicates a GID mapping. The first numeric value should generally always be 0;
this indicates the start of the UID or GID range <em>as seen from within the
container</em>. The second numeric value is the start of the corresponding range <em>as
seen from outside the container</em>, and may be an arbitrary value within the range
delegated in <code>/etc/subuid</code> or <code>/etc/subgid</code>. The final value is the number of
consecutive IDs to map.</p>
<p>Note that, although the external range start is arbitrary, care must be taken to
ensure that the end of the range implied by the start and number does not extend
beyond the range of IDs delegated to the user.</p>
<p>If configuring a non-root user, edit <code>/etc/lxc/lxc-usernet</code> as root to specify a
network device quota. For example, to allow the user named <code>user</code> to create up
to 10 <code>veth</code> devices connected to the <code>lxcbr0</code> bridge:</p>
<pre><code>user veth lxcbr0 10
</code></pre>
<p>The user can now create and use unprivileged containers with the <code>lxc-*</code>
utilities. To create a simple EvolutionOS container named <code>mycontainer</code>, use a command
similar to:</p>
<pre><code>lxc-create -n mycontainer -t download -- \
	--dist voidlinux --release current --arch amd64
</code></pre>
<p>You may substitute another architecture for <code>amd64</code>, and you may specify a
<code>musl</code> image by adding <code>--variant musl</code> to the end of the command. See the <a href="http://images.linuxcontainers.org">LXC
Image Server</a> for a list of available
containers.</p>
<p>By default, configurations and mountpoints for system containers are stored in
<code>/var/lib/lxc</code>, while configurations for user containers and mountpoints are
stored in <code>~/.local/share/lxc</code>. Both of these values can be modified by setting
<code>lxc.lxcpath</code> in the
<a href="https://man.voidlinux.org/lxc.system.conf.5">lxc.system.conf(5)</a> file. The
superuser may launch unprivileged containers in the system <code>lxc.lxcpath</code> defined
in <code>/etc/lxc/lxc.conf</code>; regular users may launch unprivileged containers in the
personal <code>lxc.lxcpath</code> defined in <code>~/.config/lxc/lxc.conf</code>.</p>
<p>All containers will share the same subordinate UID and GID maps by default. This
is permissible, but it means that an attacker who gains elevated access within
one container, and can somehow break out of that container, will have similar
access to other containers. To isolate containers from each other, alter the
<code>lxc.idmap</code> ranges in <code>default.conf</code> to point to a unique range <em>before</em> you
create each container. Trying to fix permissions on a container created with the
wrong map is possible, but inconvenient.</p>
<h2 id="lxd"><a class="header" href="#lxd">LXD</a></h2>
<p>LXD provides an alternative interface to LXC's <code>lxc-*</code> utilities. However, it
does not require the configuration described in <a href="config/containers-and-vms/lxc.html#lxc">the previous section</a>.</p>
<p>Install the <code>lxd</code> package, and <a href="config/containers-and-vms/../services/index.html#enabling-services">enable</a>
the <code>lxd</code> service.</p>
<p>LXD users must belong to the <code>lxd</code> group.</p>
<p>Use the <code>lxc</code> command to manage instances, as described
<a href="https://linuxcontainers.org/lxd/getting-started-cli/#lxd-client">here</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="gnupg"><a class="header" href="#gnupg">GnuPG</a></h1>
<p>EvolutionOS ships both GnuPG legacy (as <code>gnupg1</code>) and GnuPG stable (as <code>gnupg</code>).</p>
<h2 id="smartcards"><a class="header" href="#smartcards">Smartcards</a></h2>
<p>For using smartcards such as Yubikeys with GnuPG, there are two backends for
communicating with them through GnuPG: The internal CCID driver of GnuPG's
scdaemon, or the PC/SC driver.</p>
<h2 id="scdaemon-with-internal-ccid-driver"><a class="header" href="#scdaemon-with-internal-ccid-driver">scdaemon with internal CCID driver</a></h2>
<p>By default, scdaemon, which is required for using smartcards with GnuPG, uses
its internal CCID driver. For this to work, your smartcard needs to be one of
the smartcards in the udev rules
<a href="https://github.com/void-linux/void-packages/blob/master/srcpkgs/gnupg/files/60-scdaemon.rules">here</a>
and you need to either be using elogind or be a member of the plugdev group. If
these two condition are fulfilled and you don't have pcscd running, <code>gpg --card-status</code> should successfully print your current card status.</p>
<h2 id="scdaemon-with-pcscd-backend"><a class="header" href="#scdaemon-with-pcscd-backend">scdaemon with pcscd backend</a></h2>
<p>If you need to use pcscd for other reasons, run <code>echo disable-ccid &gt;&gt; ~/.gnupg/scdaemon.conf</code>. Now, assuming your pcscd setup works correctly, <code>gpg --card-status</code> should print your card status.</p>
<h1 id="openpgp-card-tools"><a class="header" href="#openpgp-card-tools">OpenPGP Card Tools</a></h1>
<p>As an alternative to GnuPG with smartcards, EvolutionOS also ships
<code>openpgp-card-tools</code>, a Rust based utility not reliant on GnuPG. It requires
using <code>pcscd</code> for interacting with smart cards, so if you want to use it in
parallel with GnuPG, ou need to configure <code>scdaemon</code> to use the pcscd backend,
as described above in &quot;<a href="config/openpgp.html#scdaemon-with-pcscd-backend">scdaemon with pcscd
backend</a>&quot;.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="php"><a class="header" href="#php">PHP</a></h1>
<p>There are two ways to install PHP packages with XBPS:</p>
<ol>
<li>Using the versioned packages (recommended).</li>
<li>Using the meta-packages.</li>
</ol>
<h2 id="versioned-php-packages"><a class="header" href="#versioned-php-packages">Versioned PHP Packages</a></h2>
<p>It is generally recommended to use versioned PHP packages (e.g. <code>php8.1</code>,
<code>php8.1-apcu</code>, etc.) for most use cases as this ensures a consistent environment
on updates with minimal or no intervention required.</p>
<h2 id="php-meta-packages"><a class="header" href="#php-meta-packages">PHP Meta-packages</a></h2>
<p>In EvolutionOS, the <code>php</code> package is a meta-package that points to the latest upstream
PHP version. This convention is followed by all packages prefixed with <code>php-</code>,
such as <code>php-fpm</code>, as well as <code>xdebug</code> and <code>composer</code>. See <a href="https://github.com/void-linux/void-packages/blob/master/srcpkgs/php/template">the <code>php</code>
template</a>
for a complete list. It is recommended to only use these meta-packages for
development purposes.</p>
<p>When using a PHP meta-package, be warned that updating may require manual
intervention if a new major PHP version has been added to the repository. As a
part of the version change, the configuration location will change to reflect
the new version. For example, upgrading from 8.0 to 8.1 would result in the
configuration path changing from <code>/etc/php8.0</code> to <code>/etc/php8.1</code>. Any
customizations that have been made need to be manually applied to the new
configuration directory.</p>
<p><code>php-fpm</code> updates require special care since they include a runit service. In
this case, ensure that the new runit service is started and that applications
using the previous version of <code>php-fpm</code> can access the new <code>php-fpm</code> instance.
In particular, make sure any applications accessing the FPM instance have the
correct TCP/unix socket address.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="xbps-package-manager"><a class="header" href="#xbps-package-manager">XBPS Package Manager</a></h1>
<p>The X Binary Package System (XBPS) is a fast package manager that has been
designed and implemented from scratch. XBPS is managed by the Void Linux team
and developed at <a href="https://github.com/void-linux/xbps">https://github.com/void-linux/xbps</a>.</p>
<p>Most general package management is done with the following commands:</p>
<ul>
<li><a href="https://man.voidlinux.org/xbps-query.1">xbps-query(1)</a> searches for and
displays information about packages installed locally, or, if used with the
<code>-R</code> flag, packages contained in repositories.</li>
<li><a href="https://man.voidlinux.org/xbps-install.1">xbps-install(1)</a> installs and
updates packages, and syncs repository indexes.</li>
<li><a href="https://man.voidlinux.org/xbps-remove.1">xbps-remove(1)</a> removes installed
packages, and can also remove orphaned packages and cached package files.</li>
<li><a href="https://man.voidlinux.org/xbps-reconfigure.1">xbps-reconfigure(1)</a> runs the
configuration steps for installed packages, and can be used to reconfigure
certain packages after changes in their configuration files. The latter
usually requires the <code>--force</code> flag.</li>
<li><a href="https://man.voidlinux.org/xbps-alternatives.1">xbps-alternatives(1)</a> lists or
sets the alternatives provided by installed packages. Alternatives is a
system which allows multiple packages to provide common functionality through
otherwise conflicting files, by creating symlinks from the common paths to
package-specific versions that are selected by the user.</li>
<li><a href="https://man.voidlinux.org/xbps-pkgdb.1">xbps-pkgdb(1)</a> can report and fix
issues in the package database, as well as modify it.</li>
<li><a href="https://man.voidlinux.org/xbps-rindex.1">xbps-rindex(1)</a> manages local binary
package repositories.</li>
</ul>
<p>Most questions can be answered by consulting the man pages for these tools,
together with the <a href="https://man.voidlinux.org/xbps.d.5">xbps.d(5)</a> man page.</p>
<p>To learn how to build packages from source, refer to <a href="https://github.com/evolution-linux/evolution-packages/blob/master/README.md">the README for the
evolution-packages
repository</a>.</p>
<h2 id="updating"><a class="header" href="#updating">Updating</a></h2>
<p>Like any other system, it is important to keep Evolution up-to-date. Use
<a href="https://man.voidlinux.org/xbps-install.1">xbps-install(1)</a> to update:</p>
<pre><code># xbps-install -Su
</code></pre>
<p>XBPS must use a separate transaction to update itself. If your update includes
the <code>xbps</code> package, you will need to run the above command a second time to
apply the rest of the updates.</p>
<h3 id="restarting-services"><a class="header" href="#restarting-services">Restarting Services</a></h3>
<p>XBPS does not restart services when they are updated. This task is left to the
administrator, so they can orchestrate maintenance windows, ensure reasonable
backup capacity, and generally be present for service upgrades.</p>
<p>To find processes running different versions than are present on disk, use the
<code>xcheckrestart</code> tool provided by the <code>xtools</code> package:</p>
<pre><code>$ xcheckrestart
11339 /opt/google/chrome/chrome (deleted) (google-chrome)
</code></pre>
<p><code>xcheckrestart</code> will print out the PID, path to the executable, status of the
path that was launched (almost always <code>deleted</code>) and the process name.</p>
<p><code>xcheckrestart</code> can and should be run as an unprivileged user.</p>
<h3 id="kernel-panic-after-update"><a class="header" href="#kernel-panic-after-update">Kernel Panic After Update</a></h3>
<p>If you get a kernel panic after an update, it is likely your system ran out of
space in <code>/boot</code>. Refer to &quot;<a href="xbps/../config/kernel.html#removing-old-kernels">Removing old
kernels</a>&quot; for further information.</p>
<h2 id="finding-files-and-packages"><a class="header" href="#finding-files-and-packages">Finding Files and Packages</a></h2>
<p>To search available repositories for packages, use
<a href="https://man.voidlinux.org/xbps-query.1">xbps-query(1)</a>:</p>
<pre><code>$ xbps-query -Rs &lt;search_pattern&gt;
</code></pre>
<p>The <code>-R</code> flag specifies that repositories should be searched. Without it, <code>-s</code>
searches for locally-installed packages.</p>
<p>If you can't find a file or program you expected to find after installing a
package, you can use <a href="https://man.voidlinux.org/xbps-query.1">xbps-query(1)</a> to
list the files provided by that package:</p>
<pre><code>$ xbps-query -f &lt;package_name&gt;
</code></pre>
<p>The <code>xtools</code> package contains the
<a href="https://man.voidlinux.org/xlocate.1">xlocate(1)</a> utility. <code>xlocate</code> works like
<a href="https://man.voidlinux.org/locate.1">locate(1)</a>, but for files in the Evolution
package repositories:</p>
<pre><code>$ xlocate -S
Fetching objects: 11688, done.
From https://repo-default.voidlinux.org/xlocate/xlocate
 + e122c3634...a2659176f master     -&gt; master  (forced update)
$ xlocate xlocate
xtools-0.59_1   /usr/bin/xlocate
xtools-0.59_1   /usr/share/man/man1/xlocate.1 -&gt; /usr/share/man/man1/xtools.1
</code></pre>
<p>It is also possible to use
<a href="https://man.voidlinux.org/xbps-query.1">xbps-query(1)</a> to find files, though
this is strongly discouraged:</p>
<pre><code>$ xbps-query -Ro /usr/bin/xlocate
xtools-0.46_1: /usr/bin/xlocate (regular file)
</code></pre>
<p>This requires <code>xbps-query</code> to download parts of every package to find the file.
<code>xlocate</code>, however, queries a locally cached index of all files, so no network
access is required.</p>
<p>To get a list of all installed packages, without their version:</p>
<pre><code>$ xbps-query -l | awk '{ print $2 }' | xargs -n1 xbps-uhelper getpkgname
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="advanced-usage"><a class="header" href="#advanced-usage">Advanced Usage</a></h1>
<h2 id="downgrading"><a class="header" href="#downgrading">Downgrading</a></h2>
<p>XBPS allows you to downgrade a package to a specific package version.</p>
<h3 id="via-xdowngrade"><a class="header" href="#via-xdowngrade">Via xdowngrade</a></h3>
<p>The easiest way to downgrade is to use <code>xdowngrade</code> from the <code>xtools</code> package,
specifying the package version to which you wish to downgrade:</p>
<pre><code># xdowngrade /var/cache/xbps/pkg-1.0_1.xbps
</code></pre>
<h3 id="via-xbps"><a class="header" href="#via-xbps">Via XBPS</a></h3>
<p>XBPS can be used to downgrade to a package version that is no longer available
in the repository index.</p>
<p>If the package version had been installed previously, it will be available in
<code>/var/cache/xbps/</code>. If not, it will need to be obtained from elsewhere; for the
purposes of this example, it will be assumed that the package version has been
added to <code>/var/cache/xbps/</code>.</p>
<p>First add the package version to your local repository:</p>
<pre><code># xbps-rindex -a /var/cache/xbps/pkg-1.0_1.xbps
</code></pre>
<p>Then downgrade with <code>xbps-install</code>:</p>
<pre><code># xbps-install -R /var/cache/xbps/ -f pkg-1.0_1
</code></pre>
<p>The <code>-f</code> flag is necessary to force downgrade/re-installation of an already
installed package.</p>
<h2 id="holding-packages"><a class="header" href="#holding-packages">Holding packages</a></h2>
<p>To prevent a package from being updated during a system update, use
<a href="https://man.voidlinux.org/xbps-pkgdb.1">xbps-pkgdb(1)</a>:</p>
<pre><code># xbps-pkgdb -m hold &lt;package&gt;
</code></pre>
<p>The hold can be removed with:</p>
<pre><code># xbps-pkgdb -m unhold &lt;package&gt;
</code></pre>
<h2 id="repository-locking-packages"><a class="header" href="#repository-locking-packages">Repository-locking packages</a></h2>
<p>If you've used <code>xbps-src</code> to build and install a package from a customized
template, or with custom build options, you may wish to prevent system updates
from replacing that package with a non-customized version. To ensure that a
package is only updated from the same repository used to install it, you can
<em>repolock</em> it via <a href="https://man.voidlinux.org/xbps-pkgdb.1">xbps-pkgdb(1)</a>:</p>
<pre><code># xbps-pkgdb -m repolock &lt;package&gt;
</code></pre>
<p>To remove the repolock:</p>
<pre><code># xbps-pkgdb -m repounlock &lt;package&gt;
</code></pre>
<h2 id="ignoring-packages"><a class="header" href="#ignoring-packages">Ignoring Packages</a></h2>
<p>Sometimes you may wish to remove a package whose functionality is being provided
by another package, but will be unable to do so due to dependency issues. For
example, you may wish to use <a href="https://man.voidlinux.org/doas.1">doas(1)</a> instead
of <a href="https://man.voidlinux.org/sudo.8">sudo(8)</a>, but will be unable to remove the
<code>sudo</code> package due to it being a dependency of the <code>base-system</code> package. To
remove it, you will need to <em>ignore</em> the <code>sudo</code> package.</p>
<p>To ignore a package, add an appropriate <code>ignorepkg</code> entry in an
<a href="https://man.voidlinux.org/xbps.d.5">xbps.d(5)</a> configuration file. For example:</p>
<pre><code>ignorepkg=sudo
</code></pre>
<p>You will then be able to remove the <code>sudo</code> package using
<a href="https://man.voidlinux.org/xbps-remove.1">xbps-remove(1)</a>.</p>
<h2 id="virtual-packages"><a class="header" href="#virtual-packages">Virtual Packages</a></h2>
<p>Virtual packages can be created with
<a href="https://man.voidlinux.org/xbps.d.5">xbps.d(5)</a> <code>virtualpkg</code> entries. Any
request to the virtual package will be resolved to the real package. For
example, to create a <code>linux</code> virtual package which will resolve to the
<code>linux5.6</code> package, create an <code>xbps.d</code> configuration file with the contents:</p>
<pre><code>virtualpkg=linux:linux5.6
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="repositories"><a class="header" href="#repositories">Repositories</a></h1>
<p>Repositories are the heart of the XBPS package system. Repositories can be local
or remote. A repository contains binary package files, which may have
signatures, and a data file named <code>$ARCH-repodata</code> (e.g. <code>x86_64-repodata</code>),
which may also be signed.</p>
<p>Note that, while local repositories do not require signatures, remote
repositories <strong>must</strong> be signed.</p>
<h2 id="the-main-repository"><a class="header" href="#the-main-repository">The main repository</a></h2>
<p>The locations of the main repository in relation to a base <a href="xbps/repositories/./mirrors/index.html">mirror
URL</a> are:</p>
<ul>
<li>glibc: <code>/current</code></li>
<li>musl: <code>/current/musl</code></li>
<li>aarch64 and aarch64-musl: <code>/current/aarch64</code></li>
</ul>
<p>There is also an additional repository containing patches at </p>
<p>https://evolution-linux.github.io/pkg</p>
<h2 id="subrepositories"><a class="header" href="#subrepositories">Subrepositories</a></h2>
<p>In addition to the main repository, which is enabled upon installation, EvolutionOS
provides other official repositories maintained by the Void project, but not
enabled by default:</p>
<ul>
<li>nonfree: contains software packages with non-free licenses</li>
<li>multilib: contains 32-bit libraries for 64-bit systems (glibc only)</li>
<li>multilib/nonfree: contains non-free multilib packages</li>
<li>debug: contains debugging symbols for packages</li>
</ul>
<p>These repositories can be enabled via the installation of the relevant package.
These packages only install a repository configuration file in
<code>/usr/share/xbps.d</code>.</p>
<h3 id="nonfree"><a class="header" href="#nonfree">nonfree</a></h3>
<p>EvolutionOS has a <code>nonfree</code> repository for packages that don't have free licenses. It
can be enabled by installing the <code>void-repo-nonfree</code> package.</p>
<p>Packages can end up in the <code>nonfree</code> repository for a number of reasons:</p>
<ul>
<li>Non-free licensed software with released source-code.</li>
<li>Software released only as redistributable binary packages.</li>
<li>Patented technology, which may or may not have an (otherwise) open
implementation.</li>
</ul>
<h3 id="multilib"><a class="header" href="#multilib">multilib</a></h3>
<p>The <code>multilib</code> repository provides 32-bit packages as a compatibility layer
inside a 64-bit system. It can be enabled by installing the <code>void-repo-multilib</code>
package.</p>
<p>These repositories are only available for <code>x86_64</code> systems running the <code>glibc</code> C
library.</p>
<h3 id="multilibnonfree"><a class="header" href="#multilibnonfree">multilib/nonfree</a></h3>
<p>The <code>multilib/nonfree</code> repository provides additional 32-bit packages which have
non-free licenses. It can be enabled by installing the
<code>void-repo-multilib-nonfree</code> package.</p>
<h3 id="debug"><a class="header" href="#debug">debug</a></h3>
<p>EvolutionOS packages come without debugging symbols. If you want to debug
software or look at a core dump you will need the debugging symbols. These
packages are contained in the debug repository. It can be enabled by installing
the <code>void-repo-debug</code> package.</p>
<p>Once enabled, symbols may be obtained for <code>&lt;package&gt;</code> by installing
<code>&lt;package&gt;-dbg</code>.</p>
<h4 id="finding-debug-dependencies"><a class="header" href="#finding-debug-dependencies">Finding debug dependencies</a></h4>
<p>The <code>xtools</code> package contains the <a href="https://man.voidlinux.org/xtools.1">xdbg(1)</a>
utility to retrieve a list of debug packages, including dependencies, for a
package:</p>
<pre><code>$ xdbg bash
bash-dbg
glibc-dbg
# xbps-install -S $(xdbg bash)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="mirrors"><a class="header" href="#mirrors">Mirrors</a></h1>
<p>EvolutionOS uses the Void Linux repos, which maintains mirrors in several
geographic regions for you to use. A fresh install will default to using the
master mirror in Europe, but you may also <a href="xbps/repositories/mirrors/./changing.html">select a different mirror</a>
manually.</p>
<h2 id="tier-0-mirrors"><a class="header" href="#tier-0-mirrors">Tier 0 mirrors</a></h2>
<p>Tier 0 mirrors contain patches for evolutionOS to work correctly. There is only
one at:</p>
<p>https://evolution-linux.github.io</p>
<h2 id="tier-1-mirrors"><a class="header" href="#tier-1-mirrors">Tier 1 mirrors</a></h2>
<p>Tier 1 mirrors are maintained by the Void Linux Infrastructure Team. These
mirrors sync directly from the build-master and will always have the latest
packages available.</p>
<p>By default XBPS will reach out to <a href="https://repo-default.voidlinux.org">https://repo-default.voidlinux.org</a> which may
map to any tier 1 mirror.</p>
<!-- Order alphabetically by: (1) Region, (2) Country, (3) City/State/Province/etc, (4) URL -->
<div class="table-wrapper"><table><thead><tr><th>Repository</th><th>Region</th><th>Location</th></tr></thead><tbody>
<tr><td><a href="https://repo-fastly.voidlinux.org/">https://repo-fastly.voidlinux.org/</a></td><td>Global</td><td>Fastly Global CDN</td></tr>
<tr><td><a href="https://repo-fi.voidlinux.org/">https://repo-fi.voidlinux.org/</a></td><td>Europe</td><td>Helsinki, Finland</td></tr>
<tr><td><a href="https://repo-de.voidlinux.org/">https://repo-de.voidlinux.org/</a></td><td>Europe</td><td>Frankfurt, Germany</td></tr>
<tr><td><a href="https://mirrors.servercentral.com/voidlinux/">https://mirrors.servercentral.com/voidlinux/</a></td><td>North America</td><td>Chicago, USA</td></tr>
</tbody></table>
</div><!-- | <https://repo-us.voidlinux.org/>               | North America | Kansas City, USA   | -->
<h2 id="tier-2-mirrors"><a class="header" href="#tier-2-mirrors">Tier 2 mirrors</a></h2>
<p>Tier 2 mirrors sync from a nearby Tier 1 mirror when possible. These mirrors are
not managed by us or the Void team and do not have any guarantees of freshness or completeness
of packages, nor are they required to sync every available architecture or
sub-repository.</p>
<h3 id="globally-available-mirrors"><a class="header" href="#globally-available-mirrors">Globally-available mirrors</a></h3>
<!-- Order alphabetically by: (1) Region, (2) Country, (3) City/State/Province/etc, (4) URL -->
<div class="table-wrapper"><table><thead><tr><th>Repository</th><th>Region</th><th>Location</th></tr></thead><tbody>
<tr><td><a href="https://mirror.ps.kz/voidlinux/">https://mirror.ps.kz/voidlinux/</a></td><td>Asia</td><td>Almaty, Kazakhstan</td></tr>
<tr><td><a href="https://mirror.nju.edu.cn/voidlinux/">https://mirror.nju.edu.cn/voidlinux/</a></td><td>Asia</td><td>China</td></tr>
<tr><td><a href="https://mirrors.bfsu.edu.cn/voidlinux/">https://mirrors.bfsu.edu.cn/voidlinux/</a></td><td>Asia</td><td>Beijing, China</td></tr>
<tr><td><a href="https://mirrors.cnnic.cn/voidlinux/">https://mirrors.cnnic.cn/voidlinux/</a></td><td>Asia</td><td>Beijing, China</td></tr>
<tr><td><a href="https://mirrors.tuna.tsinghua.edu.cn/voidlinux/">https://mirrors.tuna.tsinghua.edu.cn/voidlinux/</a></td><td>Asia</td><td>Beijing, China</td></tr>
<tr><td><a href="https://mirror.sjtu.edu.cn/voidlinux/">https://mirror.sjtu.edu.cn/voidlinux/</a></td><td>Asia</td><td>Shanghai, China</td></tr>
<tr><td><a href="https://void.webconverger.org/">https://void.webconverger.org/</a></td><td>Asia</td><td>Singapore</td></tr>
<tr><td><a href="http://ftp.dk.xemacs.org/voidlinux/">http://ftp.dk.xemacs.org/voidlinux/</a></td><td>Europe</td><td>Denmark</td></tr>
<tr><td><a href="https://mirrors.dotsrc.org/voidlinux/">https://mirrors.dotsrc.org/voidlinux/</a></td><td>Europe</td><td>Denmark</td></tr>
<tr><td><a href="https://ftp.cc.uoc.gr/mirrors/linux/voidlinux/">https://ftp.cc.uoc.gr/mirrors/linux/voidlinux/</a></td><td>Europe</td><td>Greece</td></tr>
<tr><td><a href="https://quantum-mirror.hu/mirrors/pub/voidlinux/">https://quantum-mirror.hu/mirrors/pub/voidlinux/</a></td><td>Europe</td><td>Hungary</td></tr>
<tr><td><a href="https://voidlinux.mirror.garr.it/">https://voidlinux.mirror.garr.it/</a></td><td>Europe</td><td>Italy</td></tr>
<tr><td><a href="https://void.cijber.net/">https://void.cijber.net/</a></td><td>Europe</td><td>Amsterdam, Netherlands</td></tr>
<tr><td><a href="https://void.sakamoto.pl/">https://void.sakamoto.pl/</a></td><td>Europe</td><td>Warsaw, Poland</td></tr>
<tr><td><a href="http://ftp.debian.ru/mirrors/voidlinux/">http://ftp.debian.ru/mirrors/voidlinux/</a></td><td>Europe</td><td>Russia</td></tr>
<tr><td><a href="https://mirror.yandex.ru/mirrors/voidlinux/">https://mirror.yandex.ru/mirrors/voidlinux/</a></td><td>Europe</td><td>Russia</td></tr>
<tr><td><a href="https://ftp.lysator.liu.se/pub/voidlinux/">https://ftp.lysator.liu.se/pub/voidlinux/</a></td><td>Europe</td><td>Sweden</td></tr>
<tr><td><a href="https://mirror.accum.se/mirror/voidlinux/">https://mirror.accum.se/mirror/voidlinux/</a></td><td>Europe</td><td>Sweden</td></tr>
<tr><td><a href="https://mirror.puzzle.ch/voidlinux/">https://mirror.puzzle.ch/voidlinux/</a></td><td>Europe</td><td>Bern, Switzerland</td></tr>
<tr><td><a href="https://mirror.vofr.net/voidlinux/">https://mirror.vofr.net/voidlinux/</a></td><td>North America</td><td>California, USA</td></tr>
<tr><td><a href="https://mirror2.sandyriver.net/pub/voidlinux/">https://mirror2.sandyriver.net/pub/voidlinux/</a></td><td>North America</td><td>Kentucky, USA</td></tr>
<tr><td><a href="https://mirror.clarkson.edu/voidlinux/">https://mirror.clarkson.edu/voidlinux/</a></td><td>North America</td><td>New York, USA</td></tr>
<tr><td><a href="https://mirror.aarnet.edu.au/pub/voidlinux/">https://mirror.aarnet.edu.au/pub/voidlinux/</a></td><td>Oceania</td><td>Canberra, Australia</td></tr>
<tr><td><a href="https://ftp.swin.edu.au/voidlinux/">https://ftp.swin.edu.au/voidlinux/</a></td><td>Oceania</td><td>Melbourne, Australia</td></tr>
<tr><td><a href="https://voidlinux.com.br/repo/">https://voidlinux.com.br/repo/</a></td><td>South America</td><td>Ouro Preto, Brazil</td></tr>
<tr><td><a href="http://void.chililinux.com/voidlinux/">http://void.chililinux.com/voidlinux/</a></td><td>South America</td><td>Pimenta Bueno, Brazil</td></tr>
</tbody></table>
</div>
<h2 id="tor-mirrors"><a class="header" href="#tor-mirrors">Tor Mirrors</a></h2>
<p>EvolutionOS is also mirrored on the Tor network. See <a href="xbps/repositories/mirrors/./tor.html">Using Tor
Mirrors</a> for more information.</p>
<h2 id="creating-a-mirror"><a class="header" href="#creating-a-mirror">Creating a mirror</a></h2>
<p>If you'd like to set up a mirror, and are confident you can keep it reasonably
up-to-date, follow one of the many guides available for mirroring with
<a href="https://man.voidlinux.org/rsync.1">rsync(1)</a>, then submit a pull request to
<a href="https://github.com/evolution-linux/evolution-docs">the evolution-docs repository</a> to add your
mirror to the appropriate mirror table on this page.</p>
<p>A full mirror requires around 1TB of storage. It is also possible to mirror only
part of the repositories. Excluding debug packages is one way of decreasing the
load on the Tier 1 mirrors, with low impact on users.</p>
<p>Please keep in mind that we pay bandwidth for all data sent out from the Tier 1
mirrors. You can respect this by only mirroring if your use case for your mirror
will offset the network throughput consumed by your mirror syncing.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="changing-mirrors"><a class="header" href="#changing-mirrors">Changing Mirrors</a></h1>
<p>Each repository has a file defining the URL for the mirror used. For official
repositories, these files are installed by the package manager in
<code>/usr/share/xbps.d</code>, but if duplicate files are found in <code>/etc/xbps.d</code>, those
values are used instead.</p>
<h2 id="xmirror"><a class="header" href="#xmirror">xmirror</a></h2>
<p>To easily modify the currently selected mirror,
<a href="https://man.voidlinux.org/xmirror.1">xmirror(1)</a> (from the <code>xmirror</code> package)
can be used. This utility takes care of all steps for updating the selected
mirror.</p>
<h2 id="manual-method-1"><a class="header" href="#manual-method-1">Manual Method</a></h2>
<p>Alternatively, this can be done manually:</p>
<p>To modify mirror URLs cleanly, copy all the repository configuration files to
<code>/etc/xbps.d</code> and change the URLs in each copied repository file.</p>
<pre><code># mkdir -p /etc/xbps.d
# cp /usr/share/xbps.d/*-repository-*.conf /etc/xbps.d/
# sed -i 's|https://repo-default.voidlinux.org|&lt;repository&gt;|g' /etc/xbps.d/*-repository-*.conf
</code></pre>
<p>After changing the URLs, you must synchronize xbps with the new mirrors:</p>
<pre><code># xbps-install -S
</code></pre>
<p>You should see the new repository URLs while synchronizing. You can also use
<code>xbps-query</code> to verify the repository URLs, but only after they have been
synchronized:</p>
<pre><code>$ xbps-query -L
 9970 https://repo-default.voidlinux.org/current (RSA signed)
   27 https://repo-default.voidlinux.org/current/multilib/nonfree (RSA signed)
 4230 https://repo-default.voidlinux.org/current/multilib (RSA signed)
   47 https://repo-default.voidlinux.org/current/nonfree (RSA signed)
 5368 https://repo-default.voidlinux.org/current/debug (RSA signed)
</code></pre>
<p>Remember that repositories added afterwards will also need to be changed, or
they will use the default mirror.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="using-tor-mirrors"><a class="header" href="#using-tor-mirrors">Using Tor Mirrors</a></h1>
<p>Tor is an anonymizing software that bounces traffic via computers all around the
world. It can provide access to regular sites on the internet or to hidden sites
only available on the network.</p>
<p>Note that these are tier 1 mirrors, and tier 0 mirrors still need to be on the clearnet.</p>
<p>The following EvolutionOS Linux Mirrors are available on the Tor Network:</p>
<div class="table-wrapper"><table><thead><tr><th>Repository</th><th>Location</th></tr></thead><tbody>
<tr><td><a href="http://lysator7eknrfl47rlyxvgeamrv7ucefgrrlhk7rouv3sna25asetwid.onion/pub/voidlinux/">http://lysator7eknrfl47rlyxvgeamrv7ucefgrrlhk7rouv3sna25asetwid.onion/pub/voidlinux/</a></td><td>EU: Sweden</td></tr>
</tbody></table>
</div>
<h2 id="using-xbps-with-tor"><a class="header" href="#using-xbps-with-tor">Using XBPS with Tor</a></h2>
<p>XBPS can be made to connect to mirrors using Tor. These mirrors can be normal
mirrors, via exit relays, or, for potentially greater anonymity, hidden service
mirrors on the network.</p>
<p>XBPS respects the <code>SOCKS_PROXY</code> environment variable, which makes it easy to use
via Tor.</p>
<h3 id="installing-tor"><a class="header" href="#installing-tor">Installing Tor</a></h3>
<p>Tor is contained in the <code>tor</code> package.</p>
<p>After having installed Tor, you can start it as your own user:</p>
<pre><code>$ tor
</code></pre>
<p>or enable its system service.</p>
<p>By default, Tor will act as a client and open a SOCKS5 proxy on TCP port 9050 on
localhost.</p>
<h3 id="making-xbps-connect-via-the-socks-proxy"><a class="header" href="#making-xbps-connect-via-the-socks-proxy">Making XBPS connect via the SOCKS proxy</a></h3>
<p>XBPS reads the <code>SOCKS_PROXY</code> environment variable and will use any proxy
specified in it. By simply setting the variable to the address and port of the
proxy opened by the Tor client, all XBPS's connections will go over the Tor
network.</p>
<p>An example upgrading your system over Tor:</p>
<pre><code># export SOCKS_PROXY=&quot;socks5://127.0.0.1:9050&quot;
# xbps-install -Su
</code></pre>
<h3 id="using-a-hidden-service-mirror"><a class="header" href="#using-a-hidden-service-mirror">Using a hidden service mirror</a></h3>
<p>To use a hidden service mirror, the default mirrors need to be overwritten with
configuration files pointing to <code>.onion</code>-addresses that are used internally on
the Tor network. XBPS allows overriding repository addresses under
<code>/etc/xbps.d</code>.</p>
<p>Copy your repository files from <code>/usr/share/xbps.d</code> to <code>/etc/xbps.d</code> and replace
the addresses with that of an onion service (Lysator's onion used as an
example):</p>
<pre><code># mkdir -p /etc/xbps.d
# cp /usr/share/xbps.d/*-repository-*.conf /etc/xbps.d/
# sed -i 's|https://repo-default.voidlinux.org|http://lysator7eknrfl47rlyxvgeamrv7ucefgrrlhk7rouv3sna25asetwid.onion/pub/voidlinux|g' /etc/xbps.d/*-repository-*.conf
</code></pre>
<p>Tor provides layered end-to-end encryption so HTTPS is not necessary.</p>
<p>When installing packages, with <code>SOCKS_PROXY</code> set like the earlier example, XBPS
should indicate that it is synchronizing the repositories from the onion address
specified in the override:</p>
<pre><code># xbps-install -S
[*] Updating `http://lysator7eknrfl47rlyxvgeamrv7ucefgrrlhk7rouv3sna25asetwid.onion/pub/voidlinux/current/aarch64/nonfree/aarch64-repodata' ...
aarch64-repodata: 4030B [avg rate: 54KB/s]
[*] Updating `http://lysator7eknrfl47rlyxvgeamrv7ucefgrrlhk7rouv3sna25asetwid.onion/pub/voidlinux/current/aarch64/aarch64-repodata' ...
aarch64-repodata: 1441KB [avg rate: 773KB/s]
</code></pre>
<h3 id="security-consideration"><a class="header" href="#security-consideration">Security consideration</a></h3>
<p>It is advisable to set <code>SOCKS_PROXY</code> automatically in your environment if you
are using an onion. If the setting is missing, a DNS query for the name of the
hidden service will leak to the configured DNS server.</p>
<p>To automatically set the environment variable, add it to a file in
<code>/etc/profile.d</code>:</p>
<pre><code># cat - &lt;&lt;EOF &gt; /etc/profile.d/socksproxy.sh
#!/bin/sh
export SOCKS_PROXY=&quot;socks5://127.0.0.1:9050&quot;
EOF
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="restricted-packages-1"><a class="header" href="#restricted-packages-1">Restricted Packages</a></h1>
<p>EvolutionOS offers some packages that are officially maintained, but not distributed.
These packages are marked as restricted and must be built from their
<a href="https://github.com/evolution-linux/evolution-packages">evolution-packages</a> template locally.</p>
<p>Packages can be restricted from distribution by either the upstream author or
EvolutionOS. EvolutionOS reserves the right to restrict distribution of any package for
effectively any reason, massive size being the most common. Another common
reason is restrictive licensing that does not allow third-party redistribution
of source or binary packages.</p>
<h2 id="building-manually"><a class="header" href="#building-manually">Building manually</a></h2>
<p>You can use <code>xbps-src</code> in the
<a href="https://github.com/evolution-linux/evolution-packages">evolution-packages</a> repository to build
the restricted packages from templates. For instructions on building packages
from templates, refer to the
<a href="https://github.com/evolution-linux/evolution-packages">evolution-packages</a> documentation, and
the <a href="https://github.com/evolution-linux/evolution-packages#quick-start">&quot;Quick start&quot;
section</a> in particular
.</p>
<p>Remember that the building of restricted packages must be enabled explicitly by
setting <code>XBPS_ALLOW_RESTRICTED=yes</code> in your <code>xbps-src</code> configuration (in the
<code>etc/conf</code> file in the repository.)</p>
<h2 id="automated-building"><a class="header" href="#automated-building">Automated building</a></h2>
<p>There is also a tool,
<a href="https://github.com/the-maldridge/xbps-mini-builder">xbps-mini-builder</a> which
automates the process of building a list of packages. The script can be called
periodically and will only rebuild packages if their templates have changed.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="custom-repositories"><a class="header" href="#custom-repositories">Custom Repositories</a></h1>
<p>EvolutionOS supports user-created repositories, both local and remote. This is only
recommended for serving custom packages created personally, or packages from
another trusted source. The EvolutionOS project does not support <em>any</em> third-party
package repositories - the use of third-party software packages poses very
serious security concerns, and risks serious damage your system.</p>
<h2 id="adding-custom-repositories"><a class="header" href="#adding-custom-repositories">Adding custom repositories</a></h2>
<p>To add a custom repository, create a file in <code>/etc/xbps.d</code>, with the contents:</p>
<pre><code>repository=&lt;URL&gt;
</code></pre>
<p>where <code>&lt;URL&gt;</code> is either a local directory or a URL to a remote repository.</p>
<p>For example, to define a remote repository:</p>
<pre><code># echo 'repository=http://my.domain.com/repo' &gt; /etc/xbps.d/my-remote-repo.conf
</code></pre>
<p>Remote repositories need to be <a href="xbps/repositories/./signing.html">signed</a>.
<a href="https://man.voidlinux.org/xbps-install.1">xbps-install(1)</a> refuses to install
packages from remote repositories if they are not signed.</p>
<p>To define a local repository:</p>
<pre><code># echo 'repository=/path/to/repo' &gt; /etc/xbps.d/my-local-repo.conf
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="signing-repositories"><a class="header" href="#signing-repositories">Signing Repositories</a></h1>
<p>Remote repositories <strong>must</strong> be signed. Local repositories do not need to be
signed.</p>
<p>The <a href="https://man.voidlinux.org/xbps-rindex.1">xbps-rindex(1)</a> tool is used to
sign repositories.</p>
<p>The private key for signing packages needs to be a PEM-encoded RSA key. The key
can be generated with either
<a href="https://man.voidlinux.org/ssh-keygen.1">ssh-keygen(1)</a> or
<a href="https://man.voidlinux.org/openssl.1">openssl(1)</a>:</p>
<pre><code>$ ssh-keygen -t rsa -m PEM -f private.pem
</code></pre>
<pre><code>$ openssl genrsa -out private.pem
</code></pre>
<p>Once the key is generated, the public part of the private key has to be added to
the repository metadata. This step is required only once.</p>
<pre><code>$ xbps-rindex --privkey private.pem --sign --signedby &quot;I'm Groot&quot; /path/to/repository/dir
</code></pre>
<p>Then sign one or more packages with the following command:</p>
<pre><code>$ xbps-rindex --privkey private.pem --sign-pkg /path/to/repository/dir/*.xbps
</code></pre>
<p>Note that future packages will not be automatically signed.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="troubleshooting-xbps"><a class="header" href="#troubleshooting-xbps">Troubleshooting XBPS</a></h1>
<p>Sometimes the package manager gets in a weird spot and can't fix itself without
help. This section documents important fixes and things that can go wrong when
working with XBPS.</p>
<h2 id="section-contents-5"><a class="header" href="#section-contents-5">Section Contents</a></h2>
<ul>
<li><a href="xbps/troubleshooting/./common-issues.html">Common Issues</a></li>
<li><a href="xbps/troubleshooting/./static.html">Static XBPS</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="common-issues"><a class="header" href="#common-issues">Common Issues</a></h1>
<h2 id="verifying-rsa-keys"><a class="header" href="#verifying-rsa-keys">Verifying RSA keys</a></h2>
<p>If the Void or EvolutionOS RSA key has changed,
<a href="https://man.voidlinux.org/xbps-install.1">xbps-install(1)</a> will report the new
key fingerprint and ask you to confirm it:</p>
<pre><code>&lt;repository&gt; repository has been RSA signed by &quot;Tracker-Friendly&quot;
Fingerprint: &lt;rsa_fingerprint&gt;
Do you want to import this public key? [Y/n]
</code></pre>
<p>To verify the key, ensure the <code>&lt;rsa_fingerprint&gt;</code> matches one of the
fingerprints in both
<a href="https://github.com/evolution-linux/evolution-packages/tree/master/common/repo-keys">evolution-packages</a>
and <a href="https://github.com/evolution-linux/evolution-installer/tree/master/keys">evolution-installer</a>.</p>
<p>Tier 0 mirror keys will be found at <a href="https://github.com/evolution-linux/evolution-installer/tree/master/include/var/db/xbps/">a evolution-installer subdirectory</a></p>
<h2 id="errors-while-updating-or-installing-packages"><a class="header" href="#errors-while-updating-or-installing-packages">Errors while updating or installing packages</a></h2>
<p>If there are any errors while updating or installing a new package, make sure
that you are using the latest version of the remote repository index. Running
<a href="https://man.voidlinux.org/xbps-install.1">xbps-install(1)</a> with the <code>-S</code> option
will guarantee that.</p>
<h3 id="operation-not-permitted"><a class="header" href="#operation-not-permitted">&quot;Operation not permitted&quot;</a></h3>
<p>An &quot;Operation not permitted&quot; error, such as:</p>
<pre><code>ERROR: [reposync] failed to fetch file https://repo-default.voidlinux.org/current/nonfree/x86_64-repodata': Operation not permitted
</code></pre>
<p>can be caused by your system's date and/or time being incorrect. Ensure your
<a href="xbps/troubleshooting/../../config/date-time.html">date and time</a> are correct.</p>
<h3 id="not-found"><a class="header" href="#not-found">&quot;Not Found&quot;</a></h3>
<p>A &quot;Not Found&quot; error, such as:</p>
<pre><code>ERROR: [reposync] failed to fetch file `https://repo-default.voidlinux.org/current/musl/x86_64-repodata': Not Found
</code></pre>
<p>usually means your XBPS configuration is pointing to the wrong repositories for
your system. Confirm that your <a href="https://man.voidlinux.org/xbps.d.5">xbps.d(5)</a>
files refer to <a href="xbps/troubleshooting/../repositories/index.html">the correct repositories</a>.</p>
<h3 id="shlib-errors"><a class="header" href="#shlib-errors">shlib errors</a></h3>
<p>An &quot;unresolvable shlib&quot; error, such as:</p>
<pre><code>libllvm8-8.0.1_2: broken, unresolvable shlib `libffi.so.6'
</code></pre>
<p>is probably due to outdated or orphan packages. To check for outdated packages,
simply try to <a href="xbps/troubleshooting/../index.html#updating">update your system</a>. Orphan packages, on
the other hand, have been removed from the Void or EvolutionOS repos, but are still installed
on your system; they can be removed by running
<a href="https://man.voidlinux.org/xbps-remove.1">xbps-remove(1)</a> with the <code>-o</code> option.</p>
<p>If you get an error message saying:</p>
<pre><code>Transaction aborted due to unresolved shlibs
</code></pre>
<p>the repositories are in the staging state, which can happen due to large builds.
The solution is to wait for the builds to finish. You can view the builds'
progress in the <a href="https://build.voidlinux.org/waterfall">Buildbot's Waterfall
Display</a>.</p>
<h3 id="repodata-errors"><a class="header" href="#repodata-errors">repodata errors</a></h3>
<p>In March 2020, the compression format used for the repository data (repodata)
was changed from gzip to zstd. If XBPS wasn't updated to version <code>0.54</code>
(released June 2019) or newer, it is not possible to update the system with it.
Unfortunately, there isn't an error message for this case, but it can be
detected by running <code>xbps-install</code> with the <code>-Sd</code> flags. The debug message for
this error is shown below.</p>
<pre><code>[DEBUG] [repo] `//var/db/xbps/https___repo-default_voidlinux_org_current/x86_64-repodata' failed to open repodata archive Invalid or incomplete multibyte or wide character
</code></pre>
<p>In this situation, it is necessary to follow the steps in
<a href="xbps/troubleshooting/./static.html">xbps-static</a>.</p>
<h2 id="broken-systems"><a class="header" href="#broken-systems">Broken systems</a></h2>
<p>If your system is for some reason broken and can't perform updates or package
installations, using a <a href="xbps/troubleshooting/./static.html">statically linked version of xbps</a> to
update and install packages can help you avoid reinstalling the whole system.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="static-xbps"><a class="header" href="#static-xbps">Static XBPS</a></h1>
<p>In rare cases, it is possible to break the system sufficiently that XBPS can no
longer function. This usually happens while trying to do unsupported things with
libc, but can also happen when an update contains a corrupt glibc archive or
otherwise fails to unpack and configure fully.</p>
<p>Another issue that can present itself is in systems with a XBPS version before
<code>0.54</code> (released June 2019). These systems will be impossible to update from the
official repositories using the regular update procedure, due a change in the
compression format used for repository data, which was made in March 2020.</p>
<p>In these cases it is possible to recover your system with a separate, statically
compiled copy of XBPS.</p>
<h2 id="obtaining-static-xbps"><a class="header" href="#obtaining-static-xbps">Obtaining static XBPS</a></h2>
<p>Statically compiled versions of XBPS are available on all mirrors in the
<code>static/</code> directory. The link below points to the static copies on the primary
mirror in the EU:</p>
<p><a href="https://repo-default.voidlinux.org/static">https://repo-default.voidlinux.org/static</a></p>
<p>Download and unpack the latest version, or the version that matches the broken
copy on your system (with a preference for the latest copy).</p>
<h2 id="using-static-xbps"><a class="header" href="#using-static-xbps">Using static XBPS</a></h2>
<p>The tools in the static set are identical to the normal ones found on most
systems. The only difference is that these tools are statically linked to the
musl C library, and should work on systems where nothing else does. On systems
that can no longer boot, it is recommended to chroot in using a EvolutionOS
installation medium and use the static tools from there, as it is unlikely that
even a shell will work correctly on those systems. When using static XBPS with a
glibc installation, the environment variable <code>XBPS_ARCH</code> needs to be set.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="contributing"><a class="header" href="#contributing">Contributing</a></h1>
<p>There's more to running a distribution than just writing code.</p>
<p>To contribute to the EvolutionOS packages repository, start by reading the
<a href="https://github.com/evolution-linux/evolution-packages/blob/master/CONTRIBUTING.md">CONTRIBUTING</a>
document in the evolution-packages GitHub repository.</p>
<p>To contribute to this Handbook, read
<a href="https://github.com/evolution-linux/evolution-docs/blob/master/CONTRIBUTING.md">CONTRIBUTING</a>
in the evolution-docs repository.</p>
<p>If you have any questions, feel free to email Tracker-Friendly at jliwin98@danwin1210.de</p>
<h2 id="usage-statistics"><a class="header" href="#usage-statistics">Usage Statistics</a></h2>
<p>If you would like to contribute usage reports, the
<a href="https://github.com/the-maldridge/popcorn">PopCorn</a> program reports installation
statistics back to the Void project. These statistics are purely opt-in -
PopCorn is <em>not</em> installed or enabled by default on any Void or EvolutionOS systems.
Additionally, PopCorn requires that port 8001 not be blocked on your system.</p>
<p><em>PopCorn</em> only reports which packages are installed, their version, and the host
CPU architecture (the output of <code>xuname</code>). This does not report which services
are enabled, or any other personal information. Individual systems are tracked
persistently by a random (client-generated) UUID, to ensure that each system is
only counted once in each 24-hour sampling period.</p>
<p>The data collected by <em>PopCorn</em> is available to view at
<a href="http://popcorn.voidlinux.org">http://popcorn.voidlinux.org</a></p>
<h3 id="setting-up-popcorn"><a class="header" href="#setting-up-popcorn">Setting up PopCorn</a></h3>
<p>First, install the <code>PopCorn</code> package. Then, enable the <code>popcorn</code> service, which
will attempt to report statistics once per day.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="contributing-to-evolution-docs"><a class="header" href="#contributing-to-evolution-docs">Contributing To evolution-docs</a></h1>

				</main>

				<nav id="nav-wide-wrapper" aria-label="Page navigation">

				</nav>
			</div>
		</div>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="book.js" type="text/javascript" charset="utf-8"></script>
          <script>
    // Check if a dark mode cookie exists, and apply dark mode if it does
    if (getCookie("darkMode") === "true") {
      applyDarkMode();
    }

    function toggleDarkMode() {
      if (getCookie("darkMode") === "true") {
        // Disable dark mode
        setCookie("darkMode", "false", 365);
        applyLightMode();
      } else {
        // Enable dark mode
        setCookie("darkMode", "true", 365);
        applyDarkMode();
      }
    }

    function applyDarkMode() {
      document.body.classList.add("dark-mode");
    }

    function applyLightMode() {
      document.body.classList.remove("dark-mode");
    }

    // Helper functions for handling cookies
    function setCookie(name, value, days) {
      var expires = "";
      if (days) {
        var date = new Date();
        date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
        expires = "; expires=" + date.toUTCString();
      }
      document.cookie = name + "=" + (value || "") + expires + "; path=/";
    }

    function getCookie(name) {
      var nameEQ = name + "=";
      var ca = document.cookie.split(';');
      for (var i = 0; i < ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0) === ' ') c = c.substring(1, c.length);
        if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
      }
      return null;
    }
  </script>
    </body>
</html>
